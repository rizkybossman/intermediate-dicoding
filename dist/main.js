"use strict";(self.webpackChunkstory_app=self.webpackChunkstory_app||[]).push([[792],{7427:(__unused_webpack_module,__unused_webpack___webpack_exports__,__webpack_require__)=>{eval('\n// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\nvar asyncToGenerator = __webpack_require__(467);\n// EXTERNAL MODULE: ./node_modules/@babel/runtime/regenerator/index.js\nvar regenerator = __webpack_require__(4756);\nvar regenerator_default = /*#__PURE__*/__webpack_require__.n(regenerator);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.symbol.js\nvar es_symbol = __webpack_require__(2675);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.symbol.description.js\nvar es_symbol_description = __webpack_require__(9463);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.concat.js\nvar es_array_concat = __webpack_require__(8706);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.map.js\nvar es_array_map = __webpack_require__(2062);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.function.name.js\nvar es_function_name = __webpack_require__(2010);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.object.to-string.js\nvar es_object_to_string = __webpack_require__(6099);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.promise.js\nvar es_promise = __webpack_require__(3362);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/web.timers.js\nvar web_timers = __webpack_require__(6031);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.for-each.js\nvar es_array_for_each = __webpack_require__(1629);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/web.dom-collections.for-each.js\nvar web_dom_collections_for_each = __webpack_require__(3500);\n;// ./src/components/Header.js\n\n\n\nvar currentAuthState = false;\nvar updateAuthUI = function updateAuthUI(isLoggedIn) {\n  currentAuthState = isLoggedIn;\n  var logoutLi = document.getElementById(\'logout-li\');\n  if (logoutLi) {\n    logoutLi.style.display = isLoggedIn ? \'block\' : \'none\';\n  }\n};\nvar Header = function Header() {\n  var _header$querySelector;\n  var header = document.createElement("header");\n  header.innerHTML = "\\n    <nav>\\n      <ul>\\n        <li><a href=\\"#/stories\\" data-navigo>Stories</a></li>\\n        <li><a href=\\"#/add-story\\" data-navigo>Add Story</a></li>\\n        <li><button id=\\"install-button\\" class=\\"install-btn\\" style=\\"display: none;\\">Install App</button></li>\\n        <li id=\\"logout-li\\" style=\\"display: ".concat(currentAuthState ? \'block\' : \'none\', "\\">\\n          <button id=\\"logout-button\\">Logout</button>\\n        </li>\\n      </ul>\\n    </nav>\\n  ");\n\n  // Logout handler\n  (_header$querySelector = header.querySelector(\'#logout-button\')) === null || _header$querySelector === void 0 || _header$querySelector.addEventListener(\'click\', function () {\n    window.dispatchEvent(new CustomEvent(\'logout\'));\n  });\n\n  // Navigation handler\n  var navLinks = header.querySelectorAll(\'a[data-navigo]\');\n  navLinks.forEach(function (link) {\n    link.addEventListener(\'click\', function () {\n      window.dispatchEvent(new CustomEvent(\'header-navigation\'));\n    });\n  });\n  return header;\n};\n// EXTERNAL MODULE: ./public/assets/styles/main.css\nvar main = __webpack_require__(7478);\n// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/classCallCheck.js\nvar classCallCheck = __webpack_require__(3029);\n// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/createClass.js\nvar createClass = __webpack_require__(2901);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.find.js\nvar es_array_find = __webpack_require__(113);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.includes.js\nvar es_array_includes = __webpack_require__(4423);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.slice.js\nvar es_array_slice = __webpack_require__(4782);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.string.starts-with.js\nvar es_string_starts_with = __webpack_require__(1392);\n;// ./src/utils/view-transition.js\nvar startViewTransition = function startViewTransition(callback) {\n  if (!document.startViewTransition) {\n    callback();\n    return;\n  }\n  document.startViewTransition(function () {\n    callback();\n  });\n};\ndocument.dispatchEvent(new CustomEvent(\'view-transition-start\'));\n\n// Around where your transition completes\ndocument.dispatchEvent(new CustomEvent(\'view-transition-end\'));\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.date.to-string.js\nvar es_date_to_string = __webpack_require__(3288);\n;// ./src/components/Footer.js\n\nvar Footer = function Footer() {\n  var footer = document.createElement("footer");\n  footer.innerHTML = "\\n      <p>&copy; ".concat(new Date().getFullYear(), " Story App. All rights reserved.</p>\\n    ");\n  return footer;\n};\n;// ./src/views/ErrorView.js\nvar ErrorView = function ErrorView() {\n  var view = document.createElement(\'main\');\n  view.id = \'main-content\';\n  view.innerHTML = "\\n    <div class=\\"error-message\\">\\n      <h1>404 Not Found</h1>\\n      <p>The page you\'re looking for doesn\'t exist.</p>\\n      <a href=\\"#/\\">Go to Home</a>\\n    </div>\\n  ";\n  return {\n    getView: function getView() {\n      return view;\n    }\n  };\n};\n;// ./src/router.js\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar Router = /*#__PURE__*/function () {\n  function Router(routes) {\n    (0,classCallCheck/* default */.A)(this, Router);\n    this.routes = routes;\n    this.rootElem = document.getElementById("app");\n    this.currentPresenter = null;\n    this.init();\n  }\n  return (0,createClass/* default */.A)(Router, [{\n    key: "init",\n    value: function init() {\n      var _this = this;\n      window.addEventListener("hashchange", function () {\n        return _this.handleRouting();\n      });\n      window.addEventListener("load", function () {\n        return _this.handleRouting();\n      });\n    }\n  }, {\n    key: "handleRouting",\n    value: function () {\n      var _handleRouting = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2() {\n        var _this$currentPresente,\n          _this2 = this;\n        var url, params, route;\n        return regenerator_default().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              url = window.location.hash.slice(1) || "/";\n              params = {};\n              route = this.findMatchingRoute(url, params) || this.routes.find(function (r) {\n                return r.path === "*";\n              }); // Clean up previous view\n              if ((_this$currentPresente = this.currentPresenter) !== null && _this$currentPresente !== void 0 && _this$currentPresente.cleanup) {\n                this.currentPresenter.cleanup();\n              }\n              _context2.next = 6;\n              return startViewTransition(/*#__PURE__*/(0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee() {\n                var _view$getView, _footer$getView, _header$getView, header, headerElement, view, viewElement, mainContent, footer, footerElement, _this2$currentPresent, _this2$currentPresent2, errorView;\n                return regenerator_default().wrap(function _callee$(_context) {\n                  while (1) switch (_context.prev = _context.next) {\n                    case 0:\n                      _context.prev = 0;\n                      _this2.rootElem.innerHTML = "";\n\n                      // Add header if authenticated\n                      if (!["/login", "/register"].includes(url)) {\n                        header = Header();\n                        headerElement = ((_header$getView = header.getView) === null || _header$getView === void 0 ? void 0 : _header$getView.call(header)) || header;\n                        if (headerElement instanceof Node) {\n                          _this2.rootElem.appendChild(headerElement);\n                        }\n                      }\n\n                      // Load view\n                      _context.next = 5;\n                      return route.view(params);\n                    case 5:\n                      view = _context.sent;\n                      viewElement = ((_view$getView = view.getView) === null || _view$getView === void 0 ? void 0 : _view$getView.call(view)) || view;\n                      if (viewElement instanceof Node) {\n                        _context.next = 9;\n                        break;\n                      }\n                      throw new Error("View is not a valid DOM node");\n                    case 9:\n                      // Ensure main content exists\n                      mainContent = viewElement.querySelector(\'main\') || viewElement;\n                      if (!mainContent.id) {\n                        mainContent.id = "main-content";\n                      }\n                      _this2.rootElem.appendChild(viewElement);\n\n                      // Add footer\n                      footer = Footer();\n                      footerElement = ((_footer$getView = footer.getView) === null || _footer$getView === void 0 ? void 0 : _footer$getView.call(footer)) || footer;\n                      if (footerElement instanceof Node) {\n                        _this2.rootElem.appendChild(footerElement);\n                      }\n\n                      // Set focus to first focusable element\n                      setTimeout(function () {\n                        var firstFocusable = _this2.rootElem.querySelector(\'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])\');\n                        firstFocusable === null || firstFocusable === void 0 || firstFocusable.focus();\n                      }, 100);\n\n                      // Store presenter\n                      if (route.presenter) {\n                        _this2.currentPresenter = route.presenter;\n                        (_this2$currentPresent = (_this2$currentPresent2 = _this2.currentPresenter).afterRender) === null || _this2$currentPresent === void 0 || _this2$currentPresent.call(_this2$currentPresent2);\n                      }\n                      _context.next = 25;\n                      break;\n                    case 19:\n                      _context.prev = 19;\n                      _context.t0 = _context["catch"](0);\n                      console.error("Routing error:", _context.t0);\n                      errorView = ErrorView();\n                      _this2.rootElem.innerHTML = "";\n                      _this2.rootElem.appendChild(errorView.getView());\n                    case 25:\n                    case "end":\n                      return _context.stop();\n                  }\n                }, _callee, null, [[0, 19]]);\n              })));\n            case 6:\n            case "end":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n      function handleRouting() {\n        return _handleRouting.apply(this, arguments);\n      }\n      return handleRouting;\n    }()\n  }, {\n    key: "findMatchingRoute",\n    value: function findMatchingRoute(url, params) {\n      return this.routes.find(function (route) {\n        var routeParts = route.path.split("/");\n        var urlParts = url.split("/");\n        if (routeParts.length !== urlParts.length) return false;\n        for (var i = 0; i < routeParts.length; i++) {\n          var routePart = routeParts[i];\n          var urlPart = urlParts[i];\n          if (routePart.startsWith(":")) {\n            var paramName = routePart.slice(1);\n            params[paramName] = urlPart;\n          } else if (routePart !== urlPart) {\n            return false;\n          }\n        }\n        return true;\n      });\n    }\n  }, {\n    key: "navigateTo",\n    value: function navigateTo(path) {\n      var currentPath = window.location.hash.slice(1) || "/";\n      if (currentPath === "/add-story" && this.currentPresenter) {\n        this.currentPresenter.cleanup();\n      }\n      window.location.hash = path;\n    }\n  }]);\n}();\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.date.to-json.js\nvar es_date_to_json = __webpack_require__(739);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.object.keys.js\nvar es_object_keys = __webpack_require__(9432);\n;// ./src/services/authApi.js\n\n\n\n\n\nvar API_BASE_URL = \'https://story-api.dicoding.dev/v1\';\nvar authApi_login = /*#__PURE__*/function () {\n  var _ref = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee(email, password) {\n    var response;\n    return regenerator_default().wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          _context.next = 2;\n          return fetch("".concat(API_BASE_URL, "/login"), {\n            method: \'POST\',\n            headers: {\n              \'Content-Type\': \'application/json\'\n            },\n            body: JSON.stringify({\n              email: email,\n              password: password\n            })\n          });\n        case 2:\n          response = _context.sent;\n          return _context.abrupt("return", response.json());\n        case 4:\n        case "end":\n          return _context.stop();\n      }\n    }, _callee);\n  }));\n  return function login(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\nvar authApi_register = /*#__PURE__*/function () {\n  var _ref2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2(name, email, password) {\n    var response;\n    return regenerator_default().wrap(function _callee2$(_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 2;\n          return fetch("".concat(API_BASE_URL, "/register"), {\n            method: \'POST\',\n            headers: {\n              \'Content-Type\': \'application/json\'\n            },\n            body: JSON.stringify({\n              name: name,\n              email: email,\n              password: password\n            })\n          });\n        case 2:\n          response = _context2.sent;\n          return _context2.abrupt("return", response.json());\n        case 4:\n        case "end":\n          return _context2.stop();\n      }\n    }, _callee2);\n  }));\n  return function register(_x3, _x4, _x5) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n;// ./src/models/AuthModel.js\n\n\n\n\n\n\n\n\nvar AuthModel = /*#__PURE__*/function () {\n  function AuthModel() {\n    (0,classCallCheck/* default */.A)(this, AuthModel);\n    this.token = localStorage.getItem("token") || null;\n    this.user = JSON.parse(localStorage.getItem("user")) || null;\n  }\n  return (0,createClass/* default */.A)(AuthModel, [{\n    key: "login",\n    value: function () {\n      var _login2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee(email, password) {\n        var response;\n        return regenerator_default().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return authApi_login(email, password);\n            case 3:\n              response = _context.sent;\n              if (response.error) {\n                _context.next = 10;\n                break;\n              }\n              this.token = response.loginResult.token;\n              this.user = {\n                userId: response.loginResult.userId,\n                name: response.loginResult.name\n              };\n              localStorage.setItem("token", this.token);\n              localStorage.setItem("user", JSON.stringify(this.user));\n              return _context.abrupt("return", {\n                success: true,\n                user: this.user\n              });\n            case 10:\n              return _context.abrupt("return", {\n                success: false,\n                message: response.message\n              });\n            case 13:\n              _context.prev = 13;\n              _context.t0 = _context["catch"](0);\n              console.error("Login error:", _context.t0);\n              return _context.abrupt("return", {\n                success: false,\n                message: "Login failed. Please try again."\n              });\n            case 17:\n            case "end":\n              return _context.stop();\n          }\n        }, _callee, this, [[0, 13]]);\n      }));\n      function login(_x, _x2) {\n        return _login2.apply(this, arguments);\n      }\n      return login;\n    }()\n  }, {\n    key: "register",\n    value: function () {\n      var _register2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2(name, email, password) {\n        var response;\n        return regenerator_default().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 3;\n              return authApi_register(name, email, password);\n            case 3:\n              response = _context2.sent;\n              if (response.error) {\n                _context2.next = 6;\n                break;\n              }\n              return _context2.abrupt("return", {\n                success: true\n              });\n            case 6:\n              return _context2.abrupt("return", {\n                success: false,\n                message: response.message\n              });\n            case 9:\n              _context2.prev = 9;\n              _context2.t0 = _context2["catch"](0);\n              console.error("Registration error:", _context2.t0);\n              return _context2.abrupt("return", {\n                success: false,\n                message: "Registration failed. Please try again."\n              });\n            case 13:\n            case "end":\n              return _context2.stop();\n          }\n        }, _callee2, null, [[0, 9]]);\n      }));\n      function register(_x3, _x4, _x5) {\n        return _register2.apply(this, arguments);\n      }\n      return register;\n    }()\n  }, {\n    key: "logout",\n    value: function logout() {\n      this.token = null;\n      this.user = null;\n      localStorage.removeItem("token");\n      localStorage.removeItem("user");\n    }\n  }, {\n    key: "isAuthenticated",\n    value: function isAuthenticated() {\n      return !!this.token;\n    }\n  }, {\n    key: "getUser",\n    value: function getUser() {\n      return this.user;\n    }\n  }, {\n    key: "getToken",\n    value: function getToken() {\n      return this.token;\n    }\n  }]);\n}();\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.symbol.iterator.js\nvar es_symbol_iterator = __webpack_require__(2259);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.filter.js\nvar es_array_filter = __webpack_require__(2008);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.from.js\nvar es_array_from = __webpack_require__(3418);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.is-array.js\nvar es_array_is_array = __webpack_require__(4346);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.iterator.js\nvar es_array_iterator = __webpack_require__(3792);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.sort.js\nvar es_array_sort = __webpack_require__(6910);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.date.now.js\nvar es_date_now = __webpack_require__(9089);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.date.to-iso-string.js\nvar es_date_to_iso_string = __webpack_require__(1688);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.regexp.exec.js\nvar es_regexp_exec = __webpack_require__(7495);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.regexp.to-string.js\nvar es_regexp_to_string = __webpack_require__(8781);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.string.iterator.js\nvar es_string_iterator = __webpack_require__(7764);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/web.dom-collections.iterator.js\nvar web_dom_collections_iterator = __webpack_require__(2953);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/web.url.js\nvar web_url = __webpack_require__(3296);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/web.url.to-json.js\nvar web_url_to_json = __webpack_require__(7208);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/web.url-search-params.js\nvar web_url_search_params = __webpack_require__(8408);\n;// ./src/data/api.js\n\n\n\n\n\n\n\n\nvar api_API_BASE_URL = "https://story-api.dicoding.dev/v1";\nvar register = /*#__PURE__*/(/* unused pure expression or super */ null && (function () {\n  var _ref = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(name, email, password) {\n    var response;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          _context.next = 2;\n          return fetch("".concat(api_API_BASE_URL, "/register"), {\n            method: "POST",\n            headers: {\n              "Content-Type": "application/json"\n            },\n            body: JSON.stringify({\n              name: name,\n              email: email,\n              password: password\n            })\n          });\n        case 2:\n          response = _context.sent;\n          return _context.abrupt("return", response.json());\n        case 4:\n        case "end":\n          return _context.stop();\n      }\n    }, _callee);\n  }));\n  return function register(_x, _x2, _x3) {\n    return _ref.apply(this, arguments);\n  };\n}()));\nvar login = /*#__PURE__*/(/* unused pure expression or super */ null && (function () {\n  var _ref2 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(email, password) {\n    var response;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 2;\n          return fetch("".concat(api_API_BASE_URL, "/login"), {\n            method: "POST",\n            headers: {\n              "Content-Type": "application/json"\n            },\n            body: JSON.stringify({\n              email: email,\n              password: password\n            })\n          });\n        case 2:\n          response = _context2.sent;\n          return _context2.abrupt("return", response.json());\n        case 4:\n        case "end":\n          return _context2.stop();\n      }\n    }, _callee2);\n  }));\n  return function login(_x4, _x5) {\n    return _ref2.apply(this, arguments);\n  };\n}()));\nvar api_getAllStories = /*#__PURE__*/function () {\n  var _ref3 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee3(token, page, size, withLocation) {\n    var response, data;\n    return regenerator_default().wrap(function _callee3$(_context3) {\n      while (1) switch (_context3.prev = _context3.next) {\n        case 0:\n          _context3.prev = 0;\n          _context3.next = 3;\n          return fetch("".concat(api_API_BASE_URL, "/stories?page=").concat(page, "&size=").concat(size, "&location=").concat(withLocation ? 1 : 0), {\n            headers: {\n              Authorization: "Bearer ".concat(token)\n            }\n          });\n        case 3:\n          response = _context3.sent;\n          _context3.next = 6;\n          return response.json();\n        case 6:\n          data = _context3.sent;\n          console.log(\'API Response:\', data); // Debug log\n          if (response.ok) {\n            _context3.next = 10;\n            break;\n          }\n          throw new Error(data.message || \'Failed to fetch\');\n        case 10:\n          return _context3.abrupt("return", data);\n        case 13:\n          _context3.prev = 13;\n          _context3.t0 = _context3["catch"](0);\n          console.error(\'API Error:\', _context3.t0);\n          throw _context3.t0;\n        case 17:\n        case "end":\n          return _context3.stop();\n      }\n    }, _callee3, null, [[0, 13]]);\n  }));\n  return function getAllStories(_x6, _x7, _x8, _x9) {\n    return _ref3.apply(this, arguments);\n  };\n}();\nvar api_getStoryDetail = /*#__PURE__*/function () {\n  var _ref4 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee4(id, token) {\n    var response;\n    return regenerator_default().wrap(function _callee4$(_context4) {\n      while (1) switch (_context4.prev = _context4.next) {\n        case 0:\n          _context4.next = 2;\n          return fetch("".concat(api_API_BASE_URL, "/stories/").concat(id), {\n            headers: {\n              Authorization: "Bearer ".concat(token)\n            }\n          });\n        case 2:\n          response = _context4.sent;\n          return _context4.abrupt("return", response.json());\n        case 4:\n        case "end":\n          return _context4.stop();\n      }\n    }, _callee4);\n  }));\n  return function getStoryDetail(_x0, _x1) {\n    return _ref4.apply(this, arguments);\n  };\n}();\nvar api_addStory = /*#__PURE__*/function () {\n  var _ref5 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee5(data, token) {\n    var formData, response;\n    return regenerator_default().wrap(function _callee5$(_context5) {\n      while (1) switch (_context5.prev = _context5.next) {\n        case 0:\n          formData = new FormData();\n          formData.append("description", data.description);\n          formData.append("photo", data.photo);\n          if (data.lat && data.lon) {\n            formData.append("lat", data.lat);\n            formData.append("lon", data.lon);\n          }\n          _context5.next = 6;\n          return fetch("".concat(api_API_BASE_URL, "/stories"), {\n            method: "POST",\n            headers: {\n              Authorization: "Bearer ".concat(token)\n            },\n            body: formData\n          });\n        case 6:\n          response = _context5.sent;\n          return _context5.abrupt("return", response.json());\n        case 8:\n        case "end":\n          return _context5.stop();\n      }\n    }, _callee5);\n  }));\n  return function addStory(_x10, _x11) {\n    return _ref5.apply(this, arguments);\n  };\n}();\nvar addStoryGuest = /*#__PURE__*/function () {\n  var _ref6 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee6(data) {\n    var formData, response;\n    return regenerator_default().wrap(function _callee6$(_context6) {\n      while (1) switch (_context6.prev = _context6.next) {\n        case 0:\n          formData = new FormData();\n          formData.append("description", data.description);\n          formData.append("photo", data.photo);\n          if (data.lat && data.lon) {\n            formData.append("lat", data.lat);\n            formData.append("lon", data.lon);\n          }\n          _context6.next = 6;\n          return fetch("".concat(api_API_BASE_URL, "/stories/guest"), {\n            method: "POST",\n            body: formData\n          });\n        case 6:\n          response = _context6.sent;\n          return _context6.abrupt("return", response.json());\n        case 8:\n        case "end":\n          return _context6.stop();\n      }\n    }, _callee6);\n  }));\n  return function addStoryGuest(_x12) {\n    return _ref6.apply(this, arguments);\n  };\n}();\nvar subscribeToNotifications = /*#__PURE__*/function () {\n  var _ref7 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee7(subscription, token) {\n    var response;\n    return regenerator_default().wrap(function _callee7$(_context7) {\n      while (1) switch (_context7.prev = _context7.next) {\n        case 0:\n          _context7.next = 2;\n          return fetch("".concat(api_API_BASE_URL, "/notifications/subscribe"), {\n            method: "POST",\n            headers: {\n              "Content-Type": "application/json",\n              Authorization: "Bearer ".concat(token)\n            },\n            body: JSON.stringify(subscription)\n          });\n        case 2:\n          response = _context7.sent;\n          return _context7.abrupt("return", response.json());\n        case 4:\n        case "end":\n          return _context7.stop();\n      }\n    }, _callee7);\n  }));\n  return function subscribeToNotifications(_x13, _x14) {\n    return _ref7.apply(this, arguments);\n  };\n}();\nvar unsubscribeFromNotifications = /*#__PURE__*/function () {\n  var _ref8 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee8(endpoint, token) {\n    var response;\n    return regenerator_default().wrap(function _callee8$(_context8) {\n      while (1) switch (_context8.prev = _context8.next) {\n        case 0:\n          _context8.next = 2;\n          return fetch("".concat(api_API_BASE_URL, "/notifications/subscribe"), {\n            method: "DELETE",\n            headers: {\n              "Content-Type": "application/json",\n              Authorization: "Bearer ".concat(token)\n            },\n            body: JSON.stringify({\n              endpoint: endpoint\n            })\n          });\n        case 2:\n          response = _context8.sent;\n          return _context8.abrupt("return", response.json());\n        case 4:\n        case "end":\n          return _context8.stop();\n      }\n    }, _callee8);\n  }));\n  return function unsubscribeFromNotifications(_x15, _x16) {\n    return _ref8.apply(this, arguments);\n  };\n}();\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.object.define-properties.js\nvar es_object_define_properties = __webpack_require__(7945);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.object.define-property.js\nvar es_object_define_property = __webpack_require__(4185);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.object.get-own-property-descriptor.js\nvar es_object_get_own_property_descriptor = __webpack_require__(3851);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.object.get-own-property-descriptors.js\nvar es_object_get_own_property_descriptors = __webpack_require__(1278);\n;// ./src/data/database.js\n\n\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar initDB = function initDB() {\n  return new Promise(function (resolve, reject) {\n    var request = indexedDB.open("StoryAppDB", 1);\n    request.onerror = function (event) {\n      console.error("Database error:", event.target.error);\n      reject("Database error");\n    };\n    request.onupgradeneeded = function (event) {\n      var db = event.target.result;\n\n      // Create object store for stories\n      if (!db.objectStoreNames.contains("stories")) {\n        var storiesStore = db.createObjectStore("stories", {\n          keyPath: "id"\n        });\n        storiesStore.createIndex("createdAt", "createdAt", {\n          unique: false\n        });\n      }\n\n      // Create object store for user data\n      if (!db.objectStoreNames.contains("user")) {\n        db.createObjectStore("user", {\n          keyPath: "id"\n        });\n      }\n    };\n    request.onsuccess = function (event) {\n      resolve(event.target.result);\n    };\n  });\n};\nvar saveStories = /*#__PURE__*/function () {\n  var _ref = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee(stories) {\n    var db, transaction, store;\n    return regenerator_default().wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          _context.prev = 0;\n          _context.next = 3;\n          return initDB();\n        case 3:\n          db = _context.sent;\n          transaction = db.transaction("stories", "readwrite");\n          store = transaction.objectStore("stories");\n          stories.forEach(function (story) {\n            store.put(story);\n          });\n          return _context.abrupt("return", new Promise(function (resolve) {\n            transaction.oncomplete = function () {\n              resolve(true);\n            };\n          }));\n        case 10:\n          _context.prev = 10;\n          _context.t0 = _context["catch"](0);\n          console.error("Failed to save stories:", _context.t0);\n          return _context.abrupt("return", false);\n        case 14:\n        case "end":\n          return _context.stop();\n      }\n    }, _callee, null, [[0, 10]]);\n  }));\n  return function saveStories(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\nvar getStories = /*#__PURE__*/function () {\n  var _ref2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2() {\n    var db, transaction, store, request;\n    return regenerator_default().wrap(function _callee2$(_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.prev = 0;\n          _context2.next = 3;\n          return initDB();\n        case 3:\n          db = _context2.sent;\n          transaction = db.transaction("stories", "readonly");\n          store = transaction.objectStore("stories");\n          request = store.getAll();\n          return _context2.abrupt("return", new Promise(function (resolve) {\n            request.onsuccess = function () {\n              resolve(request.result || []);\n            };\n          }));\n        case 10:\n          _context2.prev = 10;\n          _context2.t0 = _context2["catch"](0);\n          console.error("Failed to get stories:", _context2.t0);\n          return _context2.abrupt("return", []);\n        case 14:\n        case "end":\n          return _context2.stop();\n      }\n    }, _callee2, null, [[0, 10]]);\n  }));\n  return function getStories() {\n    return _ref2.apply(this, arguments);\n  };\n}();\nvar saveUserData = /*#__PURE__*/(/* unused pure expression or super */ null && (function () {\n  var _ref3 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(userData) {\n    var db, transaction, store;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) switch (_context3.prev = _context3.next) {\n        case 0:\n          _context3.prev = 0;\n          _context3.next = 3;\n          return initDB();\n        case 3:\n          db = _context3.sent;\n          transaction = db.transaction("user", "readwrite");\n          store = transaction.objectStore("user");\n          store.put(_objectSpread({\n            id: "currentUser"\n          }, userData));\n          return _context3.abrupt("return", new Promise(function (resolve) {\n            transaction.oncomplete = function () {\n              resolve(true);\n            };\n          }));\n        case 10:\n          _context3.prev = 10;\n          _context3.t0 = _context3["catch"](0);\n          console.error("Failed to save user data:", _context3.t0);\n          return _context3.abrupt("return", false);\n        case 14:\n        case "end":\n          return _context3.stop();\n      }\n    }, _callee3, null, [[0, 10]]);\n  }));\n  return function saveUserData(_x2) {\n    return _ref3.apply(this, arguments);\n  };\n}()));\nvar getUserData = /*#__PURE__*/(/* unused pure expression or super */ null && (function () {\n  var _ref4 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n    var db, transaction, store, request;\n    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n      while (1) switch (_context4.prev = _context4.next) {\n        case 0:\n          _context4.prev = 0;\n          _context4.next = 3;\n          return initDB();\n        case 3:\n          db = _context4.sent;\n          transaction = db.transaction("user", "readonly");\n          store = transaction.objectStore("user");\n          request = store.get("currentUser");\n          return _context4.abrupt("return", new Promise(function (resolve) {\n            request.onsuccess = function () {\n              resolve(request.result || null);\n            };\n          }));\n        case 10:\n          _context4.prev = 10;\n          _context4.t0 = _context4["catch"](0);\n          console.error("Failed to get user data:", _context4.t0);\n          return _context4.abrupt("return", null);\n        case 14:\n        case "end":\n          return _context4.stop();\n      }\n    }, _callee4, null, [[0, 10]]);\n  }));\n  return function getUserData() {\n    return _ref4.apply(this, arguments);\n  };\n}()));\nvar isWriting = false;\nvar _addStoryOffline = /*#__PURE__*/function () {\n  var _ref5 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee5(story) {\n    var db, tx, store;\n    return regenerator_default().wrap(function _callee5$(_context5) {\n      while (1) switch (_context5.prev = _context5.next) {\n        case 0:\n          if (!isWriting) {\n            _context5.next = 4;\n            break;\n          }\n          _context5.next = 3;\n          return new Promise(function (resolve) {\n            return setTimeout(resolve, 100);\n          });\n        case 3:\n          return _context5.abrupt("return", _addStoryOffline(story));\n        case 4:\n          isWriting = true;\n          _context5.prev = 5;\n          _context5.next = 8;\n          return initDB();\n        case 8:\n          db = _context5.sent;\n          tx = db.transaction("stories", "readwrite");\n          store = tx.objectStore("stories");\n          store.put(story);\n          return _context5.abrupt("return", new Promise(function (resolve) {\n            tx.oncomplete = function () {\n              return resolve(true);\n            };\n            tx.onerror = function () {\n              console.error("Transaction failed:", tx.error);\n              resolve(false);\n            };\n          }));\n        case 15:\n          _context5.prev = 15;\n          _context5.t0 = _context5["catch"](5);\n          console.error("Failed to save story offline:", _context5.t0);\n          return _context5.abrupt("return", false);\n        case 19:\n          _context5.prev = 19;\n          isWriting = false;\n          return _context5.finish(19);\n        case 22:\n        case "end":\n          return _context5.stop();\n      }\n    }, _callee5, null, [[5, 15, 19, 22]]);\n  }));\n  return function addStoryOffline(_x3) {\n    return _ref5.apply(this, arguments);\n  };\n}();\n\nvar database_deleteStoryOffline = /*#__PURE__*/function () {\n  var _ref6 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee6(id) {\n    var db, tx, store;\n    return regenerator_default().wrap(function _callee6$(_context6) {\n      while (1) switch (_context6.prev = _context6.next) {\n        case 0:\n          _context6.prev = 0;\n          _context6.next = 3;\n          return initDB();\n        case 3:\n          db = _context6.sent;\n          tx = db.transaction("stories", "readwrite");\n          store = tx.objectStore("stories");\n          store["delete"](id);\n          return _context6.abrupt("return", new Promise(function (resolve) {\n            tx.oncomplete = function () {\n              return resolve(true);\n            };\n          }));\n        case 10:\n          _context6.prev = 10;\n          _context6.t0 = _context6["catch"](0);\n          console.error("Failed to delete story:", _context6.t0);\n          return _context6.abrupt("return", false);\n        case 14:\n        case "end":\n          return _context6.stop();\n      }\n    }, _callee6, null, [[0, 10]]);\n  }));\n  return function deleteStoryOffline(_x4) {\n    return _ref6.apply(this, arguments);\n  };\n}();\nvar getOfflineStories = /*#__PURE__*/(/* unused pure expression or super */ null && (function () {\n  var _ref7 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7() {\n    var db, tx, store, request;\n    return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n      while (1) switch (_context7.prev = _context7.next) {\n        case 0:\n          _context7.next = 2;\n          return initDB();\n        case 2:\n          db = _context7.sent;\n          tx = db.transaction("stories", "readonly");\n          store = tx.objectStore("stories");\n          request = store.getAll();\n          return _context7.abrupt("return", new Promise(function (resolve) {\n            request.onsuccess = function () {\n              resolve(request.result.filter(function (story) {\n                return story.isOffline;\n              }));\n            };\n          }));\n        case 7:\n        case "end":\n          return _context7.stop();\n      }\n    }, _callee7);\n  }));\n  return function getOfflineStories() {\n    return _ref7.apply(this, arguments);\n  };\n}()));\n;// ./src/models/StoryModel.js\n\n\n\nfunction _createForOfIteratorHelper(r, e) { var t = "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"]; if (!t) { if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e && r && "number" == typeof r.length) { t && (r = t); var _n = 0, F = function F() {}; return { s: F, n: function n() { return _n >= r.length ? { done: !0 } : { done: !1, value: r[_n++] }; }, e: function e(r) { throw r; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var o, a = !0, u = !1; return { s: function s() { t = t.call(r); }, n: function n() { var r = t.next(); return a = r.done, r; }, e: function e(r) { u = !0, o = r; }, f: function f() { try { a || null == t["return"] || t["return"](); } finally { if (u) throw o; } } }; }\nfunction _unsupportedIterableToArray(r, a) { if (r) { if ("string" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }\nfunction _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar StoryModel = /*#__PURE__*/function () {\n  function StoryModel(authModel) {\n    (0,classCallCheck/* default */.A)(this, StoryModel);\n    this.authModel = authModel;\n  }\n  return (0,createClass/* default */.A)(StoryModel, [{\n    key: "getAllStories",\n    value: function () {\n      var _getAllStories2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee() {\n        var page,\n          size,\n          withLocation,\n          token,\n          response,\n          offlineStories,\n          _offlineStories,\n          _args = arguments;\n        return regenerator_default().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              page = _args.length > 0 && _args[0] !== undefined ? _args[0] : 1;\n              size = _args.length > 1 && _args[1] !== undefined ? _args[1] : 10;\n              withLocation = _args.length > 2 && _args[2] !== undefined ? _args[2] : false;\n              _context.prev = 3;\n              token = this.authModel.getToken();\n              _context.next = 7;\n              return api_getAllStories(token, page, size, withLocation);\n            case 7:\n              response = _context.sent;\n              if (response.error) {\n                _context.next = 12;\n                break;\n              }\n              _context.next = 11;\n              return saveStories(response.listStory);\n            case 11:\n              return _context.abrupt("return", {\n                success: true,\n                stories: response.listStory\n              });\n            case 12:\n              _context.next = 14;\n              return getStories();\n            case 14:\n              offlineStories = _context.sent;\n              return _context.abrupt("return", {\n                success: true,\n                stories: offlineStories,\n                isOffline: true\n              });\n            case 18:\n              _context.prev = 18;\n              _context.t0 = _context["catch"](3);\n              _context.next = 22;\n              return getStories();\n            case 22:\n              _offlineStories = _context.sent;\n              return _context.abrupt("return", {\n                success: !!_offlineStories.length,\n                stories: _offlineStories || [],\n                isOffline: true\n              });\n            case 24:\n            case "end":\n              return _context.stop();\n          }\n        }, _callee, this, [[3, 18]]);\n      }));\n      function getAllStories() {\n        return _getAllStories2.apply(this, arguments);\n      }\n      return getAllStories;\n    }()\n  }, {\n    key: "getStoryDetail",\n    value: function () {\n      var _getStoryDetail2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2(id) {\n        var token, response;\n        return regenerator_default().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              token = this.authModel.getToken();\n              if (token) {\n                _context2.next = 4;\n                break;\n              }\n              return _context2.abrupt("return", {\n                success: false,\n                message: "Authentication required"\n              });\n            case 4:\n              _context2.next = 6;\n              return api_getStoryDetail(id, token);\n            case 6:\n              response = _context2.sent;\n              if (response.error) {\n                _context2.next = 9;\n                break;\n              }\n              return _context2.abrupt("return", {\n                success: true,\n                story: response.story\n              });\n            case 9:\n              return _context2.abrupt("return", {\n                success: false,\n                message: response.message || "Failed to fetch story"\n              });\n            case 12:\n              _context2.prev = 12;\n              _context2.t0 = _context2["catch"](0);\n              return _context2.abrupt("return", {\n                success: false,\n                message: _context2.t0.message || "Network error while fetching story"\n              });\n            case 15:\n            case "end":\n              return _context2.stop();\n          }\n        }, _callee2, this, [[0, 12]]);\n      }));\n      function getStoryDetail(_x) {\n        return _getStoryDetail2.apply(this, arguments);\n      }\n      return getStoryDetail;\n    }()\n  }, {\n    key: "addStory",\n    value: function () {\n      var _addStory2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee3(data) {\n        var token, response;\n        return regenerator_default().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              token = this.authModel.getToken();\n              if (!(!(data !== null && data !== void 0 && data.description) || !(data !== null && data !== void 0 && data.photo))) {\n                _context3.next = 4;\n                break;\n              }\n              return _context3.abrupt("return", {\n                success: false,\n                message: "Description and photo are required"\n              });\n            case 4:\n              if (!token) {\n                _context3.next = 10;\n                break;\n              }\n              _context3.next = 7;\n              return api_addStory(data, token);\n            case 7:\n              _context3.t0 = _context3.sent;\n              _context3.next = 13;\n              break;\n            case 10:\n              _context3.next = 12;\n              return addStoryGuest(data);\n            case 12:\n              _context3.t0 = _context3.sent;\n            case 13:\n              response = _context3.t0;\n              if (response.error) {\n                _context3.next = 16;\n                break;\n              }\n              return _context3.abrupt("return", {\n                success: true,\n                message: "Story added successfully",\n                data: response\n              });\n            case 16:\n              return _context3.abrupt("return", {\n                success: false,\n                message: response.message || "Failed to add story"\n              });\n            case 19:\n              _context3.prev = 19;\n              _context3.t1 = _context3["catch"](0);\n              return _context3.abrupt("return", {\n                success: false,\n                message: _context3.t1.message || "Network error while adding story"\n              });\n            case 22:\n            case "end":\n              return _context3.stop();\n          }\n        }, _callee3, this, [[0, 19]]);\n      }));\n      function addStory(_x2) {\n        return _addStory2.apply(this, arguments);\n      }\n      return addStory;\n    }()\n  }, {\n    key: "addStoryOffline",\n    value: function () {\n      var _addStoryOffline2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee4(data) {\n        var storyId, photoUrl, photoBase64, story;\n        return regenerator_default().wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.prev = 0;\n              storyId = "offline_".concat(Date.now(), "_").concat(Math.floor(Math.random() * 1000));\n              photoUrl = \'\';\n              photoBase64 = \'\';\n              if (!(data.photo instanceof Blob || data.photo instanceof File)) {\n                _context4.next = 9;\n                break;\n              }\n              _context4.next = 7;\n              return this.readFileAsBase64(data.photo);\n            case 7:\n              photoBase64 = _context4.sent;\n              photoUrl = URL.createObjectURL(data.photo);\n            case 9:\n              story = {\n                id: storyId,\n                name: "You (Offline)",\n                description: data.description,\n                photoUrl: photoUrl || \'/assets/images/placeholder-offline.jpg\',\n                photoBase64: photoBase64,\n                createdAt: new Date().toISOString(),\n                updatedAt: new Date().toISOString(),\n                isOffline: true,\n                lat: data.lat,\n                lon: data.lon,\n                originalPhoto: data.photo\n              };\n              _context4.next = 12;\n              return _addStoryOffline(story);\n            case 12:\n              return _context4.abrupt("return", {\n                success: true,\n                story: story\n              });\n            case 15:\n              _context4.prev = 15;\n              _context4.t0 = _context4["catch"](0);\n              console.error("Failed to save offline story:", _context4.t0);\n              return _context4.abrupt("return", {\n                success: false,\n                error: _context4.t0\n              });\n            case 19:\n            case "end":\n              return _context4.stop();\n          }\n        }, _callee4, this, [[0, 15]]);\n      }));\n      function addStoryOffline(_x3) {\n        return _addStoryOffline2.apply(this, arguments);\n      }\n      return addStoryOffline;\n    }()\n  }, {\n    key: "readFileAsBase64",\n    value: function readFileAsBase64(file) {\n      return new Promise(function (resolve, reject) {\n        var reader = new FileReader();\n        reader.onload = function () {\n          return resolve(reader.result);\n        };\n        reader.onerror = reject;\n        reader.readAsDataURL(file);\n      });\n    }\n  }, {\n    key: "syncOfflineStories",\n    value: function () {\n      var _syncOfflineStories = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee5(syncQueue) {\n        var offlineStories, token, toSync, syncedIds, _iterator, _step, story, photoBlob, response;\n        return regenerator_default().wrap(function _callee5$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.prev = 0;\n              _context5.next = 3;\n              return this.getOfflineStories();\n            case 3:\n              offlineStories = _context5.sent;\n              token = this.authModel.getToken();\n              if (token) {\n                _context5.next = 8;\n                break;\n              }\n              console.log(\'No auth token - skipping sync\');\n              return _context5.abrupt("return", {\n                success: false,\n                error: \'Authentication required\'\n              });\n            case 8:\n              // Filter stories that are both offline and in the sync queue\n              toSync = offlineStories.sort(function (a, b) {\n                return new Date(a.createdAt) - new Date(b.createdAt);\n              }).filter(function (story) {\n                return syncQueue.has(story.id);\n              });\n              if (!(toSync.length === 0)) {\n                _context5.next = 12;\n                break;\n              }\n              console.log(\'No stories to sync\');\n              return _context5.abrupt("return", {\n                success: true,\n                syncedIds: []\n              });\n            case 12:\n              syncedIds = [];\n              _iterator = _createForOfIteratorHelper(toSync);\n              _context5.prev = 14;\n              _iterator.s();\n            case 16:\n              if ((_step = _iterator.n()).done) {\n                _context5.next = 42;\n                break;\n              }\n              story = _step.value;\n              _context5.prev = 18;\n              console.log(\'Syncing story:\', story.id);\n              if (!story.photoBase64) {\n                _context5.next = 26;\n                break;\n              }\n              _context5.next = 23;\n              return this.base64ToBlob(story.photoBase64);\n            case 23:\n              _context5.t0 = _context5.sent;\n              _context5.next = 27;\n              break;\n            case 26:\n              _context5.t0 = story.originalPhoto;\n            case 27:\n              photoBlob = _context5.t0;\n              _context5.next = 30;\n              return api_addStory({\n                description: story.description,\n                photo: photoBlob,\n                lat: story.lat,\n                lon: story.lon\n              }, token);\n            case 30:\n              response = _context5.sent;\n              if (response.error) {\n                _context5.next = 35;\n                break;\n              }\n              _context5.next = 34;\n              return database_deleteStoryOffline(story.id);\n            case 34:\n              syncedIds.push(story.id);\n            case 35:\n              _context5.next = 40;\n              break;\n            case 37:\n              _context5.prev = 37;\n              _context5.t1 = _context5["catch"](18);\n              console.error("Failed to sync ".concat(story.id, ":"), _context5.t1);\n            case 40:\n              _context5.next = 16;\n              break;\n            case 42:\n              _context5.next = 47;\n              break;\n            case 44:\n              _context5.prev = 44;\n              _context5.t2 = _context5["catch"](14);\n              _iterator.e(_context5.t2);\n            case 47:\n              _context5.prev = 47;\n              _iterator.f();\n              return _context5.finish(47);\n            case 50:\n              return _context5.abrupt("return", {\n                success: syncedIds.length > 0,\n                syncedIds: syncedIds\n              });\n            case 53:\n              _context5.prev = 53;\n              _context5.t3 = _context5["catch"](0);\n              console.error(\'Sync error:\', _context5.t3);\n              return _context5.abrupt("return", {\n                success: false,\n                error: _context5.t3\n              });\n            case 57:\n            case "end":\n              return _context5.stop();\n          }\n        }, _callee5, this, [[0, 53], [14, 44, 47, 50], [18, 37]]);\n      }));\n      function syncOfflineStories(_x4) {\n        return _syncOfflineStories.apply(this, arguments);\n      }\n      return syncOfflineStories;\n    }()\n  }, {\n    key: "base64ToBlob",\n    value: function () {\n      var _base64ToBlob = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee6(base64) {\n        var response;\n        return regenerator_default().wrap(function _callee6$(_context6) {\n          while (1) switch (_context6.prev = _context6.next) {\n            case 0:\n              _context6.next = 2;\n              return fetch(base64);\n            case 2:\n              response = _context6.sent;\n              _context6.next = 5;\n              return response.blob();\n            case 5:\n              return _context6.abrupt("return", _context6.sent);\n            case 6:\n            case "end":\n              return _context6.stop();\n          }\n        }, _callee6);\n      }));\n      function base64ToBlob(_x5) {\n        return _base64ToBlob.apply(this, arguments);\n      }\n      return base64ToBlob;\n    }()\n  }, {\n    key: "getOfflineStories",\n    value: function () {\n      var _getOfflineStories = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee7() {\n        var allStories;\n        return regenerator_default().wrap(function _callee7$(_context7) {\n          while (1) switch (_context7.prev = _context7.next) {\n            case 0:\n              _context7.next = 2;\n              return getStories();\n            case 2:\n              allStories = _context7.sent;\n              return _context7.abrupt("return", allStories.filter(function (story) {\n                return story.isOffline;\n              }));\n            case 4:\n            case "end":\n              return _context7.stop();\n          }\n        }, _callee7);\n      }));\n      function getOfflineStories() {\n        return _getOfflineStories.apply(this, arguments);\n      }\n      return getOfflineStories;\n    }()\n  }, {\n    key: "deleteStoryOffline",\n    value: function () {\n      var _deleteStoryOffline2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee8(id) {\n        return regenerator_default().wrap(function _callee8$(_context8) {\n          while (1) switch (_context8.prev = _context8.next) {\n            case 0:\n              _context8.next = 2;\n              return database_deleteStoryOffline(id);\n            case 2:\n              return _context8.abrupt("return", _context8.sent);\n            case 3:\n            case "end":\n              return _context8.stop();\n          }\n        }, _callee8);\n      }));\n      function deleteStoryOffline(_x6) {\n        return _deleteStoryOffline2.apply(this, arguments);\n      }\n      return deleteStoryOffline;\n    }()\n  }]);\n}();\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.function.bind.js\nvar es_function_bind = __webpack_require__(4170);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array-buffer.constructor.js\nvar es_array_buffer_constructor = __webpack_require__(4743);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array-buffer.slice.js\nvar es_array_buffer_slice = __webpack_require__(1745);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.data-view.js\nvar es_data_view = __webpack_require__(8309);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.string.repeat.js\nvar es_string_repeat = __webpack_require__(2781);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.string.replace.js\nvar es_string_replace = __webpack_require__(5440);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.uint8-array.js\nvar es_typed_array_uint8_array = __webpack_require__(1489);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.copy-within.js\nvar es_typed_array_copy_within = __webpack_require__(1630);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.every.js\nvar es_typed_array_every = __webpack_require__(2170);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.fill.js\nvar es_typed_array_fill = __webpack_require__(5044);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.filter.js\nvar es_typed_array_filter = __webpack_require__(1920);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.find.js\nvar es_typed_array_find = __webpack_require__(1694);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.find-index.js\nvar es_typed_array_find_index = __webpack_require__(9955);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.for-each.js\nvar es_typed_array_for_each = __webpack_require__(3206);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.includes.js\nvar es_typed_array_includes = __webpack_require__(4496);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.index-of.js\nvar es_typed_array_index_of = __webpack_require__(6651);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.iterator.js\nvar es_typed_array_iterator = __webpack_require__(2887);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.join.js\nvar es_typed_array_join = __webpack_require__(9369);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.last-index-of.js\nvar es_typed_array_last_index_of = __webpack_require__(6812);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.map.js\nvar es_typed_array_map = __webpack_require__(8995);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.reduce.js\nvar es_typed_array_reduce = __webpack_require__(1575);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.reduce-right.js\nvar es_typed_array_reduce_right = __webpack_require__(6072);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.reverse.js\nvar es_typed_array_reverse = __webpack_require__(8747);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.set.js\nvar es_typed_array_set = __webpack_require__(8845);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.slice.js\nvar es_typed_array_slice = __webpack_require__(9423);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.some.js\nvar es_typed_array_some = __webpack_require__(7301);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.sort.js\nvar es_typed_array_sort = __webpack_require__(373);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.subarray.js\nvar es_typed_array_subarray = __webpack_require__(6614);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.to-locale-string.js\nvar es_typed_array_to_locale_string = __webpack_require__(1405);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.to-string.js\nvar es_typed_array_to_string = __webpack_require__(3684);\n;// ./src/utils/config.js\nvar VAPID_PUBLIC_KEY = "BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk";\n;// ./src/utils/notification.js\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar requestNotificationPermission = /*#__PURE__*/function () {\n  var _ref = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee() {\n    var permission;\n    return regenerator_default().wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          if ("Notification" in window) {\n            _context.next = 3;\n            break;\n          }\n          console.log("This browser does not support notifications.");\n          return _context.abrupt("return", false);\n        case 3:\n          if (!(Notification.permission === "granted")) {\n            _context.next = 5;\n            break;\n          }\n          return _context.abrupt("return", true);\n        case 5:\n          _context.next = 7;\n          return Notification.requestPermission();\n        case 7:\n          permission = _context.sent;\n          return _context.abrupt("return", permission === "granted");\n        case 9:\n        case "end":\n          return _context.stop();\n      }\n    }, _callee);\n  }));\n  return function requestNotificationPermission() {\n    return _ref.apply(this, arguments);\n  };\n}();\nvar subscribeUser = /*#__PURE__*/function () {\n  var _ref2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2(token) {\n    var registration, subscription, result;\n    return regenerator_default().wrap(function _callee2$(_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          if ("serviceWorker" in navigator) {\n            _context2.next = 3;\n            break;\n          }\n          console.log("Service Worker not supported");\n          return _context2.abrupt("return", null);\n        case 3:\n          _context2.next = 5;\n          return navigator.serviceWorker.ready;\n        case 5:\n          registration = _context2.sent;\n          _context2.next = 8;\n          return registration.pushManager.getSubscription();\n        case 8:\n          subscription = _context2.sent;\n          if (subscription) {\n            _context2.next = 32;\n            break;\n          }\n          _context2.prev = 10;\n          _context2.next = 13;\n          return registration.pushManager.subscribe({\n            userVisibleOnly: true,\n            applicationServerKey: urlBase64ToUint8Array(VAPID_PUBLIC_KEY)\n          });\n        case 13:\n          subscription = _context2.sent;\n          _context2.next = 16;\n          return subscribeToNotifications({\n            endpoint: subscription.endpoint,\n            keys: {\n              p256dh: arrayBufferToBase64(subscription.getKey(\'p256dh\')),\n              auth: arrayBufferToBase64(subscription.getKey(\'auth\'))\n            }\n          }, token);\n        case 16:\n          result = _context2.sent;\n          if (result.error) {\n            _context2.next = 22;\n            break;\n          }\n          console.log("User is subscribed.");\n          return _context2.abrupt("return", subscription);\n        case 22:\n          console.error("Subscription failed:", result.message);\n          _context2.next = 25;\n          return subscription.unsubscribe();\n        case 25:\n          return _context2.abrupt("return", null);\n        case 26:\n          _context2.next = 32;\n          break;\n        case 28:\n          _context2.prev = 28;\n          _context2.t0 = _context2["catch"](10);\n          console.error("Error subscribing user:", _context2.t0);\n          return _context2.abrupt("return", null);\n        case 32:\n          return _context2.abrupt("return", subscription);\n        case 33:\n        case "end":\n          return _context2.stop();\n      }\n    }, _callee2, null, [[10, 28]]);\n  }));\n  return function subscribeUser(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nvar unsubscribeUser = /*#__PURE__*/function () {\n  var _ref3 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee3(token) {\n    var registration, subscription, result;\n    return regenerator_default().wrap(function _callee3$(_context3) {\n      while (1) switch (_context3.prev = _context3.next) {\n        case 0:\n          _context3.next = 2;\n          return navigator.serviceWorker.ready;\n        case 2:\n          registration = _context3.sent;\n          _context3.next = 5;\n          return registration.pushManager.getSubscription();\n        case 5:\n          subscription = _context3.sent;\n          if (!subscription) {\n            _context3.next = 23;\n            break;\n          }\n          _context3.prev = 7;\n          _context3.next = 10;\n          return unsubscribeFromNotifications(subscription.endpoint, token);\n        case 10:\n          result = _context3.sent;\n          if (result.error) {\n            _context3.next = 16;\n            break;\n          }\n          _context3.next = 14;\n          return subscription.unsubscribe();\n        case 14:\n          console.log("User is unsubscribed.");\n          return _context3.abrupt("return", true);\n        case 16:\n          return _context3.abrupt("return", false);\n        case 19:\n          _context3.prev = 19;\n          _context3.t0 = _context3["catch"](7);\n          console.error("Error unsubscribing user:", _context3.t0);\n          return _context3.abrupt("return", false);\n        case 23:\n          return _context3.abrupt("return", false);\n        case 24:\n        case "end":\n          return _context3.stop();\n      }\n    }, _callee3, null, [[7, 19]]);\n  }));\n  return function unsubscribeUser(_x2) {\n    return _ref3.apply(this, arguments);\n  };\n}();\nvar showNotificationPrompt = /*#__PURE__*/function () {\n  var _ref4 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee4(callback) {\n    var permission;\n    return regenerator_default().wrap(function _callee4$(_context4) {\n      while (1) switch (_context4.prev = _context4.next) {\n        case 0:\n          if ("Notification" in window) {\n            _context4.next = 4;\n            break;\n          }\n          console.log("This browser does not support notifications.");\n          if (callback) callback(false);\n          return _context4.abrupt("return", false);\n        case 4:\n          if (!(Notification.permission === "granted")) {\n            _context4.next = 7;\n            break;\n          }\n          if (callback) callback(true);\n          return _context4.abrupt("return", true);\n        case 7:\n          if (!(Notification.permission === "denied")) {\n            _context4.next = 11;\n            break;\n          }\n          console.log("Notification permission has been denied.");\n          if (callback) callback(false);\n          return _context4.abrupt("return", false);\n        case 11:\n          if (!(Notification.permission === "default")) {\n            _context4.next = 17;\n            break;\n          }\n          _context4.next = 14;\n          return Notification.requestPermission();\n        case 14:\n          permission = _context4.sent;\n          if (callback) callback(permission === "granted");\n          return _context4.abrupt("return", permission === "granted");\n        case 17:\n        case "end":\n          return _context4.stop();\n      }\n    }, _callee4);\n  }));\n  return function showNotificationPrompt(_x3) {\n    return _ref4.apply(this, arguments);\n  };\n}();\nfunction urlBase64ToUint8Array(base64String) {\n  var padding = \'=\'.repeat((4 - base64String.length % 4) % 4);\n  var base64 = (base64String + padding).replace(/-/g, \'+\').replace(/_/g, \'/\');\n  var rawData = atob(base64);\n  var outputArray = new Uint8Array(rawData.length);\n  for (var i = 0; i < rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i);\n  }\n  return outputArray;\n}\nfunction arrayBufferToBase64(buffer) {\n  var binary = \'\';\n  var bytes = new Uint8Array(buffer);\n  for (var i = 0; i < bytes.byteLength; i++) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return btoa(binary);\n}\n;// ./src/presenters/AuthPresenter.js\n\n\n\n\n\n\n\nvar AuthPresenter = /*#__PURE__*/function () {\n  function AuthPresenter(authModel, authView, router) {\n    (0,classCallCheck/* default */.A)(this, AuthPresenter);\n    this.authModel = authModel;\n    this.authView = authView;\n    this.router = router;\n\n    // Initialize UI state\n    updateAuthUI(this.authModel.isAuthenticated());\n    if (authView.bindLogin) {\n      authView.bindLogin(this.handleLogin.bind(this));\n    }\n    if (authView.bindRegister) {\n      authView.bindRegister(this.handleRegister.bind(this));\n    }\n  }\n  return (0,createClass/* default */.A)(AuthPresenter, [{\n    key: "handleLogin",\n    value: function () {\n      var _handleLogin = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2(email, password) {\n        var result, notificationPromise, _this$authView$showEr, _this$authView, _this$authView$showEr2, _this$authView2;\n        return regenerator_default().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 3;\n              return this.authModel.login(email, password);\n            case 3:\n              result = _context2.sent;\n              if (!result.success) {\n                _context2.next = 12;\n                break;\n              }\n              updateAuthUI(true); // Update UI state immediately\n\n              // Start both operations but don\'t await notification setup\n              notificationPromise = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee() {\n                var permissionGranted;\n                return regenerator_default().wrap(function _callee$(_context) {\n                  while (1) switch (_context.prev = _context.next) {\n                    case 0:\n                      _context.prev = 0;\n                      _context.next = 3;\n                      return requestNotificationPermission();\n                    case 3:\n                      permissionGranted = _context.sent;\n                      if (!permissionGranted) {\n                        _context.next = 7;\n                        break;\n                      }\n                      _context.next = 7;\n                      return subscribeUser(result.token);\n                    case 7:\n                      _context.next = 12;\n                      break;\n                    case 9:\n                      _context.prev = 9;\n                      _context.t0 = _context["catch"](0);\n                      console.error("Notification error:", _context.t0);\n                    case 12:\n                    case "end":\n                      return _context.stop();\n                  }\n                }, _callee, null, [[0, 9]]);\n              }))(); // Navigate immediately without waiting for notifications\n              this.router.navigateTo("/stories");\n\n              // Let notifications complete in background\n              _context2.next = 10;\n              return notificationPromise;\n            case 10:\n              _context2.next = 13;\n              break;\n            case 12:\n              (_this$authView$showEr = (_this$authView = this.authView).showError) === null || _this$authView$showEr === void 0 || _this$authView$showEr.call(_this$authView, result.message);\n            case 13:\n              _context2.next = 18;\n              break;\n            case 15:\n              _context2.prev = 15;\n              _context2.t0 = _context2["catch"](0);\n              (_this$authView$showEr2 = (_this$authView2 = this.authView).showError) === null || _this$authView$showEr2 === void 0 || _this$authView$showEr2.call(_this$authView2, _context2.t0.message);\n            case 18:\n            case "end":\n              return _context2.stop();\n          }\n        }, _callee2, this, [[0, 15]]);\n      }));\n      function handleLogin(_x, _x2) {\n        return _handleLogin.apply(this, arguments);\n      }\n      return handleLogin;\n    }()\n  }, {\n    key: "handleLogout",\n    value: function () {\n      var _handleLogout = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee3() {\n        var token;\n        return regenerator_default().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              // Unsubscribe from notifications before logout\n              token = this.authModel.getToken();\n              if (!token) {\n                _context3.next = 5;\n                break;\n              }\n              _context3.next = 5;\n              return unsubscribeUser(token);\n            case 5:\n              _context3.next = 10;\n              break;\n            case 7:\n              _context3.prev = 7;\n              _context3.t0 = _context3["catch"](0);\n              console.error("Error unsubscribing:", _context3.t0);\n            case 10:\n              _context3.prev = 10;\n              this.authModel.logout();\n              updateAuthUI(false);\n              this.router.navigateTo("/login");\n              return _context3.finish(10);\n            case 15:\n            case "end":\n              return _context3.stop();\n          }\n        }, _callee3, this, [[0, 7, 10, 15]]);\n      }));\n      function handleLogout() {\n        return _handleLogout.apply(this, arguments);\n      }\n      return handleLogout;\n    }()\n  }, {\n    key: "handleRegister",\n    value: function () {\n      var _handleRegister = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee4(name, email, password) {\n        var result, _this$authView$showSu, _this$authView3, _this$authView$showEr3, _this$authView4, _this$authView$showEr4, _this$authView5;\n        return regenerator_default().wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.prev = 0;\n              _context4.next = 3;\n              return this.authModel.register(name, email, password);\n            case 3:\n              result = _context4.sent;\n              if (result.success) {\n                (_this$authView$showSu = (_this$authView3 = this.authView).showSuccess) === null || _this$authView$showSu === void 0 || _this$authView$showSu.call(_this$authView3, "Registration successful. Please login.");\n                this.router.navigateTo("/login");\n              } else {\n                (_this$authView$showEr3 = (_this$authView4 = this.authView).showError) === null || _this$authView$showEr3 === void 0 || _this$authView$showEr3.call(_this$authView4, result.message);\n              }\n              _context4.next = 10;\n              break;\n            case 7:\n              _context4.prev = 7;\n              _context4.t0 = _context4["catch"](0);\n              (_this$authView$showEr4 = (_this$authView5 = this.authView).showError) === null || _this$authView$showEr4 === void 0 || _this$authView$showEr4.call(_this$authView5, _context4.t0.message);\n            case 10:\n            case "end":\n              return _context4.stop();\n          }\n        }, _callee4, this, [[0, 7]]);\n      }));\n      function handleRegister(_x3, _x4, _x5) {\n        return _handleRegister.apply(this, arguments);\n      }\n      return handleRegister;\n    }()\n  }]);\n}();\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.set.js\nvar es_set = __webpack_require__(1415);\n;// ./src/presenters/StoryPresenter.js\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar StoryPresenter = /*#__PURE__*/function () {\n  function StoryPresenter(storyModel, storyView, router) {\n    (0,classCallCheck/* default */.A)(this, StoryPresenter);\n    this.storyModel = storyModel;\n    this.storyView = storyView;\n    this.router = router;\n    this.currentStoryId = null;\n    this.isLoading = false;\n    this.mapInitialized = false;\n\n    // Sync management\n    this.isSyncing = false;\n    this.pendingSyncIds = new Set();\n    this.syncQueue = new Set();\n    this.initializeEventBindings();\n    this.initializeSyncHandlers();\n    this.startSyncMonitor();\n  }\n  return (0,createClass/* default */.A)(StoryPresenter, [{\n    key: "initializeEventBindings",\n    value: function initializeEventBindings() {\n      if (this.storyView.bindLoadStories) {\n        this.storyView.bindLoadStories(this.handleLoadStories.bind(this));\n      }\n      if (this.storyView.bindAddStory) {\n        this.storyView.bindAddStory(this.handleAddStory.bind(this));\n      }\n      if (this.storyView.bindLoadStoryDetail) {\n        this.storyView.bindLoadStoryDetail(this.handleLoadStoryDetail.bind(this));\n      }\n    }\n  }, {\n    key: "initializeSyncHandlers",\n    value: function initializeSyncHandlers() {\n      // Load existing offline stories into queue\n      this.loadOfflineStoriesIntoQueue();\n\n      // Set up event listeners\n      window.addEventListener(\'online\', this.handleConnectionChange.bind(this));\n      window.addEventListener(\'focus\', this.handleFocus.bind(this));\n    }\n  }, {\n    key: "loadOfflineStoriesIntoQueue",\n    value: function () {\n      var _loadOfflineStoriesIntoQueue = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee() {\n        var _this = this;\n        var offlineStories;\n        return regenerator_default().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return this.storyModel.getOfflineStories();\n            case 3:\n              offlineStories = _context.sent;\n              offlineStories.forEach(function (story) {\n                return _this.syncQueue.add(story.id);\n              });\n              console.log(\'Initial sync queue:\', Array.from(this.syncQueue));\n\n              // Trigger sync if we\'re already online\n              if (navigator.onLine) {\n                this.handleOnline();\n              }\n              _context.next = 12;\n              break;\n            case 9:\n              _context.prev = 9;\n              _context.t0 = _context["catch"](0);\n              console.error(\'Failed to load offline stories:\', _context.t0);\n            case 12:\n            case "end":\n              return _context.stop();\n          }\n        }, _callee, this, [[0, 9]]);\n      }));\n      function loadOfflineStoriesIntoQueue() {\n        return _loadOfflineStoriesIntoQueue.apply(this, arguments);\n      }\n      return loadOfflineStoriesIntoQueue;\n    }()\n  }, {\n    key: "handleConnectionChange",\n    value: function handleConnectionChange() {\n      var _this2 = this;\n      if (navigator.onLine) {\n        console.log(\'Connection restored - triggering sync\');\n        setTimeout(function () {\n          return _this2.handleOnline();\n        }, 1000);\n      }\n    }\n  }, {\n    key: "handleFocus",\n    value: function handleFocus() {\n      if (navigator.onLine && this.syncQueue.size > 0) {\n        console.log(\'Window focused - checking sync\');\n        this.handleOnline();\n      }\n    }\n  }, {\n    key: "startSyncMonitor",\n    value: function startSyncMonitor() {\n      var _this3 = this;\n      setInterval(function () {\n        console.log(\'Sync Monitor:\', {\n          isSyncing: _this3.isSyncing,\n          queueSize: _this3.syncQueue.size,\n          queueContents: Array.from(_this3.syncQueue),\n          pendingSyncs: Array.from(_this3.pendingSyncIds)\n        });\n      }, 10000);\n    }\n  }, {\n    key: "handleLoadStories",\n    value: function () {\n      var _handleLoadStories = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2() {\n        var page,\n          size,\n          result,\n          _this$storyView$showO,\n          _this$storyView,\n          _this$storyView$displ,\n          _this$storyView2,\n          _this$storyView$showE,\n          _this$storyView3,\n          _this$storyView$showE2,\n          _this$storyView4,\n          _args2 = arguments;\n        return regenerator_default().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              page = _args2.length > 0 && _args2[0] !== undefined ? _args2[0] : 1;\n              size = _args2.length > 1 && _args2[1] !== undefined ? _args2[1] : 10;\n              _context2.prev = 2;\n              _context2.next = 5;\n              return this.storyModel.getAllStories(page, size);\n            case 5:\n              result = _context2.sent;\n              if (result.isOffline) {\n                (_this$storyView$showO = (_this$storyView = this.storyView).showOfflineWarning) === null || _this$storyView$showO === void 0 || _this$storyView$showO.call(_this$storyView);\n              }\n              if (result.success) {\n                (_this$storyView$displ = (_this$storyView2 = this.storyView).displayStories) === null || _this$storyView$displ === void 0 || _this$storyView$displ.call(_this$storyView2, result.stories || []);\n              } else {\n                (_this$storyView$showE = (_this$storyView3 = this.storyView).showError) === null || _this$storyView$showE === void 0 || _this$storyView$showE.call(_this$storyView3, result.message || "Failed to load stories");\n              }\n              _context2.next = 14;\n              break;\n            case 10:\n              _context2.prev = 10;\n              _context2.t0 = _context2["catch"](2);\n              console.error("Load stories error:", _context2.t0);\n              (_this$storyView$showE2 = (_this$storyView4 = this.storyView).showError) === null || _this$storyView$showE2 === void 0 || _this$storyView$showE2.call(_this$storyView4, "Failed to load stories. Please try again.");\n            case 14:\n            case "end":\n              return _context2.stop();\n          }\n        }, _callee2, this, [[2, 10]]);\n      }));\n      function handleLoadStories() {\n        return _handleLoadStories.apply(this, arguments);\n      }\n      return handleLoadStories;\n    }()\n  }, {\n    key: "handleLoadStoryDetail",\n    value: function () {\n      var _handleLoadStoryDetail = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee3(id) {\n        var _this$storyView$prepa, _this$storyView5, result, _this$storyView$displ2, _this$storyView6, _this$storyView$showE3, _this$storyView7, _this$storyView$showE4, _this$storyView8;\n        return regenerator_default().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              if (!(this.isLoading || this.currentStoryId === id)) {\n                _context3.next = 3;\n                break;\n              }\n              return _context3.abrupt("return");\n            case 3:\n              this.isLoading = true;\n              this.currentStoryId = id;\n              (_this$storyView$prepa = (_this$storyView5 = this.storyView).prepareMapContainer) === null || _this$storyView$prepa === void 0 || _this$storyView$prepa.call(_this$storyView5);\n              _context3.next = 8;\n              return this.storyModel.getStoryDetail(id);\n            case 8:\n              result = _context3.sent;\n              if (!result.success) {\n                _context3.next = 15;\n                break;\n              }\n              _context3.next = 12;\n              return new Promise(function (resolve) {\n                return requestAnimationFrame(resolve);\n              });\n            case 12:\n              (_this$storyView$displ2 = (_this$storyView6 = this.storyView).displayStoryDetail) === null || _this$storyView$displ2 === void 0 || _this$storyView$displ2.call(_this$storyView6, result.story);\n              _context3.next = 17;\n              break;\n            case 15:\n              (_this$storyView$showE3 = (_this$storyView7 = this.storyView).showError) === null || _this$storyView$showE3 === void 0 || _this$storyView$showE3.call(_this$storyView7, result.message || "Story not found");\n              this.router.navigateTo("/stories");\n            case 17:\n              _context3.next = 24;\n              break;\n            case 19:\n              _context3.prev = 19;\n              _context3.t0 = _context3["catch"](0);\n              console.error("Load story detail error:", _context3.t0);\n              (_this$storyView$showE4 = (_this$storyView8 = this.storyView).showError) === null || _this$storyView$showE4 === void 0 || _this$storyView$showE4.call(_this$storyView8, "Failed to load story details");\n              this.router.navigateTo("/stories");\n            case 24:\n              _context3.prev = 24;\n              this.isLoading = false;\n              return _context3.finish(24);\n            case 27:\n            case "end":\n              return _context3.stop();\n          }\n        }, _callee3, this, [[0, 19, 24, 27]]);\n      }));\n      function handleLoadStoryDetail(_x) {\n        return _handleLoadStoryDetail.apply(this, arguments);\n      }\n      return handleLoadStoryDetail;\n    }()\n  }, {\n    key: "handleAddStory",\n    value: function () {\n      var _handleAddStory = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee4(data) {\n        var result, _this$storyView$showE5, _this$storyView9;\n        return regenerator_default().wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.prev = 0;\n              _context4.next = 3;\n              return this.storyModel.addStory(data);\n            case 3:\n              result = _context4.sent;\n              if (!result.success) {\n                _context4.next = 8;\n                break;\n              }\n              this.handleAddSuccess(data);\n              _context4.next = 14;\n              break;\n            case 8:\n              if (!(!result.success && !navigator.onLine)) {\n                _context4.next = 13;\n                break;\n              }\n              _context4.next = 11;\n              return this.handleOfflineAdd(data);\n            case 11:\n              _context4.next = 14;\n              break;\n            case 13:\n              (_this$storyView$showE5 = (_this$storyView9 = this.storyView).showError) === null || _this$storyView$showE5 === void 0 || _this$storyView$showE5.call(_this$storyView9, result.message || "Failed to add story");\n            case 14:\n              _context4.next = 19;\n              break;\n            case 16:\n              _context4.prev = 16;\n              _context4.t0 = _context4["catch"](0);\n              this.handleAddError(_context4.t0);\n            case 19:\n            case "end":\n              return _context4.stop();\n          }\n        }, _callee4, this, [[0, 16]]);\n      }));\n      function handleAddStory(_x2) {\n        return _handleAddStory.apply(this, arguments);\n      }\n      return handleAddStory;\n    }()\n  }, {\n    key: "handleAddSuccess",\n    value: function () {\n      var _handleAddSuccess = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee6(data) {\n        var _this$storyView$showS,\n          _this$storyView0,\n          _this4 = this;\n        return regenerator_default().wrap(function _callee6$(_context6) {\n          while (1) switch (_context6.prev = _context6.next) {\n            case 0:\n              (_this$storyView$showS = (_this$storyView0 = this.storyView).showSuccess) === null || _this$storyView$showS === void 0 || _this$storyView$showS.call(_this$storyView0, "Story added successfully!");\n              _context6.next = 3;\n              return showNotificationPrompt(/*#__PURE__*/function () {\n                var _ref = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee5(granted) {\n                  return regenerator_default().wrap(function _callee5$(_context5) {\n                    while (1) switch (_context5.prev = _context5.next) {\n                      case 0:\n                        if (granted) {\n                          new Notification("Story created", {\n                            body: "New story: ".concat(data.description.substring(0, 50), "..."),\n                            icon: "/assets/images/icon-192x192.png"\n                          });\n                        }\n                      case 1:\n                      case "end":\n                        return _context5.stop();\n                    }\n                  }, _callee5);\n                }));\n                return function (_x4) {\n                  return _ref.apply(this, arguments);\n                };\n              }());\n            case 3:\n              this.cleanup();\n              setTimeout(function () {\n                _this4.handleLoadStories();\n                _this4.router.navigateTo("/stories");\n              }, 1500);\n            case 5:\n            case "end":\n              return _context6.stop();\n          }\n        }, _callee6, this);\n      }));\n      function handleAddSuccess(_x3) {\n        return _handleAddSuccess.apply(this, arguments);\n      }\n      return handleAddSuccess;\n    }()\n  }, {\n    key: "handleOfflineAdd",\n    value: function () {\n      var _handleOfflineAdd = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee8(data) {\n        var _this5 = this;\n        var _this$storyView$showS2, _this$storyView1, offlineResult, _this$storyView$showE6, _this$storyView10;\n        return regenerator_default().wrap(function _callee8$(_context8) {\n          while (1) switch (_context8.prev = _context8.next) {\n            case 0:\n              _context8.prev = 0;\n              _context8.next = 3;\n              return this.storyModel.addStoryOffline(data);\n            case 3:\n              offlineResult = _context8.sent;\n              this.syncQueue.add(offlineResult.story.id);\n              _context8.next = 7;\n              return showNotificationPrompt(/*#__PURE__*/function () {\n                var _ref2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee7(granted) {\n                  return regenerator_default().wrap(function _callee7$(_context7) {\n                    while (1) switch (_context7.prev = _context7.next) {\n                      case 0:\n                        if (granted) {\n                          new Notification("Story Saved Offline", {\n                            body: "Will upload when you\'re back online",\n                            icon: "/assets/images/icon-192x192.png"\n                          });\n                        }\n                      case 1:\n                      case "end":\n                        return _context7.stop();\n                    }\n                  }, _callee7);\n                }));\n                return function (_x6) {\n                  return _ref2.apply(this, arguments);\n                };\n              }());\n            case 7:\n              (_this$storyView$showS2 = (_this$storyView1 = this.storyView).showSuccess) === null || _this$storyView$showS2 === void 0 || _this$storyView$showS2.call(_this$storyView1, "Story saved offline. Will sync when online!");\n              setTimeout(function () {\n                _this5.handleLoadStories();\n                _this5.router.navigateTo("/stories");\n              }, 1500);\n              _context8.next = 15;\n              break;\n            case 11:\n              _context8.prev = 11;\n              _context8.t0 = _context8["catch"](0);\n              console.error("Offline save failed:", _context8.t0);\n              (_this$storyView$showE6 = (_this$storyView10 = this.storyView).showError) === null || _this$storyView$showE6 === void 0 || _this$storyView$showE6.call(_this$storyView10, "Failed to save story offline.");\n            case 15:\n            case "end":\n              return _context8.stop();\n          }\n        }, _callee8, this, [[0, 11]]);\n      }));\n      function handleOfflineAdd(_x5) {\n        return _handleOfflineAdd.apply(this, arguments);\n      }\n      return handleOfflineAdd;\n    }()\n  }, {\n    key: "handleAddError",\n    value: function handleAddError(error) {\n      console.error("Add story error:", error);\n      if (!navigator.onLine) {\n        var _this$storyView$showE7, _this$storyView11;\n        (_this$storyView$showE7 = (_this$storyView11 = this.storyView).showError) === null || _this$storyView$showE7 === void 0 || _this$storyView$showE7.call(_this$storyView11, "You\'re offline. Please connect to submit stories.");\n      } else {\n        var _this$storyView$showE8, _this$storyView12;\n        (_this$storyView$showE8 = (_this$storyView12 = this.storyView).showError) === null || _this$storyView$showE8 === void 0 || _this$storyView$showE8.call(_this$storyView12, "Failed to add story. Please try again.");\n      }\n    }\n  }, {\n    key: "handleOnline",\n    value: function () {\n      var _handleOnline = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee9() {\n        var _this6 = this;\n        var syncResult, _this$storyView$showS3, _this$storyView13;\n        return regenerator_default().wrap(function _callee9$(_context9) {\n          while (1) switch (_context9.prev = _context9.next) {\n            case 0:\n              if (!(this.isSyncing || this.syncQueue.size === 0)) {\n                _context9.next = 2;\n                break;\n              }\n              return _context9.abrupt("return");\n            case 2:\n              console.log(\'Starting sync with queue:\', Array.from(this.syncQueue));\n              this.isSyncing = true;\n              _context9.prev = 4;\n              _context9.next = 7;\n              return this.storyModel.syncOfflineStories(this.syncQueue);\n            case 7:\n              syncResult = _context9.sent;\n              console.log(\'Sync completed:\', syncResult);\n              if (syncResult.success && syncResult.syncedIds.length > 0) {\n                syncResult.syncedIds.forEach(function (id) {\n                  _this6.syncQueue["delete"](id);\n                  _this6.pendingSyncIds["delete"](id);\n                });\n                (_this$storyView$showS3 = (_this$storyView13 = this.storyView).showSuccess) === null || _this$storyView$showS3 === void 0 || _this$storyView$showS3.call(_this$storyView13, "Synced ".concat(syncResult.syncedIds.length, " stories!"));\n                this.handleLoadStories();\n              }\n              _context9.next = 15;\n              break;\n            case 12:\n              _context9.prev = 12;\n              _context9.t0 = _context9["catch"](4);\n              console.error(\'Sync failed:\', _context9.t0);\n            case 15:\n              _context9.prev = 15;\n              this.isSyncing = false;\n\n              // Retry if there are remaining stories\n              if (this.syncQueue.size > 0) {\n                setTimeout(function () {\n                  return _this6.handleOnline();\n                }, 5000);\n              }\n              return _context9.finish(15);\n            case 19:\n            case "end":\n              return _context9.stop();\n          }\n        }, _callee9, this, [[4, 12, 15, 19]]);\n      }));\n      function handleOnline() {\n        return _handleOnline.apply(this, arguments);\n      }\n      return handleOnline;\n    }()\n  }, {\n    key: "cleanup",\n    value: function cleanup() {\n      if (typeof this.storyView.cleanup === "function") {\n        this.storyView.cleanup();\n      }\n      this.currentStoryId = null;\n      this.isLoading = false;\n    }\n  }]);\n}();\n;// ./src/presenters/MapPresenter.js\n\n\n\n\n\n\nvar MapPresenter = /*#__PURE__*/function () {\n  function MapPresenter(mapView) {\n    (0,classCallCheck/* default */.A)(this, MapPresenter);\n    this.view = mapView;\n    this.currentPosition = null;\n  }\n  return (0,createClass/* default */.A)(MapPresenter, [{\n    key: "initializeMap",\n    value: function () {\n      var _initializeMap = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee(containerId) {\n        var options,\n          _options$lat,\n          lat,\n          _options$lng,\n          lng,\n          _options$zoom,\n          zoom,\n          _args = arguments;\n        return regenerator_default().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              options = _args.length > 1 && _args[1] !== undefined ? _args[1] : {};\n              _context.prev = 1;\n              _options$lat = options.lat, lat = _options$lat === void 0 ? 0 : _options$lat, _options$lng = options.lng, lng = _options$lng === void 0 ? 0 : _options$lng, _options$zoom = options.zoom, zoom = _options$zoom === void 0 ? 10 : _options$zoom;\n              _context.next = 5;\n              return this.view.initMap(containerId, lat, lng, zoom);\n            case 5:\n              return _context.abrupt("return", true);\n            case 8:\n              _context.prev = 8;\n              _context.t0 = _context["catch"](1);\n              console.error(\'Map initialization failed:\', _context.t0);\n              return _context.abrupt("return", false);\n            case 12:\n            case "end":\n              return _context.stop();\n          }\n        }, _callee, this, [[1, 8]]);\n      }));\n      function initializeMap(_x) {\n        return _initializeMap.apply(this, arguments);\n      }\n      return initializeMap;\n    }()\n  }, {\n    key: "getCurrentLocation",\n    value: function () {\n      var _getCurrentLocation = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2() {\n        var _this = this;\n        var options,\n          _args2 = arguments;\n        return regenerator_default().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              options = _args2.length > 0 && _args2[0] !== undefined ? _args2[0] : {};\n              return _context2.abrupt("return", new Promise(function (resolve, reject) {\n                if (!navigator.geolocation) {\n                  reject(new Error("Geolocation is not supported by your browser"));\n                  return;\n                }\n                navigator.geolocation.getCurrentPosition(function (position) {\n                  _this.currentPosition = {\n                    lat: position.coords.latitude,\n                    lng: position.coords.longitude,\n                    accuracy: position.coords.accuracy\n                  };\n                  resolve(_this.currentPosition);\n                }, function (error) {\n                  reject(error);\n                }, options);\n              }));\n            case 2:\n            case "end":\n              return _context2.stop();\n          }\n        }, _callee2);\n      }));\n      function getCurrentLocation() {\n        return _getCurrentLocation.apply(this, arguments);\n      }\n      return getCurrentLocation;\n    }()\n  }, {\n    key: "centerToCurrentLocation",\n    value: function () {\n      var _centerToCurrentLocation = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee3() {\n        var zoom,\n          _args3 = arguments;\n        return regenerator_default().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              zoom = _args3.length > 0 && _args3[0] !== undefined ? _args3[0] : 15;\n              _context3.prev = 1;\n              if (this.currentPosition) {\n                _context3.next = 5;\n                break;\n              }\n              _context3.next = 5;\n              return this.getCurrentLocation();\n            case 5:\n              this.view.setView(this.currentPosition.lat, this.currentPosition.lng, zoom);\n              return _context3.abrupt("return", this.currentPosition);\n            case 9:\n              _context3.prev = 9;\n              _context3.t0 = _context3["catch"](1);\n              console.error(\'Failed to center to current location:\', _context3.t0);\n              throw _context3.t0;\n            case 13:\n            case "end":\n              return _context3.stop();\n          }\n        }, _callee3, this, [[1, 9]]);\n      }));\n      function centerToCurrentLocation() {\n        return _centerToCurrentLocation.apply(this, arguments);\n      }\n      return centerToCurrentLocation;\n    }()\n  }, {\n    key: "addMarker",\n    value: function addMarker(lat, lng) {\n      var popupContent = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : "";\n      var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n      return this.view.addMarker(lat, lng, popupContent, options);\n    }\n  }, {\n    key: "addCurrentLocationMarker",\n    value: function addCurrentLocationMarker() {\n      var popupContent = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "";\n      if (!this.currentPosition) {\n        throw new Error(\'Current location not available\');\n      }\n      return this.addMarker(this.currentPosition.lat, this.currentPosition.lng, popupContent, {\n        title: \'Your Location\'\n      });\n    }\n  }, {\n    key: "clearMarkers",\n    value: function clearMarkers() {\n      this.view.clearMarkers();\n    }\n  }, {\n    key: "setOnMapClickHandler",\n    value: function setOnMapClickHandler(handler) {\n      this.view.onMapClick(function (e) {\n        handler(e.latlng.lat, e.latlng.lng);\n      });\n    }\n  }, {\n    key: "cleanup",\n    value: function cleanup() {\n      this.view.remove();\n    }\n  }, {\n    key: "handleLocationSelection",\n    value: function handleLocationSelection(lat, lng) {\n      this.clearMarkers(); // Clear existing markers\n      this.addMarker(lat, lng, "Selected Location", {\n        draggable: true,\n        color: \'red\'\n      });\n      this.view.setView(lat, lng, 15);\n    }\n  }]);\n}();\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.string.includes.js\nvar es_string_includes = __webpack_require__(1699);\n;// ./src/utils/SkipToContent.js\n\n\n\n\n\nvar currentSkipTarget = null;\nvar resetSkipToContent = function resetSkipToContent() {\n  if (currentSkipTarget) {\n    var _currentSkipTarget$cl;\n    (_currentSkipTarget$cl = currentSkipTarget.classList) === null || _currentSkipTarget$cl === void 0 || _currentSkipTarget$cl.remove(\'focus-visible\');\n    currentSkipTarget.removeAttribute(\'tabindex\');\n    currentSkipTarget = null;\n  }\n};\nvar handleSkipToContent = /*#__PURE__*/function () {\n  var _ref = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee() {\n    var mainContent;\n    return regenerator_default().wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          _context.next = 2;\n          return new Promise(function (resolve) {\n            return requestAnimationFrame(resolve);\n          });\n        case 2:\n          mainContent = document.getElementById(\'main-content\');\n          if (mainContent) {\n            _context.next = 5;\n            break;\n          }\n          return _context.abrupt("return");\n        case 5:\n          resetSkipToContent();\n          mainContent.classList.add(\'focus-visible\');\n          mainContent.focus({\n            preventScroll: true\n          });\n          setTimeout(function () {\n            mainContent.classList.remove(\'focus-visible\');\n          }, 2000);\n        case 9:\n        case "end":\n          return _context.stop();\n      }\n    }, _callee);\n  }));\n  return function handleSkipToContent() {\n    return _ref.apply(this, arguments);\n  };\n}();\nvar initializeSkipToContent = function initializeSkipToContent() {\n  var existingSkipLink = document.querySelector(\'.skip-link\');\n  if (existingSkipLink) existingSkipLink.remove();\n  var skipLink = document.createElement(\'a\');\n  skipLink.href = \'#main-content\';\n  skipLink.className = \'skip-link\';\n  skipLink.textContent = \'Skip to content\';\n  skipLink.style.cssText = "\\n    position: fixed;\\n    top: -40px;\\n    left: 1rem;\\n    background: #000;\\n    color: white;\\n    padding: 8px 12px;\\n    border-radius: 0 0 4px 4px;\\n    z-index: 9999;\\n    transition: top 0.3s ease;\\n  ";\n  skipLink.addEventListener(\'focus\', function () {\n    skipLink.style.top = \'0\';\n  });\n  skipLink.addEventListener(\'blur\', function () {\n    skipLink.style.top = \'-40px\';\n  });\n  skipLink.addEventListener(\'click\', /*#__PURE__*/function () {\n    var _ref2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2(e) {\n      return regenerator_default().wrap(function _callee2$(_context2) {\n        while (1) switch (_context2.prev = _context2.next) {\n          case 0:\n            e.preventDefault();\n            _context2.next = 3;\n            return handleSkipToContent();\n          case 3:\n          case "end":\n            return _context2.stop();\n        }\n      }, _callee2);\n    }));\n    return function (_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }());\n  document.body.prepend(skipLink);\n  return function () {\n    skipLink.remove();\n    resetSkipToContent();\n  };\n};\n;// ./src/views/BaseView.js\n\n\n\n\n\n\n\n\n\nvar BaseView = function BaseView(htmlContent) {\n  var view = document.createElement(\'div\');\n  view.className = \'auth-form\';\n  view.innerHTML = htmlContent;\n\n  // Create a MutationObserver to detect when the view is removed\n  var observer = new MutationObserver(function (mutations) {\n    mutations.forEach(function (mutation) {\n      if (Array.from(mutation.removedNodes).includes(view)) {\n        cleanup();\n      }\n    });\n  });\n  var cleanup = function cleanup() {\n    resetSkipToContent();\n    observer.disconnect(); // Stop observing when cleaning up\n  };\n\n  // Start observing the view\'s parent for removal\n  if (view.parentNode) {\n    observer.observe(view.parentNode, {\n      childList: true\n    });\n  }\n  var getView = function getView() {\n    // When view is retrieved, ensure we observe its eventual parent\n    setTimeout(function () {\n      if (view.parentNode && !observer._isObserving) {\n        observer.observe(view.parentNode, {\n          childList: true\n        });\n        observer._isObserving = true;\n      }\n    }, 0);\n    return view;\n  };\n  var showError = function showError(message) {\n    var errorElement = view.querySelector(\'#error-message\') || view.querySelector(\'.error-message\');\n    if (errorElement) {\n      errorElement.textContent = message;\n      errorElement.style.display = message ? \'block\' : \'none\';\n    }\n  };\n  var showSuccess = function showSuccess(message) {\n    var successElement = view.querySelector(\'#success-message\') || view.querySelector(\'.success-message\');\n    if (successElement) {\n      successElement.textContent = message;\n      successElement.style.display = message ? \'block\' : \'none\';\n    }\n  };\n  return {\n    getView: getView,\n    showError: showError,\n    showSuccess: showSuccess,\n    cleanup: cleanup\n  };\n};\n;// ./src/views/auth/LoginView.js\n\n\n\nvar LoginView = function LoginView() {\n  var _document$querySelect;\n  (_document$querySelect = document.querySelector(\'header\')) === null || _document$querySelect === void 0 || _document$querySelect.remove();\n  var base = BaseView("\\n    <h2>Login</h2>\\n    <form id=\\"login-form\\">\\n      <div class=\\"form-group\\">\\n        <label for=\\"email\\">Email</label>\\n        <input type=\\"email\\" id=\\"email\\" name=\\"email\\" required>\\n      </div>\\n      <div class=\\"form-group\\">\\n        <label for=\\"password\\">Password</label>\\n        <input type=\\"password\\" id=\\"password\\" name=\\"password\\" required minlength=\\"8\\">\\n      </div>\\n      <button type=\\"submit\\">Login</button>\\n    </form>\\n    <p>Don\'t have an account? <a href=\\"#/register\\">Register here</a></p>\\n    <div id=\\"error-message\\" class=\\"error-message\\" style=\\"display: none;\\"></div>\\n  ");\n  var bindLogin = function bindLogin(handler) {\n    var form = base.getView().querySelector(\'#login-form\');\n    var errorMessage = base.getView().querySelector(\'#error-message\');\n    form.addEventListener(\'submit\', /*#__PURE__*/function () {\n      var _ref = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee(e) {\n        var email, password;\n        return regenerator_default().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              e.preventDefault();\n              email = form.email.value;\n              password = form.password.value;\n              errorMessage.style.display = \'none\';\n              _context.next = 6;\n              return handler(email, password);\n            case 6:\n            case "end":\n              return _context.stop();\n          }\n        }, _callee);\n      }));\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n  };\n  return {\n    getView: base.getView,\n    // Explicitly expose getView\n    showError: base.showError,\n    showSuccess: base.showSuccess,\n    bindLogin: bindLogin\n  };\n};\n;// ./src/views/auth/RegisterView.js\n\n\n\n\nvar RegisterView = function RegisterView() {\n  var base = BaseView("\\n    <h2>Register</h2>\\n    <form id=\\"register-form\\">\\n      <div class=\\"form-group\\">\\n        <label for=\\"name\\">Name</label>\\n        <input type=\\"text\\" id=\\"name\\" name=\\"name\\" required>\\n      </div>\\n      <div class=\\"form-group\\">\\n        <label for=\\"email\\">Email</label>\\n        <input type=\\"email\\" id=\\"email\\" name=\\"email\\" required>\\n      </div>\\n      <div class=\\"form-group\\">\\n        <label for=\\"password\\">Password</label>\\n        <input type=\\"password\\" id=\\"password\\" name=\\"password\\" required minlength=\\"8\\">\\n      </div>\\n      <div class=\\"form-group\\">\\n        <label for=\\"confirm-password\\">Confirm Password</label>\\n        <input type=\\"password\\" id=\\"confirm-password\\" name=\\"confirm-password\\" required minlength=\\"8\\">\\n      </div>\\n      <button type=\\"submit\\">Register</button>\\n    </form>\\n    <p>Already have an account? <a href=\\"#/login\\">Login here</a></p>\\n    <div id=\\"error-message\\" class=\\"error-message\\" style=\\"display: none;\\"></div>\\n    <div id=\\"success-message\\" class=\\"success-message\\" style=\\"display: none;\\"></div>\\n  ");\n  var bindRegister = function bindRegister(handler) {\n    var form = base.getView().querySelector(\'#register-form\');\n    var errorMessage = base.getView().querySelector(\'#error-message\');\n    form.addEventListener(\'submit\', /*#__PURE__*/function () {\n      var _ref = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee(e) {\n        var name, email, password, confirmPassword;\n        return regenerator_default().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              e.preventDefault();\n              name = form.name.value;\n              email = form.email.value;\n              password = form.password.value;\n              confirmPassword = form[\'confirm-password\'].value;\n              errorMessage.style.display = \'none\';\n              if (!(password !== confirmPassword)) {\n                _context.next = 9;\n                break;\n              }\n              base.showError("Passwords don\'t match!");\n              return _context.abrupt("return");\n            case 9:\n              _context.next = 11;\n              return handler(name, email, password);\n            case 11:\n            case "end":\n              return _context.stop();\n          }\n        }, _callee);\n      }));\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n  };\n  return {\n    getView: base.getView,\n    showError: base.showError,\n    showSuccess: base.showSuccess,\n    bindRegister: bindRegister\n  };\n};\n;// ./src/views/stories/StoriesView.js\n\n\n\n\n\n\n\n\nvar StoriesView = function StoriesView() {\n  var view = document.createElement("main");\n  view.id = "main-content";\n  view.setAttribute("role", "main");\n  view.setAttribute("aria-label", "Stories list");\n  view.innerHTML = "\\n    <h1 id=\\"stories-heading\\">Stories</h1>\\n    <div class=\\"stories-grid\\" id=\\"stories-container\\" role=\\"list\\" aria-labelledby=\\"stories-heading\\"></div>\\n    <div id=\\"error-message\\" class=\\"error-message\\" style=\\"display: none;\\"></div>\\n    <div id=\\"loading-indicator\\" style=\\"display: none;\\">Loading stories...</div>\\n  ";\n  var displayStories = function displayStories(stories) {\n    var container = view.querySelector("#stories-container");\n    var loading = view.querySelector("#loading-indicator");\n    loading.style.display = "none";\n    container.innerHTML = "";\n    if (!stories || stories.length === 0) {\n      container.innerHTML = \'<p class="no-stories">No stories found</p>\';\n      return;\n    }\n\n    // Tambahkan fallback photoUrl jika kosong\n    stories.forEach(function (story) {\n      story.photoUrl = story.photoUrl || \'/assets/images/placeholder-offline.jpg\';\n      var storyElement = document.createElement("article");\n      storyElement.className = "story-card";\n      storyElement.innerHTML = "\\n      <img src=\\"".concat(story.photoUrl, "\\" alt=\\"").concat(story.name, "\'s story\\" class=\\"story-image\\">\\n      <div class=\\"story-content\\">\\n        <h3>").concat(story.name, "</h3>\\n        <p>").concat(story.description.substring(0, 100)).concat(story.description.length > 100 ? "..." : "", "</p>\\n        <p class=\\"story-date\\">").concat(new Date(story.createdAt).toLocaleDateString(), "</p>\\n        <a href=\\"#/stories/").concat(story.id, "\\" class=\\"read-more\\">Read more</a>\\n      </div>\\n    ");\n\n      // Make entire card clickable\n      storyElement.addEventListener("click", function () {\n        window.location.hash = "#/stories/".concat(story.id);\n      });\n\n      // Keyboard navigation\n      storyElement.addEventListener("keydown", function (e) {\n        if (e.key === "Enter") {\n          window.location.hash = "#/stories/".concat(story.id);\n        }\n      });\n      container.appendChild(storyElement);\n    });\n\n    // Focus management for the entire container\n    container.addEventListener("focusout", function (e) {\n      if (!e.relatedTarget || !container.contains(e.relatedTarget)) {\n        document.querySelectorAll(".story-card").forEach(function (card) {\n          card.classList.remove("card-focused");\n          card.querySelector(".read-more").tabIndex = -1;\n        });\n      }\n    });\n  };\n  var showError = function showError(message) {\n    var errorEl = view.querySelector("#error-message");\n    errorEl.textContent = message;\n    errorEl.style.display = "block";\n    view.querySelector("#loading-indicator").style.display = "none";\n  };\n  var showLoading = function showLoading() {\n    view.querySelector("#loading-indicator").style.display = "block";\n    view.querySelector("#error-message").style.display = "none";\n  };\n  var showOfflineWarning = function showOfflineWarning() {\n    var container = view.querySelector(\'#stories-container\');\n    var warning = document.createElement(\'div\');\n    warning.className = \'offline-warning\';\n    warning.innerHTML = "\\n    <i class=\\"fas fa-wifi-slash\\"></i>\\n    <span>Showing offline data. Some stories may not be up-to-date.</span>\\n  ";\n    container.prepend(warning);\n  };\n  var bindLoadStories = function bindLoadStories(handler) {\n    showLoading();\n    handler()["catch"](function (error) {\n      showError(error.message || "Failed to load stories");\n    });\n  };\n  return {\n    getView: function getView() {\n      return view;\n    },\n    displayStories: displayStories,\n    showError: showError,\n    bindLoadStories: bindLoadStories,\n    showLoading: showLoading,\n    showOfflineWarning: showOfflineWarning\n  };\n};\n// EXTERNAL MODULE: ./node_modules/leaflet/dist/leaflet.css\nvar leaflet = __webpack_require__(3093);\n// EXTERNAL MODULE: ./node_modules/leaflet/dist/leaflet-src.js\nvar leaflet_src = __webpack_require__(3481);\nvar leaflet_src_default = /*#__PURE__*/__webpack_require__.n(leaflet_src);\n// EXTERNAL MODULE: ./node_modules/leaflet.markercluster/dist/leaflet.markercluster.js\nvar leaflet_markercluster = __webpack_require__(3866);\n// EXTERNAL MODULE: ./node_modules/leaflet.markercluster/dist/MarkerCluster.css\nvar MarkerCluster = __webpack_require__(9500);\n// EXTERNAL MODULE: ./node_modules/leaflet.markercluster/dist/MarkerCluster.Default.css\nvar MarkerCluster_Default = __webpack_require__(1081);\n;// ./src/views/stories/DetailStoryView.js\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n// Fix for default marker icons in Leaflet\ndelete (leaflet_src_default()).Icon.Default.prototype._getIconUrl;\nleaflet_src_default().Icon.Default.mergeOptions({\n  iconRetinaUrl: \'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png\',\n  iconUrl: \'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png\',\n  shadowUrl: \'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png\'\n});\nvar DetailStoryView = function DetailStoryView() {\n  var view = document.createElement(\'main\');\n  view.id = \'main-content\';\n  view.innerHTML = "\\n    <div class=\\"detail-story\\">\\n      <div class=\\"story-image-container\\">\\n        <img id=\\"story-image\\" class=\\"detail-story-image\\" alt=\\"Story image\\">\\n        <div class=\\"story-meta\\">\\n          <div class=\\"author-info\\">\\n            <i class=\\"fas fa-user-circle\\"></i>\\n            <span id=\\"story-author\\"></span>\\n          </div>\\n          <div class=\\"date-info\\">\\n            <i class=\\"far fa-calendar-alt\\"></i>\\n            <span id=\\"story-date\\"></span>\\n          </div>\\n        </div>\\n      </div>\\n      \\n      <div class=\\"story-content\\">\\n        <h1 id=\\"story-title\\" class=\\"story-title\\"></h1>\\n        <p id=\\"story-description\\" class=\\"story-description\\"></p>\\n        \\n        <div class=\\"location-section\\">\\n          <h3><i class=\\"fas fa-map-marker-alt\\"></i> Lokasi</h3>\\n          <div id=\\"story-map-container\\" class=\\"detail-map-container\\">\\n            <div id=\\"story-map\\" class=\\"detail-map\\"></div>\\n            <div class=\\"map-controls\\">\\n              <button id=\\"satellite-view\\" class=\\"map-control-btn\\">\\n                <i class=\\"fas fa-satellite\\"></i>\\n              </button>\\n              <button id=\\"street-view\\" class=\\"map-control-btn\\">\\n                <i class=\\"fas fa-road\\"></i>\\n              </button>\\n            </div>\\n          </div>\\n        </div>\\n      </div>\\n    </div>\\n    \\n    <div id=\\"error-message\\" class=\\"error-message\\">\\n      <i class=\\"fas fa-exclamation-circle\\"></i>\\n      <span class=\\"error-text\\"></span>\\n    </div>\\n  ";\n  var mapInstance = null;\n  var markerCluster = null;\n  var baseLayers = {};\n  var currentLayer = null;\n  var prepareMapContainer = function prepareMapContainer() {\n    var container = view.querySelector(\'#story-map-container\');\n    var mapDiv = view.querySelector(\'#story-map\');\n\n    // Completely recreate the map container\n    if (mapDiv) {\n      var newMapDiv = document.createElement(\'div\');\n      newMapDiv.id = \'story-map\';\n      newMapDiv.className = \'detail-map\';\n      container.replaceChild(newMapDiv, mapDiv);\n    }\n\n    // Clean up existing map instances\n    if (mapInstance) {\n      mapInstance.remove();\n      mapInstance = null;\n    }\n    if (markerCluster) {\n      markerCluster.clearLayers();\n      markerCluster = null;\n    }\n  };\n  var initMap = function initMap(lat, lng) {\n    try {\n      var _document$getElementB, _document$getElementB2;\n      // Check if map container exists and isn\'t already initialized\n      var mapElement = view.querySelector(\'#story-map\');\n      if (!mapElement || mapElement._leaflet_id) {\n        return null;\n      }\n\n      // Create new map instance\n      mapInstance = leaflet_src_default().map(mapElement, {\n        zoomControl: false,\n        preferCanvas: true\n      }).setView([lat, lng], 13);\n\n      // Add zoom control\n      leaflet_src_default().control.zoom({\n        position: \'bottomright\'\n      }).addTo(mapInstance);\n\n      // Define base layers\n      baseLayers = {\n        "Street View": leaflet_src_default().tileLayer(\'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\', {\n          attribution: \'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors\',\n          maxZoom: 19\n        }),\n        "Satellite View": leaflet_src_default().tileLayer(\'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}\', {\n          attribution: \'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community\',\n          maxZoom: 19\n        })\n      };\n\n      // Add default layer\n      baseLayers["Street View"].addTo(mapInstance);\n      currentLayer = "Street View";\n\n      // Add layer control\n      leaflet_src_default().control.layers(baseLayers, null, {\n        position: \'topright\',\n        collapsed: false\n      }).addTo(mapInstance);\n\n      // Initialize marker cluster\n      markerCluster = leaflet_src_default().markerClusterGroup({\n        spiderfyOnMaxZoom: true,\n        showCoverageOnHover: false,\n        zoomToBoundsOnClick: true,\n        maxClusterRadius: 40\n      });\n\n      // Add custom control button events\n      (_document$getElementB = document.getElementById(\'satellite-view\')) === null || _document$getElementB === void 0 || _document$getElementB.addEventListener(\'click\', function () {\n        switchLayer("Satellite View");\n      });\n      (_document$getElementB2 = document.getElementById(\'street-view\')) === null || _document$getElementB2 === void 0 || _document$getElementB2.addEventListener(\'click\', function () {\n        switchLayer("Street View");\n      });\n      return mapInstance;\n    } catch (error) {\n      console.error(\'Map initialization error:\', error);\n      return null;\n    }\n  };\n  var switchLayer = function switchLayer(layerName) {\n    if (mapInstance && currentLayer !== layerName) {\n      mapInstance.removeLayer(baseLayers[currentLayer]);\n      baseLayers[layerName].addTo(mapInstance);\n      currentLayer = layerName;\n\n      // Update active button state\n      document.querySelectorAll(\'.map-control-btn\').forEach(function (btn) {\n        btn.classList.remove(\'active\');\n      });\n      var activeBtn = document.getElementById("".concat(layerName.toLowerCase().replace(\' \', \'-\'), "-view"));\n      if (activeBtn) activeBtn.classList.add(\'active\');\n    }\n  };\n  var displayStoryDetail = /*#__PURE__*/function () {\n    var _ref = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2(story) {\n      return regenerator_default().wrap(function _callee2$(_context2) {\n        while (1) switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return startViewTransition(/*#__PURE__*/(0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee() {\n              var imageElement, mapContainer, map, marker;\n              return regenerator_default().wrap(function _callee$(_context) {\n                while (1) switch (_context.prev = _context.next) {\n                  case 0:\n                    // Prepare the view first\n                    imageElement = view.querySelector(\'#story-image\');\n                    imageElement.src = story.photoUrl;\n                    imageElement.alt = "Story by ".concat(story.name);\n                    view.querySelector(\'#story-title\').textContent = story.name;\n                    view.querySelector(\'#story-author\').textContent = story.name;\n                    view.querySelector(\'#story-description\').textContent = story.description;\n                    view.querySelector(\'#story-date\').textContent = new Date(story.createdAt).toLocaleString(\'id-ID\', {\n                      weekday: \'long\',\n                      year: \'numeric\',\n                      month: \'long\',\n                      day: \'numeric\',\n                      hour: \'2-digit\',\n                      minute: \'2-digit\'\n                    });\n\n                    // Handle map display\n                    mapContainer = view.querySelector(\'#story-map-container\');\n                    if (!(story.lat && story.lon)) {\n                      _context.next = 17;\n                      break;\n                    }\n                    mapContainer.style.display = \'block\';\n\n                    // Prepare the map container\n                    prepareMapContainer();\n\n                    // Wait for DOM to be ready\n                    _context.next = 13;\n                    return new Promise(function (resolve) {\n                      return requestAnimationFrame(resolve);\n                    });\n                  case 13:\n                    // Initialize map\n                    map = initMap(story.lat, story.lon);\n                    if (map) {\n                      // Add marker to the cluster\n                      marker = leaflet_src_default().marker([story.lat, story.lon]).bindPopup("\\n              <div class=\\"map-popup\\">\\n                <h4>".concat(story.name, "</h4>\\n                <p>").concat(story.description.substring(0, 100), "...</p>\\n                <small>").concat(new Date(story.createdAt).toLocaleDateString(), "</small>\\n              </div>\\n            "));\n                      markerCluster.addLayer(marker);\n                      map.addLayer(markerCluster);\n                      marker.openPopup();\n                    }\n                    _context.next = 18;\n                    break;\n                  case 17:\n                    mapContainer.style.display = \'none\';\n                  case 18:\n                  case "end":\n                    return _context.stop();\n                }\n              }, _callee);\n            })));\n          case 2:\n          case "end":\n            return _context2.stop();\n        }\n      }, _callee2);\n    }));\n    return function displayStoryDetail(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n  var showError = function showError(message) {\n    var errorElement = view.querySelector(\'#error-message\');\n    var errorText = errorElement.querySelector(\'.error-text\');\n    errorText.textContent = message;\n    errorElement.style.display = \'flex\';\n\n    // Animation for error message\n    errorElement.animate([{\n      opacity: 0,\n      transform: \'translateY(-10px)\'\n    }, {\n      opacity: 1,\n      transform: \'translateY(0)\'\n    }], {\n      duration: 300,\n      easing: \'ease-out\'\n    });\n  };\n  var cleanup = function cleanup() {\n    if (mapInstance) {\n      mapInstance.remove();\n      mapInstance = null;\n    }\n    if (markerCluster) {\n      markerCluster.clearLayers();\n      markerCluster = null;\n    }\n  };\n  return {\n    getView: function getView() {\n      return view;\n    },\n    displayStoryDetail: displayStoryDetail,\n    showError: showError,\n    cleanup: cleanup,\n    prepareMapContainer: prepareMapContainer\n  };\n};\n// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/defineProperty.js\nvar defineProperty = __webpack_require__(4467);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.number.to-fixed.js\nvar es_number_to_fixed = __webpack_require__(9868);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.parse-float.js\nvar es_parse_float = __webpack_require__(8459);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.string.trim.js\nvar es_string_trim = __webpack_require__(2762);\n;// ./src/views/stories/AddStoryView.js\n\n\nfunction AddStoryView_ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction AddStoryView_objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? AddStoryView_ownKeys(Object(t), !0).forEach(function (r) { (0,defineProperty/* default */.A)(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : AddStoryView_ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar AddStoryView = function AddStoryView() {\n  var view = document.createElement("main");\n  view.id = "main-content";\n  view.setAttribute("role", "main");\n  view.setAttribute("aria-label", "Add new story form");\n  view.innerHTML = "\\n\\n    <div class=\\"add-story-form\\">\\n    <h2>Add New Story</h2> \\n    <div class=\\"notification-permission-info\\" style=\\"display: none;\\">\\n      <p>We\'d like to show notifications when you add stories. This helps you keep track of your contributions.</p>\\n      <button type=\\"button\\" id=\\"enable-notifications\\" class=\\"btn\\">Enable Notifications</button>\\n    </div>\\n      <form id=\\"story-form\\">\\n        <div class=\\"form-group\\">\\n          <label for=\\"description\\">Description</label>\\n          <textarea id=\\"description\\" name=\\"description\\" rows=\\"4\\" required></textarea>\\n        </div>\\n        \\n        <div class=\\"form-group camera-container\\">\\n          <label>Photo</label>\\n          <div class=\\"preview-container\\">\\n            <video id=\\"camera-preview\\" class=\\"media-preview\\" autoplay playsinline></video>\\n            <img id=\\"photo-preview\\" class=\\"media-preview\\" style=\\"display:none; object-fit:contain;\\" alt=\\"Captured photo\\">\\n          </div>\\n          <div class=\\"camera-controls\\">\\n            <button type=\\"button\\" id=\\"start-camera\\" class=\\"btn camera-btn\\">Start Camera</button>\\n            <select id=\\"camera-select\\" class=\\"camera-select\\" style=\\"display:none;\\"></select>\\n            <button type=\\"button\\" id=\\"capture-btn\\" class=\\"btn capture-btn\\" style=\\"display:none;\\">Capture Photo</button>\\n            <button type=\\"button\\" id=\\"stop-camera\\" class=\\"btn stop-btn\\" style=\\"display:none;\\">Stop Camera</button>\\n            <button type=\\"button\\" id=\\"retake-btn\\" class=\\"btn retake-btn\\" style=\\"display:none;\\">Retake Photo</button>\\n          </div>\\n          <canvas id=\\"canvas\\" style=\\"display:none;\\"></canvas>\\n        </div>\\n        \\n        <div class=\\"form-group\\">\\n          <label>Location</label>\\n          <div id=\\"map\\" class=\\"map-container\\"></div>\\n          <button type=\\"button\\" id=\\"get-location\\" class=\\"btn location-btn\\">Use Current Location</button>\\n          <input type=\\"hidden\\" id=\\"lat\\" name=\\"lat\\">\\n          <input type=\\"hidden\\" id=\\"lng\\" name=\\"lng\\">\\n          <p id=\\"location-status\\" class=\\"location-status\\">No location selected</p>\\n        </div>\\n        \\n        <button type=\\"submit\\" class=\\"btn submit-btn\\">Submit Story</button>\\n      </form>\\n      <div id=\\"error-message\\" class=\\"error-message\\"></div>\\n      <div id=\\"success-message\\" class=\\"success-message\\"></div>\\n    </div>\\n  ";\n\n  // State\n  var stream = null;\n  var photoFile = null;\n  var map = null;\n  var availableCameras = [];\n  var mapMarker = null;\n  var isViewActive = true;\n\n  // DOM Elements\n  var cameraPreview = view.querySelector("#camera-preview");\n  var photoPreview = view.querySelector("#photo-preview");\n  var startCameraBtn = view.querySelector("#start-camera");\n  var cameraSelect = view.querySelector("#camera-select");\n  var captureBtn = view.querySelector("#capture-btn");\n  var stopCameraBtn = view.querySelector("#stop-camera");\n  var retakeBtn = view.querySelector("#retake-btn");\n  var canvas = view.querySelector("#canvas");\n  var mapContainer = view.querySelector("#map");\n  var locationStatus = view.querySelector("#location-status");\n  var checkNotificationPermission = function checkNotificationPermission() {\n    var notificationInfo = view.querySelector(".notification-permission-info");\n    var enableNotificationsBtn = view.querySelector("#enable-notifications");\n    if (Notification.permission === "default") {\n      notificationInfo.style.display = "block";\n      enableNotificationsBtn.addEventListener("click", /*#__PURE__*/(0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee() {\n        var granted;\n        return regenerator_default().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return showNotificationPrompt();\n            case 3:\n              granted = _context.sent;\n              notificationInfo.style.display = granted ? "none" : "block";\n              if (granted) {\n                // Optional: Show a confirmation message\n                showSuccess("Notifications enabled!");\n              }\n              _context.next = 12;\n              break;\n            case 8:\n              _context.prev = 8;\n              _context.t0 = _context["catch"](0);\n              console.error("Error requesting notification permission:", _context.t0);\n              showError("Failed to enable notifications");\n            case 12:\n            case "end":\n              return _context.stop();\n          }\n        }, _callee, null, [[0, 8]]);\n      })));\n    } else {\n      notificationInfo.style.display = "none";\n    }\n  };\n  var initializeMap = function initializeMap() {\n    if (!map && mapContainer) {\n      map = L.map(mapContainer).setView([-6.2, 106.8], 13);\n      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {\n        attribution: "&copy; OpenStreetMap contributors"\n      }).addTo(map);\n      map.on("click", function (e) {\n        var _e$latlng = e.latlng,\n          lat = _e$latlng.lat,\n          lng = _e$latlng.lng;\n        updateLocation(lat, lng);\n        addMapMarker(lat, lng);\n        showSuccess("Location selected on map!");\n      });\n    }\n  };\n\n  // Add marker to map\n  var addMapMarker = function addMapMarker(lat, lng) {\n    if (mapMarker) {\n      map.removeLayer(mapMarker);\n    }\n    mapMarker = L.marker([lat, lng], {\n      draggable: true,\n      title: "Story Location"\n    }).addTo(map).bindPopup("Story location").openPopup();\n    mapMarker.on("dragend", function (e) {\n      var newPos = e.target.getLatLng();\n      updateLocation(newPos.lat, newPos.lng);\n    });\n  };\n\n  // Update location inputs and status\n  var updateLocation = function updateLocation(lat, lng) {\n    view.querySelector("#lat").value = lat;\n    view.querySelector("#lng").value = lng;\n    locationStatus.textContent = "Location set: ".concat(lat.toFixed(4), ", ").concat(lng.toFixed(4));\n    locationStatus.style.color = "#4CAF50";\n  };\n\n  // Message handlers\n  var showError = function showError(message) {\n    var errorElement = view.querySelector("#error-message");\n    errorElement.textContent = message;\n    errorElement.style.display = "block";\n    setTimeout(function () {\n      return errorElement.style.display = "none";\n    }, 5000);\n  };\n  var showSuccess = function showSuccess(message) {\n    var successElement = view.querySelector("#success-message");\n    successElement.textContent = message;\n    successElement.style.display = "block";\n    setTimeout(function () {\n      return successElement.style.display = "none";\n    }, 5000);\n  };\n\n  // Camera functions\n  var getCameraDevices = /*#__PURE__*/function () {\n    var _ref2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2() {\n      var devices;\n      return regenerator_default().wrap(function _callee2$(_context2) {\n        while (1) switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.prev = 0;\n            _context2.next = 3;\n            return navigator.mediaDevices.enumerateDevices();\n          case 3:\n            devices = _context2.sent;\n            return _context2.abrupt("return", devices.filter(function (device) {\n              return device.kind === "videoinput";\n            }));\n          case 7:\n            _context2.prev = 7;\n            _context2.t0 = _context2["catch"](0);\n            showError("Camera access error: ".concat(_context2.t0.message));\n            return _context2.abrupt("return", []);\n          case 11:\n          case "end":\n            return _context2.stop();\n        }\n      }, _callee2, null, [[0, 7]]);\n    }));\n    return function getCameraDevices() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  var stopCamera = function stopCamera() {\n    stopCameraBtn.style.display = "none";\n    startCameraBtn.style.display = "inline-block";\n    if (stream) {\n      stream.getTracks().forEach(function (track) {\n        track.stop();\n        track.enabled = false;\n      });\n      stream = null;\n    }\n    cameraPreview.style.display = "none";\n    cameraPreview.srcObject = null;\n    captureBtn.style.display = "none";\n    cameraSelect.style.display = "none";\n  };\n  var _startCamera = /*#__PURE__*/function () {\n    var _ref3 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee3() {\n      var deviceId,\n        constraints,\n        _args3 = arguments;\n      return regenerator_default().wrap(function _callee3$(_context3) {\n        while (1) switch (_context3.prev = _context3.next) {\n          case 0:\n            deviceId = _args3.length > 0 && _args3[0] !== undefined ? _args3[0] : null;\n            if (isViewActive) {\n              _context3.next = 3;\n              break;\n            }\n            return _context3.abrupt("return");\n          case 3:\n            _context3.prev = 3;\n            stopCamera();\n            constraints = {\n              video: AddStoryView_objectSpread({\n                width: {\n                  ideal: 1280\n                },\n                height: {\n                  ideal: 720\n                }\n              }, deviceId && {\n                deviceId: {\n                  exact: deviceId\n                }\n              })\n            };\n            _context3.next = 8;\n            return navigator.mediaDevices.getUserMedia(constraints);\n          case 8:\n            stream = _context3.sent;\n            if (!(availableCameras.length === 0)) {\n              _context3.next = 14;\n              break;\n            }\n            _context3.next = 12;\n            return getCameraDevices();\n          case 12:\n            availableCameras = _context3.sent;\n            updateCameraSelect();\n          case 14:\n            cameraPreview.srcObject = stream;\n            cameraPreview.style.display = "block";\n            photoPreview.style.display = "none";\n            captureBtn.style.display = "inline-block";\n            stopCameraBtn.style.display = "inline-block";\n            startCameraBtn.style.display = "none";\n            retakeBtn.style.display = "none";\n            if (availableCameras.length > 1) {\n              cameraSelect.style.display = "inline-block";\n            }\n            _context3.next = 28;\n            break;\n          case 24:\n            _context3.prev = 24;\n            _context3.t0 = _context3["catch"](3);\n            showError("Camera error: ".concat(_context3.t0.message));\n            if (deviceId) {\n              _startCamera();\n            }\n          case 28:\n          case "end":\n            return _context3.stop();\n        }\n      }, _callee3, null, [[3, 24]]);\n    }));\n    return function startCamera() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  var updateCameraSelect = function updateCameraSelect() {\n    cameraSelect.innerHTML = "";\n    availableCameras.forEach(function (camera) {\n      var option = document.createElement("option");\n      option.value = camera.deviceId;\n      option.text = camera.label || "Camera ".concat(cameraSelect.length + 1);\n      cameraSelect.appendChild(option);\n    });\n    cameraSelect.addEventListener("change", function () {\n      _startCamera(cameraSelect.value);\n    });\n  };\n  var capturePhoto = function capturePhoto() {\n    try {\n      var video = cameraPreview;\n      canvas.width = video.videoWidth;\n      canvas.height = video.videoHeight;\n      var ctx = canvas.getContext("2d");\n      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n      photoPreview.src = canvas.toDataURL("image/jpeg");\n      photoPreview.style.display = "block";\n      cameraPreview.style.display = "none";\n      canvas.toBlob(function (blob) {\n        photoFile = new File([blob], "story-photo.jpg", {\n          type: "image/jpeg",\n          lastModified: Date.now()\n        });\n      }, "image/jpeg", 0.85);\n      captureBtn.style.display = "none";\n      stopCameraBtn.style.display = "none";\n      cameraSelect.style.display = "none";\n      retakeBtn.style.display = "inline-block";\n      stopCamera();\n    } catch (error) {\n      showError("Capture failed: ".concat(error.message));\n    }\n  };\n  var retakePhoto = function retakePhoto() {\n    photoPreview.style.display = "none";\n    photoPreview.src = "";\n    photoFile = null;\n    _startCamera(cameraSelect.value || null);\n  };\n\n  // Clean up when view is destroyed\n  var cleanup = function cleanup() {\n    isViewActive = false;\n    stopCamera();\n    if (map) {\n      map.remove();\n      map = null;\n      mapMarker = null;\n    }\n\n    // Remove all event listeners\n    var safeRemoveListener = function safeRemoveListener(element, event, handler) {\n      if (element && handler) {\n        element.removeEventListener(event, handler);\n      }\n    };\n    safeRemoveListener(startCameraBtn, "click", _startCamera);\n    safeRemoveListener(stopCameraBtn, "click", stopCamera);\n    safeRemoveListener(captureBtn, "click", capturePhoto);\n    safeRemoveListener(retakeBtn, "click", retakePhoto);\n    safeRemoveListener(cameraSelect, "change", _startCamera);\n  };\n\n  // Initialize map when view is created\n  setTimeout(initializeMap, 100);\n\n  // Bind event handlers\n  var bindAddStory = function bindAddStory(handler) {\n    var form = view.querySelector("#story-form");\n    var getLocationBtn = view.querySelector("#get-location");\n    var formSubmitHandler = /*#__PURE__*/function () {\n      var _ref4 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee4(e) {\n        var description, data;\n        return regenerator_default().wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              e.preventDefault();\n              if (photoFile) {\n                _context4.next = 4;\n                break;\n              }\n              showError("Please take a photo first");\n              return _context4.abrupt("return");\n            case 4:\n              description = form.description.value.trim();\n              if (description) {\n                _context4.next = 8;\n                break;\n              }\n              showError("Please enter a description");\n              return _context4.abrupt("return");\n            case 8:\n              if (!(!form.lat.value || !form.lng.value)) {\n                _context4.next = 11;\n                break;\n              }\n              showError("Please select a location");\n              return _context4.abrupt("return");\n            case 11:\n              data = {\n                description: description,\n                photo: photoFile,\n                lat: parseFloat(form.lat.value),\n                lon: parseFloat(form.lng.value)\n              };\n              _context4.prev = 12;\n              _context4.next = 15;\n              return handler(data);\n            case 15:\n              _context4.next = 20;\n              break;\n            case 17:\n              _context4.prev = 17;\n              _context4.t0 = _context4["catch"](12);\n              showError("Submission failed: ".concat(_context4.t0.message));\n            case 20:\n            case "end":\n              return _context4.stop();\n          }\n        }, _callee4, null, [[12, 17]]);\n      }));\n      return function formSubmitHandler(_x) {\n        return _ref4.apply(this, arguments);\n      };\n    }();\n    var getLocationHandler = function getLocationHandler() {\n      navigator.geolocation.getCurrentPosition(function (position) {\n        var lat = position.coords.latitude;\n        var lng = position.coords.longitude;\n        updateLocation(lat, lng);\n        addMapMarker(lat, lng);\n        if (map) {\n          map.setView([lat, lng], 15);\n        }\n        showSuccess("Current location obtained!");\n      }, function (error) {\n        showError("Location error: ".concat(error.message));\n      }, {\n        enableHighAccuracy: true,\n        timeout: 10000\n      });\n    };\n    startCameraBtn.addEventListener("click", _startCamera);\n    stopCameraBtn.addEventListener("click", stopCamera);\n    captureBtn.addEventListener("click", capturePhoto);\n    retakeBtn.addEventListener("click", retakePhoto);\n    getLocationBtn.addEventListener("click", getLocationHandler);\n    form.addEventListener("submit", formSubmitHandler);\n\n    // Add header navigation listener\n    window.addEventListener("header-navigation", stopCamera);\n  };\n  checkNotificationPermission();\n  return {\n    getView: function getView() {\n      return view;\n    },\n    bindAddStory: bindAddStory,\n    showError: showError,\n    showSuccess: showSuccess,\n    getMapContainer: function getMapContainer() {\n      return mapContainer;\n    },\n    cleanup: cleanup\n  };\n};\n;// ./src/utils/auth.js\nvar checkAuth = function checkAuth(authModel, router) {\n  if (!authModel.isAuthenticated()) {\n    router.navigateTo("/login");\n    return false;\n  }\n  return true;\n};\nvar checkGuest = function checkGuest(authModel, router) {\n  if (authModel.isAuthenticated()) {\n    router.navigateTo("/stories");\n    return false;\n  }\n  return true;\n};\n;// ./src/app.js\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n// Initialize models\ninitializeSkipToContent();\nvar authModel = new AuthModel();\nvar storyModel = new StoryModel(authModel);\ninitializeSkipToContent();\nvar _initMapWithRetry = /*#__PURE__*/function () {\n  var _ref = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee(handler, containerId, lat, lng, zoom) {\n    var attempts,\n      container,\n      _args = arguments;\n    return regenerator_default().wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          attempts = _args.length > 5 && _args[5] !== undefined ? _args[5] : 0;\n          _context.prev = 1;\n          container = document.getElementById(containerId);\n          if (!(!container && attempts < 3)) {\n            _context.next = 7;\n            break;\n          }\n          _context.next = 6;\n          return new Promise(function (resolve) {\n            return setTimeout(resolve, 100 * (attempts + 1));\n          });\n        case 6:\n          return _context.abrupt("return", _initMapWithRetry(handler, containerId, lat, lng, zoom, attempts + 1));\n        case 7:\n          return _context.abrupt("return", handler(containerId, lat, lng, zoom));\n        case 10:\n          _context.prev = 10;\n          _context.t0 = _context["catch"](1);\n          console.error(\'Map initialization failed:\', _context.t0);\n          return _context.abrupt("return", null);\n        case 14:\n        case "end":\n          return _context.stop();\n      }\n    }, _callee, null, [[1, 10]]);\n  }));\n  return function initMapWithRetry(_x, _x2, _x3, _x4, _x5) {\n    return _ref.apply(this, arguments);\n  };\n}();\nwindow.addEventListener(\'logout\', function () {\n  authModel.logout();\n  updateAuthUI(false);\n  router.navigateTo(\'/login\');\n});\n\n// Routes configuration\nvar routes = [{\n  path: \'/login\',\n  view: function () {\n    var _view = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2() {\n      var view;\n      return regenerator_default().wrap(function _callee2$(_context2) {\n        while (1) switch (_context2.prev = _context2.next) {\n          case 0:\n            if (checkGuest(authModel, router)) {\n              _context2.next = 2;\n              break;\n            }\n            return _context2.abrupt("return", ErrorView().getView());\n          case 2:\n            view = LoginView();\n            new AuthPresenter(authModel, {\n              bindLogin: view.bindLogin,\n              showError: view.showError\n            }, router);\n            return _context2.abrupt("return", view.getView());\n          case 5:\n          case "end":\n            return _context2.stop();\n        }\n      }, _callee2);\n    }));\n    function view() {\n      return _view.apply(this, arguments);\n    }\n    return view;\n  }()\n}, {\n  path: \'/register\',\n  view: function () {\n    var _view2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee3() {\n      var view;\n      return regenerator_default().wrap(function _callee3$(_context3) {\n        while (1) switch (_context3.prev = _context3.next) {\n          case 0:\n            if (checkGuest(authModel, router)) {\n              _context3.next = 2;\n              break;\n            }\n            return _context3.abrupt("return", ErrorView().getView());\n          case 2:\n            view = RegisterView();\n            new AuthPresenter(authModel, {\n              bindRegister: view.bindRegister,\n              showError: view.showError,\n              showSuccess: view.showSuccess\n            }, router);\n            return _context3.abrupt("return", view.getView());\n          case 5:\n          case "end":\n            return _context3.stop();\n        }\n      }, _callee3);\n    }));\n    function view() {\n      return _view2.apply(this, arguments);\n    }\n    return view;\n  }()\n}, {\n  path: \'/\',\n  view: function () {\n    var _view3 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee4() {\n      var view, permission;\n      return regenerator_default().wrap(function _callee4$(_context4) {\n        while (1) switch (_context4.prev = _context4.next) {\n          case 0:\n            if (checkAuth(authModel, router)) {\n              _context4.next = 2;\n              break;\n            }\n            return _context4.abrupt("return", ErrorView().getView());\n          case 2:\n            view = StoriesView();\n            new StoryPresenter(storyModel, {\n              bindLoadStories: view.bindLoadStories,\n              displayStories: view.displayStories,\n              showError: view.showError\n            }, router);\n            if (!authModel.isAuthenticated()) {\n              _context4.next = 17;\n              break;\n            }\n            _context4.prev = 5;\n            _context4.next = 8;\n            return requestNotificationPermission();\n          case 8:\n            permission = _context4.sent;\n            if (!permission) {\n              _context4.next = 12;\n              break;\n            }\n            _context4.next = 12;\n            return subscribeUser(authModel.getToken());\n          case 12:\n            _context4.next = 17;\n            break;\n          case 14:\n            _context4.prev = 14;\n            _context4.t0 = _context4["catch"](5);\n            console.error(\'Notification setup failed:\', _context4.t0);\n          case 17:\n            return _context4.abrupt("return", view.getView());\n          case 18:\n          case "end":\n            return _context4.stop();\n        }\n      }, _callee4, null, [[5, 14]]);\n    }));\n    function view() {\n      return _view3.apply(this, arguments);\n    }\n    return view;\n  }()\n}, {\n  path: \'/stories\',\n  view: function () {\n    var _view4 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee5() {\n      var view;\n      return regenerator_default().wrap(function _callee5$(_context5) {\n        while (1) switch (_context5.prev = _context5.next) {\n          case 0:\n            if (checkAuth(authModel, router)) {\n              _context5.next = 2;\n              break;\n            }\n            return _context5.abrupt("return", ErrorView().getView());\n          case 2:\n            view = StoriesView();\n            new StoryPresenter(storyModel, {\n              bindLoadStories: view.bindLoadStories,\n              displayStories: view.displayStories,\n              showError: view.showError\n            }, router);\n            return _context5.abrupt("return", view.getView());\n          case 5:\n          case "end":\n            return _context5.stop();\n        }\n      }, _callee5);\n    }));\n    function view() {\n      return _view4.apply(this, arguments);\n    }\n    return view;\n  }()\n}, {\n  path: \'/stories/:id\',\n  view: function () {\n    var _view5 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee6(params) {\n      var view, id, presenter;\n      return regenerator_default().wrap(function _callee6$(_context6) {\n        while (1) switch (_context6.prev = _context6.next) {\n          case 0:\n            if (checkAuth(authModel, router)) {\n              _context6.next = 2;\n              break;\n            }\n            return _context6.abrupt("return", ErrorView());\n          case 2:\n            view = DetailStoryView();\n            id = params.id;\n            presenter = new StoryPresenter(storyModel, {\n              bindLoadStoryDetail: function bindLoadStoryDetail(handler) {\n                // First clean up any existing map\n                var mapContainer = view.getView().querySelector(\'#story-map-container\');\n                if (mapContainer) {\n                  mapContainer.innerHTML = \'<div id="story-map" class="detail-map"></div>\';\n                }\n                handler(id);\n              },\n              displayStoryDetail: function displayStoryDetail(story) {\n                // Display basic story info first\n                view.displayStoryDetail(story);\n\n                // Then handle map initialization if location exists\n                if (story.lat && story.lon) {\n                  // Wait for the DOM to be ready\n                  setTimeout(function () {\n                    var mapElement = view.getView().querySelector(\'#story-map\');\n                    if (!mapElement || !mapElement._leaflet_id) {\n                      // Check if map already exists\n                      try {\n                        var map = L.map(mapElement).setView([story.lat, story.lon], 13);\n                        L.tileLayer(\'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\', {\n                          attribution: \'&copy; OpenStreetMap contributors\'\n                        }).addTo(map);\n                        L.marker([story.lat, story.lon]).addTo(map).bindPopup("<b>".concat(story.name, "</b><br>").concat(story.description.substring(0, 50), "...")).openPopup();\n                      } catch (error) {\n                        console.error(\'Map initialization error:\', error);\n                      }\n                    }\n                  }, 50);\n                }\n              },\n              showError: function showError(message) {\n                return view.showError(message);\n              }\n            }, router);\n            return _context6.abrupt("return", view.getView());\n          case 6:\n          case "end":\n            return _context6.stop();\n        }\n      }, _callee6);\n    }));\n    function view(_x6) {\n      return _view5.apply(this, arguments);\n    }\n    return view;\n  }()\n}, {\n  path: \'/add-story\',\n  view: function () {\n    var _view6 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee9() {\n      var view, domNode, mapPresenter;\n      return regenerator_default().wrap(function _callee9$(_context9) {\n        while (1) switch (_context9.prev = _context9.next) {\n          case 0:\n            view = AddStoryView();\n            domNode = view.getView();\n            try {\n              mapPresenter = new MapPresenter({\n                bindInitMap: function () {\n                  var _bindInitMap = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee7(handler) {\n                    var result;\n                    return regenerator_default().wrap(function _callee7$(_context7) {\n                      while (1) switch (_context7.prev = _context7.next) {\n                        case 0:\n                          _context7.next = 2;\n                          return _initMapWithRetry(handler, \'map\', -6.2088, 106.8456, 12);\n                        case 2:\n                          result = _context7.sent;\n                          if (result !== null && result !== void 0 && result.map) {\n                            result.map.on(\'click\', function (e) {\n                              var _e$latlng = e.latlng,\n                                lat = _e$latlng.lat,\n                                lng = _e$latlng.lng;\n                              domNode.querySelector(\'#lat\').value = lat;\n                              domNode.querySelector(\'#lng\').value = lng;\n                              result.addMarker(lat, lng, \'Story location\');\n                            });\n                          }\n                          return _context7.abrupt("return", result === null || result === void 0 ? void 0 : result.map);\n                        case 5:\n                        case "end":\n                          return _context7.stop();\n                      }\n                    }, _callee7);\n                  }));\n                  function bindInitMap(_x7) {\n                    return _bindInitMap.apply(this, arguments);\n                  }\n                  return bindInitMap;\n                }(),\n                bindGetCurrentLocation: function bindGetCurrentLocation(handler) {\n                  var _domNode$querySelecto;\n                  (_domNode$querySelecto = domNode.querySelector(\'#get-location\')) === null || _domNode$querySelecto === void 0 || _domNode$querySelecto.addEventListener(\'click\', /*#__PURE__*/(0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee8() {\n                    var _mapPresenter$map, location;\n                    return regenerator_default().wrap(function _callee8$(_context8) {\n                      while (1) switch (_context8.prev = _context8.next) {\n                        case 0:\n                          _context8.prev = 0;\n                          _context8.next = 3;\n                          return handler();\n                        case 3:\n                          location = _context8.sent;\n                          domNode.querySelector(\'#lat\').value = location.lat;\n                          domNode.querySelector(\'#lng\').value = location.lng;\n                          mapPresenter.addMarker(location.lat, location.lng, \'Current location\');\n                          (_mapPresenter$map = mapPresenter.map) === null || _mapPresenter$map === void 0 || _mapPresenter$map.setView([location.lat, location.lng], 15);\n                          _context8.next = 13;\n                          break;\n                        case 10:\n                          _context8.prev = 10;\n                          _context8.t0 = _context8["catch"](0);\n                          view.showError(_context8.t0.message);\n                        case 13:\n                        case "end":\n                          return _context8.stop();\n                      }\n                    }, _callee8, null, [[0, 10]]);\n                  })));\n                }\n              });\n              new StoryPresenter(storyModel, {\n                bindAddStory: view.bindAddStory,\n                showError: view.showError,\n                showSuccess: view.showSuccess\n              }, router);\n            } catch (error) {\n              console.error(\'Add story initialization failed:\', error);\n              view.showError(\'Failed to initialize form\');\n            }\n            return _context9.abrupt("return", domNode);\n          case 4:\n          case "end":\n            return _context9.stop();\n        }\n      }, _callee9);\n    }));\n    function view() {\n      return _view6.apply(this, arguments);\n    }\n    return view;\n  }()\n}, {\n  path: \'/logout\',\n  view: function () {\n    var _view7 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee0() {\n      return regenerator_default().wrap(function _callee0$(_context0) {\n        while (1) switch (_context0.prev = _context0.next) {\n          case 0:\n            authModel.logout();\n            updateAuthUI(false);\n            router.navigateTo(\'/login\');\n            return _context0.abrupt("return", {\n              getView: function getView() {\n                return document.createElement(\'div\');\n              }\n            }.getView());\n          case 4:\n          case "end":\n            return _context0.stop();\n        }\n      }, _callee0);\n    }));\n    function view() {\n      return _view7.apply(this, arguments);\n    }\n    return view;\n  }()\n}, {\n  path: \'*\',\n  view: function view() {\n    return ErrorView().getView();\n  }\n}];\nwindow.addEventListener(\'beforeinstallprompt\', function (e) {\n  console.log(\'🔥 beforeinstallprompt fired\');\n});\nvar appRoot = document.getElementById("app");\nappRoot.appendChild(Header());\nvar deferredPrompt;\nwindow.addEventListener(\'beforeinstallprompt\', function (e) {\n  e.preventDefault();\n  deferredPrompt = e;\n  var installBtn = document.getElementById(\'install-button\');\n  if (installBtn) {\n    installBtn.style.display = \'inline-block\';\n    installBtn.addEventListener(\'click\', /*#__PURE__*/(0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee1() {\n      var choice;\n      return regenerator_default().wrap(function _callee1$(_context1) {\n        while (1) switch (_context1.prev = _context1.next) {\n          case 0:\n            installBtn.style.display = \'none\';\n            deferredPrompt.prompt();\n            _context1.next = 4;\n            return deferredPrompt.userChoice;\n          case 4:\n            choice = _context1.sent;\n            if (choice.outcome === \'accepted\') {\n              console.log(\'User accepted install\');\n            }\n            deferredPrompt = null;\n          case 7:\n          case "end":\n            return _context1.stop();\n        }\n      }, _callee1);\n    })));\n  }\n});\nvar router = new Router(routes);\nupdateAuthUI(authModel.isAuthenticated());\nif (\'serviceWorker\' in navigator) {\n  if (true) {\n    window.addEventListener(\'load\', function () {\n      navigator.serviceWorker.register(\'/sw.js\').then(function (registration) {\n        console.log(\'SW registered:\', registration);\n      })["catch"](function (error) {\n        console.log(\'SW registration failed:\', error);\n      });\n    });\n  }\n  navigator.serviceWorker.addEventListener(\'message\', function (event) {\n    var _event$data;\n    if (((_event$data = event.data) === null || _event$data === void 0 ? void 0 : _event$data.type) === \'TRIGGER_SYNC\') {\n      if (window.storyPresenter && typeof window.storyPresenter.handleOnline === \'function\') {\n        window.storyPresenter.handleOnline();\n      }\n    }\n  });\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNzQyNy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUNBO0FBQ0E7O0FBYUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7O0FDdkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOztBQUVBO0FBQ0E7Ozs7O0FDZEE7QUFDQTtBQUVBO0FBSUE7QUFDQTs7QUNSQTtBQUNBO0FBQ0E7QUFFQTtBQVFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7O0FDZkE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBcEVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBdUVBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUFBOzs7Ozs7Ozs7OztBQ3ZIQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQU5BO0FBQUE7QUFRQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQVZBO0FBQUE7QUFBQTtBQVlBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBTkE7QUFBQTtBQVFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBVkE7QUFBQTtBQUFBOzs7Ozs7Ozs7QUNkQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQXRCQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBd0JBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQWhCQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQW1CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQUE7QUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ2xFQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBTkE7QUFBQTtBQVFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBVkE7QUFBQTtBQUFBO0FBWUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBTkE7QUFBQTtBQVFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBVkE7QUFBQTtBQUFBO0FBWUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUZBO0FBQUE7QUFBQTtBQUlBO0FBQUE7QUFDQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBZkE7QUFBQTtBQUFBO0FBaUJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBSkE7QUFBQTtBQU1BO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBUkE7QUFBQTtBQUFBO0FBVUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFOQTtBQUFBO0FBUUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFsQkE7QUFBQTtBQUFBO0FBb0JBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUFBO0FBSEE7QUFBQTtBQUtBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBZkE7QUFBQTtBQUFBO0FBaUJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBUEE7QUFBQTtBQVNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBWEE7QUFBQTtBQUFBO0FBYUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBUEE7QUFBQTtBQVNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBWEE7QUFBQTtBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUN2R0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFuQkE7QUFBQTtBQUFBO0FBcUJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBaEJBO0FBQUE7QUFBQTtBQWtCQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFqQkE7QUFBQTtBQUFBO0FBbUJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBaEJBO0FBQUE7QUFBQTtBQWtCQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFHQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUdBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQTFCQTtBQUFBO0FBQUE7QUEwQkE7QUFHQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQWJBO0FBQUE7QUFBQTtBQWVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFHQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQVhBO0FBQUE7QUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUN4SkE7QUFPQTtBQU9BO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQXhCQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBMEJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBbEJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFvQkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFGQTtBQUFBO0FBSUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFJQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBN0JBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUErQkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQS9CQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQWtDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBRkE7QUFBQTtBQUFBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBTEE7QUFBQTtBQU9BO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUtBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQXREQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBd0RBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBSEE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUtBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUhBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFLQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBRkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQzVNQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDQUE7QUFDQTtBQUtBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFHQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUdBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBWkE7QUFBQTtBQUFBO0FBY0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBR0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFBQTtBQUhBO0FBQUE7QUFBQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBVEE7QUFBQTtBQVdBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUFBO0FBQ0E7QUFBQTtBQUlBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBM0NBO0FBQUE7QUFBQTtBQTZDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFLQTtBQUhBO0FBQUE7QUFLQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBR0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUF2QkE7QUFBQTtBQUFBO0FBeUJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUdBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBR0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUlBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBMUJBO0FBQUE7QUFBQTtBQTRCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUN6SUE7QUFDQTtBQU1BO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQ0E7O0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBS0E7O0FBRUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUE1QkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQThCQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFkQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBZ0JBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBYkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUN2RUE7QUFFQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBYkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFlQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBakJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFtQkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFFQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQXhCQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBMEJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQWRBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFnQkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBakJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFtQkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQXhCQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQTJCQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBN0JBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBZ0NBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7Ozs7Ozs7O0FDN09BO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBVEE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQVdBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBR0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQXRCQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBd0JBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBWEE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFhQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBOzs7Ozs7Ozs7QUMzRkE7QUFFQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBZEE7QUFBQTtBQUFBO0FBZ0JBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFZQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7QUNsRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FDN0RBO0FBRUE7QUFBQTtBQUNBO0FBRUE7QUFpQkE7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDMUNBO0FBRUE7QUFDQTtBQTBCQTtBQUNBO0FBQ0E7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFJQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7QUN6REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBT0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTs7QUFVQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQzNHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQTJDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFuREE7QUFBQTtBQUFBO0FBcURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDbFFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOztBQThDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUdBO0FBRUE7QUFDQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7O0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBUkE7QUFBQTtBQUFBO0FBVUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQXRDQTtBQUFBO0FBQUE7QUF3Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUlBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUlBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUEvQkE7QUFBQTtBQUFBO0FBaUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTs7QUMzWUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7O0FDZEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBSUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQVpBO0FBQUE7QUFBQTtBQWNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFkQTtBQUFBO0FBQUE7QUFBQTtBQWVBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBZkE7QUFBQTtBQUFBO0FBQUE7QUFnQkE7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUlBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBeEJBO0FBQUE7QUFBQTtBQUFBO0FBeUJBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBZkE7QUFBQTtBQUFBO0FBQUE7QUFnQkE7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFFQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBRUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQWxEQTtBQUFBO0FBQUE7QUFBQTtBQW1EQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQVhBO0FBQUE7QUFBQTtBQUFBO0FBWUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBRUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQWhEQTtBQUFBO0FBQUE7QUFBQTtBQWlEQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQVBBO0FBQUE7QUFBQTtBQUFBO0FBUUE7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBR0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUdBO0FBRUE7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL3N0b3J5LWFwcC8uL3NyYy9jb21wb25lbnRzL0hlYWRlci5qcz9hZDhlIiwid2VicGFjazovL3N0b3J5LWFwcC8uL3NyYy91dGlscy92aWV3LXRyYW5zaXRpb24uanM/MmQwZiIsIndlYnBhY2s6Ly9zdG9yeS1hcHAvLi9zcmMvY29tcG9uZW50cy9Gb290ZXIuanM/MjcwYiIsIndlYnBhY2s6Ly9zdG9yeS1hcHAvLi9zcmMvdmlld3MvRXJyb3JWaWV3LmpzPzU5ODMiLCJ3ZWJwYWNrOi8vc3RvcnktYXBwLy4vc3JjL3JvdXRlci5qcz80MWNiIiwid2VicGFjazovL3N0b3J5LWFwcC8uL3NyYy9zZXJ2aWNlcy9hdXRoQXBpLmpzPzAxOTIiLCJ3ZWJwYWNrOi8vc3RvcnktYXBwLy4vc3JjL21vZGVscy9BdXRoTW9kZWwuanM/Nzg2NyIsIndlYnBhY2s6Ly9zdG9yeS1hcHAvLi9zcmMvZGF0YS9hcGkuanM/OTA5ZiIsIndlYnBhY2s6Ly9zdG9yeS1hcHAvLi9zcmMvZGF0YS9kYXRhYmFzZS5qcz8zOTJmIiwid2VicGFjazovL3N0b3J5LWFwcC8uL3NyYy9tb2RlbHMvU3RvcnlNb2RlbC5qcz8wM2Q4Iiwid2VicGFjazovL3N0b3J5LWFwcC8uL3NyYy91dGlscy9jb25maWcuanM/MDFlYSIsIndlYnBhY2s6Ly9zdG9yeS1hcHAvLi9zcmMvdXRpbHMvbm90aWZpY2F0aW9uLmpzPzIxYWMiLCJ3ZWJwYWNrOi8vc3RvcnktYXBwLy4vc3JjL3ByZXNlbnRlcnMvQXV0aFByZXNlbnRlci5qcz82Yzc4Iiwid2VicGFjazovL3N0b3J5LWFwcC8uL3NyYy9wcmVzZW50ZXJzL1N0b3J5UHJlc2VudGVyLmpzPzQxOGYiLCJ3ZWJwYWNrOi8vc3RvcnktYXBwLy4vc3JjL3ByZXNlbnRlcnMvTWFwUHJlc2VudGVyLmpzPzMzOTgiLCJ3ZWJwYWNrOi8vc3RvcnktYXBwLy4vc3JjL3V0aWxzL1NraXBUb0NvbnRlbnQuanM/OWEyYyIsIndlYnBhY2s6Ly9zdG9yeS1hcHAvLi9zcmMvdmlld3MvQmFzZVZpZXcuanM/NzRkZiIsIndlYnBhY2s6Ly9zdG9yeS1hcHAvLi9zcmMvdmlld3MvYXV0aC9Mb2dpblZpZXcuanM/MWQ1NyIsIndlYnBhY2s6Ly9zdG9yeS1hcHAvLi9zcmMvdmlld3MvYXV0aC9SZWdpc3RlclZpZXcuanM/ODY1OCIsIndlYnBhY2s6Ly9zdG9yeS1hcHAvLi9zcmMvdmlld3Mvc3Rvcmllcy9TdG9yaWVzVmlldy5qcz9kYjBlIiwid2VicGFjazovL3N0b3J5LWFwcC8uL3NyYy92aWV3cy9zdG9yaWVzL0RldGFpbFN0b3J5Vmlldy5qcz9iYmE4Iiwid2VicGFjazovL3N0b3J5LWFwcC8uL3NyYy92aWV3cy9zdG9yaWVzL0FkZFN0b3J5Vmlldy5qcz80ZTBkIiwid2VicGFjazovL3N0b3J5LWFwcC8uL3NyYy91dGlscy9hdXRoLmpzPzVmODciLCJ3ZWJwYWNrOi8vc3RvcnktYXBwLy4vc3JjL2FwcC5qcz8xMTEyIl0sInNvdXJjZXNDb250ZW50IjpbImxldCBjdXJyZW50QXV0aFN0YXRlID0gZmFsc2U7XHJcblxyXG5leHBvcnQgY29uc3QgdXBkYXRlQXV0aFVJID0gKGlzTG9nZ2VkSW4pID0+IHtcclxuICBjdXJyZW50QXV0aFN0YXRlID0gaXNMb2dnZWRJbjtcclxuICBjb25zdCBsb2dvdXRMaSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dvdXQtbGknKTtcclxuICBpZiAobG9nb3V0TGkpIHtcclxuICAgIGxvZ291dExpLnN0eWxlLmRpc3BsYXkgPSBpc0xvZ2dlZEluID8gJ2Jsb2NrJyA6ICdub25lJztcclxuICB9XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgSGVhZGVyID0gKCkgPT4ge1xyXG4gIGNvbnN0IGhlYWRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJoZWFkZXJcIik7XHJcbiAgaGVhZGVyLmlubmVySFRNTCA9IGBcclxuICAgIDxuYXY+XHJcbiAgICAgIDx1bD5cclxuICAgICAgICA8bGk+PGEgaHJlZj1cIiMvc3Rvcmllc1wiIGRhdGEtbmF2aWdvPlN0b3JpZXM8L2E+PC9saT5cclxuICAgICAgICA8bGk+PGEgaHJlZj1cIiMvYWRkLXN0b3J5XCIgZGF0YS1uYXZpZ28+QWRkIFN0b3J5PC9hPjwvbGk+XHJcbiAgICAgICAgPGxpPjxidXR0b24gaWQ9XCJpbnN0YWxsLWJ1dHRvblwiIGNsYXNzPVwiaW5zdGFsbC1idG5cIiBzdHlsZT1cImRpc3BsYXk6IG5vbmU7XCI+SW5zdGFsbCBBcHA8L2J1dHRvbj48L2xpPlxyXG4gICAgICAgIDxsaSBpZD1cImxvZ291dC1saVwiIHN0eWxlPVwiZGlzcGxheTogJHtjdXJyZW50QXV0aFN0YXRlID8gJ2Jsb2NrJyA6ICdub25lJ31cIj5cclxuICAgICAgICAgIDxidXR0b24gaWQ9XCJsb2dvdXQtYnV0dG9uXCI+TG9nb3V0PC9idXR0b24+XHJcbiAgICAgICAgPC9saT5cclxuICAgICAgPC91bD5cclxuICAgIDwvbmF2PlxyXG4gIGA7XHJcblxyXG4gIC8vIExvZ291dCBoYW5kbGVyXHJcbiAgaGVhZGVyLnF1ZXJ5U2VsZWN0b3IoJyNsb2dvdXQtYnV0dG9uJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdsb2dvdXQnKSk7XHJcbiAgfSk7XHJcblxyXG4gIC8vIE5hdmlnYXRpb24gaGFuZGxlclxyXG4gIGNvbnN0IG5hdkxpbmtzID0gaGVhZGVyLnF1ZXJ5U2VsZWN0b3JBbGwoJ2FbZGF0YS1uYXZpZ29dJyk7XHJcbiAgbmF2TGlua3MuZm9yRWFjaChsaW5rID0+IHtcclxuICAgIGxpbmsuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaGVhZGVyLW5hdmlnYXRpb24nKSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgcmV0dXJuIGhlYWRlcjtcclxufTtcclxuIiwiZXhwb3J0IGNvbnN0IHN0YXJ0Vmlld1RyYW5zaXRpb24gPSAoY2FsbGJhY2spID0+IHtcclxuICBpZiAoIWRvY3VtZW50LnN0YXJ0Vmlld1RyYW5zaXRpb24pIHtcclxuICAgIGNhbGxiYWNrKCk7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG5cclxuICBkb2N1bWVudC5zdGFydFZpZXdUcmFuc2l0aW9uKCgpID0+IHtcclxuICAgIGNhbGxiYWNrKCk7XHJcbiAgfSk7XHJcbn07XHJcblxyXG5kb2N1bWVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgndmlldy10cmFuc2l0aW9uLXN0YXJ0JykpO1xyXG5cclxuLy8gQXJvdW5kIHdoZXJlIHlvdXIgdHJhbnNpdGlvbiBjb21wbGV0ZXNcclxuZG9jdW1lbnQuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ3ZpZXctdHJhbnNpdGlvbi1lbmQnKSk7IiwiZXhwb3J0IGNvbnN0IEZvb3RlciA9ICgpID0+IHtcclxuICBjb25zdCBmb290ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZm9vdGVyXCIpO1xyXG5cclxuICBmb290ZXIuaW5uZXJIVE1MID0gYFxyXG4gICAgICA8cD4mY29weTsgJHtuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCl9IFN0b3J5IEFwcC4gQWxsIHJpZ2h0cyByZXNlcnZlZC48L3A+XHJcbiAgICBgO1xyXG5cclxuICByZXR1cm4gZm9vdGVyO1xyXG59O1xyXG4iLCJleHBvcnQgY29uc3QgRXJyb3JWaWV3ID0gKCkgPT4ge1xyXG4gIGNvbnN0IHZpZXcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdtYWluJyk7XHJcbiAgdmlldy5pZCA9ICdtYWluLWNvbnRlbnQnO1xyXG4gIFxyXG4gIHZpZXcuaW5uZXJIVE1MID0gYFxyXG4gICAgPGRpdiBjbGFzcz1cImVycm9yLW1lc3NhZ2VcIj5cclxuICAgICAgPGgxPjQwNCBOb3QgRm91bmQ8L2gxPlxyXG4gICAgICA8cD5UaGUgcGFnZSB5b3UncmUgbG9va2luZyBmb3IgZG9lc24ndCBleGlzdC48L3A+XHJcbiAgICAgIDxhIGhyZWY9XCIjL1wiPkdvIHRvIEhvbWU8L2E+XHJcbiAgICA8L2Rpdj5cclxuICBgO1xyXG4gIFxyXG4gIHJldHVybiB7XHJcbiAgICBnZXRWaWV3OiAoKSA9PiB2aWV3XHJcbiAgfTtcclxufTsiLCJpbXBvcnQgeyBzdGFydFZpZXdUcmFuc2l0aW9uIH0gZnJvbSBcIi4vdXRpbHMvdmlldy10cmFuc2l0aW9uLmpzXCI7XHJcbmltcG9ydCB7IEhlYWRlciB9IGZyb20gXCIuL2NvbXBvbmVudHMvSGVhZGVyLmpzXCI7XHJcbmltcG9ydCB7IEZvb3RlciB9IGZyb20gXCIuL2NvbXBvbmVudHMvRm9vdGVyLmpzXCI7XHJcbmltcG9ydCB7IEVycm9yVmlldyB9IGZyb20gXCIuL3ZpZXdzL0Vycm9yVmlldy5qc1wiO1xyXG5cclxuZXhwb3J0IGNsYXNzIFJvdXRlciB7XHJcbiAgY29uc3RydWN0b3Iocm91dGVzKSB7XHJcbiAgICB0aGlzLnJvdXRlcyA9IHJvdXRlcztcclxuICAgIHRoaXMucm9vdEVsZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImFwcFwiKTtcclxuICAgIHRoaXMuY3VycmVudFByZXNlbnRlciA9IG51bGw7XHJcbiAgICB0aGlzLmluaXQoKTtcclxuICB9XHJcblxyXG4gIGluaXQoKSB7XHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImhhc2hjaGFuZ2VcIiwgKCkgPT4gdGhpcy5oYW5kbGVSb3V0aW5nKCkpO1xyXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsICgpID0+IHRoaXMuaGFuZGxlUm91dGluZygpKTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGhhbmRsZVJvdXRpbmcoKSB7XHJcbiAgICBjb25zdCB1cmwgPSB3aW5kb3cubG9jYXRpb24uaGFzaC5zbGljZSgxKSB8fCBcIi9cIjtcclxuICAgIGxldCBwYXJhbXMgPSB7fTtcclxuICAgIGNvbnN0IHJvdXRlID0gdGhpcy5maW5kTWF0Y2hpbmdSb3V0ZSh1cmwsIHBhcmFtcykgfHwgXHJcbiAgICAgICAgICAgICAgICAgdGhpcy5yb3V0ZXMuZmluZCgocikgPT4gci5wYXRoID09PSBcIipcIik7XHJcblxyXG4gICAgLy8gQ2xlYW4gdXAgcHJldmlvdXMgdmlld1xyXG4gICAgaWYgKHRoaXMuY3VycmVudFByZXNlbnRlcj8uY2xlYW51cCkge1xyXG4gICAgICB0aGlzLmN1cnJlbnRQcmVzZW50ZXIuY2xlYW51cCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGF3YWl0IHN0YXJ0Vmlld1RyYW5zaXRpb24oYXN5bmMgKCkgPT4ge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIHRoaXMucm9vdEVsZW0uaW5uZXJIVE1MID0gXCJcIjtcclxuXHJcbiAgICAgICAgLy8gQWRkIGhlYWRlciBpZiBhdXRoZW50aWNhdGVkXHJcbiAgICAgICAgaWYgKCFbXCIvbG9naW5cIiwgXCIvcmVnaXN0ZXJcIl0uaW5jbHVkZXModXJsKSkge1xyXG4gICAgICAgICAgY29uc3QgaGVhZGVyID0gSGVhZGVyKCk7XHJcbiAgICAgICAgICBjb25zdCBoZWFkZXJFbGVtZW50ID0gaGVhZGVyLmdldFZpZXc/LigpIHx8IGhlYWRlcjtcclxuICAgICAgICAgIGlmIChoZWFkZXJFbGVtZW50IGluc3RhbmNlb2YgTm9kZSkge1xyXG4gICAgICAgICAgICB0aGlzLnJvb3RFbGVtLmFwcGVuZENoaWxkKGhlYWRlckVsZW1lbnQpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gTG9hZCB2aWV3XHJcbiAgICAgICAgY29uc3QgdmlldyA9IGF3YWl0IHJvdXRlLnZpZXcocGFyYW1zKTtcclxuICAgICAgICBjb25zdCB2aWV3RWxlbWVudCA9IHZpZXcuZ2V0Vmlldz8uKCkgfHwgdmlldztcclxuXHJcbiAgICAgICAgaWYgKCEodmlld0VsZW1lbnQgaW5zdGFuY2VvZiBOb2RlKSkge1xyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVmlldyBpcyBub3QgYSB2YWxpZCBET00gbm9kZVwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIEVuc3VyZSBtYWluIGNvbnRlbnQgZXhpc3RzXHJcbiAgICAgICAgY29uc3QgbWFpbkNvbnRlbnQgPSB2aWV3RWxlbWVudC5xdWVyeVNlbGVjdG9yKCdtYWluJykgfHwgdmlld0VsZW1lbnQ7XHJcbiAgICAgICAgaWYgKCFtYWluQ29udGVudC5pZCkge1xyXG4gICAgICAgICAgbWFpbkNvbnRlbnQuaWQgPSBcIm1haW4tY29udGVudFwiO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5yb290RWxlbS5hcHBlbmRDaGlsZCh2aWV3RWxlbWVudCk7XHJcblxyXG4gICAgICAgIC8vIEFkZCBmb290ZXJcclxuICAgICAgICBjb25zdCBmb290ZXIgPSBGb290ZXIoKTtcclxuICAgICAgICBjb25zdCBmb290ZXJFbGVtZW50ID0gZm9vdGVyLmdldFZpZXc/LigpIHx8IGZvb3RlcjtcclxuICAgICAgICBpZiAoZm9vdGVyRWxlbWVudCBpbnN0YW5jZW9mIE5vZGUpIHtcclxuICAgICAgICAgIHRoaXMucm9vdEVsZW0uYXBwZW5kQ2hpbGQoZm9vdGVyRWxlbWVudCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBTZXQgZm9jdXMgdG8gZmlyc3QgZm9jdXNhYmxlIGVsZW1lbnRcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgIGNvbnN0IGZpcnN0Rm9jdXNhYmxlID0gdGhpcy5yb290RWxlbS5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICAgICAgICAnYnV0dG9uLCBbaHJlZl0sIGlucHV0LCBzZWxlY3QsIHRleHRhcmVhLCBbdGFiaW5kZXhdOm5vdChbdGFiaW5kZXg9XCItMVwiXSknXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgICAgZmlyc3RGb2N1c2FibGU/LmZvY3VzKCk7XHJcbiAgICAgICAgfSwgMTAwKTtcclxuXHJcbiAgICAgICAgLy8gU3RvcmUgcHJlc2VudGVyXHJcbiAgICAgICAgaWYgKHJvdXRlLnByZXNlbnRlcikge1xyXG4gICAgICAgICAgdGhpcy5jdXJyZW50UHJlc2VudGVyID0gcm91dGUucHJlc2VudGVyO1xyXG4gICAgICAgICAgdGhpcy5jdXJyZW50UHJlc2VudGVyLmFmdGVyUmVuZGVyPy4oKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJSb3V0aW5nIGVycm9yOlwiLCBlcnJvcik7XHJcbiAgICAgICAgY29uc3QgZXJyb3JWaWV3ID0gRXJyb3JWaWV3KCk7XHJcbiAgICAgICAgdGhpcy5yb290RWxlbS5pbm5lckhUTUwgPSBcIlwiO1xyXG4gICAgICAgIHRoaXMucm9vdEVsZW0uYXBwZW5kQ2hpbGQoZXJyb3JWaWV3LmdldFZpZXcoKSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZmluZE1hdGNoaW5nUm91dGUodXJsLCBwYXJhbXMpIHtcclxuICAgIHJldHVybiB0aGlzLnJvdXRlcy5maW5kKChyb3V0ZSkgPT4ge1xyXG4gICAgICBjb25zdCByb3V0ZVBhcnRzID0gcm91dGUucGF0aC5zcGxpdChcIi9cIik7XHJcbiAgICAgIGNvbnN0IHVybFBhcnRzID0gdXJsLnNwbGl0KFwiL1wiKTtcclxuXHJcbiAgICAgIGlmIChyb3V0ZVBhcnRzLmxlbmd0aCAhPT0gdXJsUGFydHMubGVuZ3RoKSByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJvdXRlUGFydHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBjb25zdCByb3V0ZVBhcnQgPSByb3V0ZVBhcnRzW2ldO1xyXG4gICAgICAgIGNvbnN0IHVybFBhcnQgPSB1cmxQYXJ0c1tpXTtcclxuXHJcbiAgICAgICAgaWYgKHJvdXRlUGFydC5zdGFydHNXaXRoKFwiOlwiKSkge1xyXG4gICAgICAgICAgY29uc3QgcGFyYW1OYW1lID0gcm91dGVQYXJ0LnNsaWNlKDEpO1xyXG4gICAgICAgICAgcGFyYW1zW3BhcmFtTmFtZV0gPSB1cmxQYXJ0O1xyXG4gICAgICAgIH0gZWxzZSBpZiAocm91dGVQYXJ0ICE9PSB1cmxQYXJ0KSB7XHJcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbmF2aWdhdGVUbyhwYXRoKSB7XHJcbiAgICBjb25zdCBjdXJyZW50UGF0aCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoLnNsaWNlKDEpIHx8IFwiL1wiO1xyXG5cclxuICAgIGlmIChjdXJyZW50UGF0aCA9PT0gXCIvYWRkLXN0b3J5XCIgJiYgdGhpcy5jdXJyZW50UHJlc2VudGVyKSB7XHJcbiAgICAgIHRoaXMuY3VycmVudFByZXNlbnRlci5jbGVhbnVwKCk7XHJcbiAgICB9XHJcblxyXG4gICAgd2luZG93LmxvY2F0aW9uLmhhc2ggPSBwYXRoO1xyXG4gIH1cclxufSIsImNvbnN0IEFQSV9CQVNFX1VSTCA9ICdodHRwczovL3N0b3J5LWFwaS5kaWNvZGluZy5kZXYvdjEnO1xyXG5cclxuZXhwb3J0IGNvbnN0IGxvZ2luID0gYXN5bmMgKGVtYWlsLCBwYXNzd29yZCkgPT4ge1xyXG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7QVBJX0JBU0VfVVJMfS9sb2dpbmAsIHtcclxuICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgaGVhZGVyczoge1xyXG4gICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgfSxcclxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgZW1haWwsIHBhc3N3b3JkIH0pLFxyXG4gIH0pO1xyXG4gIFxyXG4gIHJldHVybiByZXNwb25zZS5qc29uKCk7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgcmVnaXN0ZXIgPSBhc3luYyAobmFtZSwgZW1haWwsIHBhc3N3b3JkKSA9PiB7XHJcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtBUElfQkFTRV9VUkx9L3JlZ2lzdGVyYCwge1xyXG4gICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICBoZWFkZXJzOiB7XHJcbiAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICB9LFxyXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBuYW1lLCBlbWFpbCwgcGFzc3dvcmQgfSksXHJcbiAgfSk7XHJcbiAgXHJcbiAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcclxufTsiLCJpbXBvcnQgeyBsb2dpbiwgcmVnaXN0ZXIgfSBmcm9tICcuLi9zZXJ2aWNlcy9hdXRoQXBpJztcclxuZXhwb3J0IGNsYXNzIEF1dGhNb2RlbCB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLnRva2VuID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJ0b2tlblwiKSB8fCBudWxsO1xyXG4gICAgdGhpcy51c2VyID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInVzZXJcIikpIHx8IG51bGw7XHJcbiAgfVxyXG5cclxuICBhc3luYyBsb2dpbihlbWFpbCwgcGFzc3dvcmQpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgbG9naW4oZW1haWwsIHBhc3N3b3JkKTtcclxuXHJcbiAgICAgIGlmICghcmVzcG9uc2UuZXJyb3IpIHtcclxuICAgICAgICB0aGlzLnRva2VuID0gcmVzcG9uc2UubG9naW5SZXN1bHQudG9rZW47XHJcbiAgICAgICAgdGhpcy51c2VyID0ge1xyXG4gICAgICAgICAgdXNlcklkOiByZXNwb25zZS5sb2dpblJlc3VsdC51c2VySWQsXHJcbiAgICAgICAgICBuYW1lOiByZXNwb25zZS5sb2dpblJlc3VsdC5uYW1lLFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFwidG9rZW5cIiwgdGhpcy50b2tlbik7XHJcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJ1c2VyXCIsIEpTT04uc3RyaW5naWZ5KHRoaXMudXNlcikpO1xyXG5cclxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCB1c2VyOiB0aGlzLnVzZXIgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IHJlc3BvbnNlLm1lc3NhZ2UgfTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJMb2dpbiBlcnJvcjpcIiwgZXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJMb2dpbiBmYWlsZWQuIFBsZWFzZSB0cnkgYWdhaW4uXCIgfTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIHJlZ2lzdGVyKG5hbWUsIGVtYWlsLCBwYXNzd29yZCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZWdpc3RlcihuYW1lLCBlbWFpbCwgcGFzc3dvcmQpO1xyXG5cclxuICAgICAgaWYgKCFyZXNwb25zZS5lcnJvcikge1xyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IHJlc3BvbnNlLm1lc3NhZ2UgfTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJSZWdpc3RyYXRpb24gZXJyb3I6XCIsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBtZXNzYWdlOiBcIlJlZ2lzdHJhdGlvbiBmYWlsZWQuIFBsZWFzZSB0cnkgYWdhaW4uXCIsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBsb2dvdXQoKSB7XHJcbiAgICB0aGlzLnRva2VuID0gbnVsbDtcclxuICAgIHRoaXMudXNlciA9IG51bGw7XHJcbiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShcInRva2VuXCIpO1xyXG4gICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oXCJ1c2VyXCIpO1xyXG4gIH1cclxuXHJcbiAgaXNBdXRoZW50aWNhdGVkKCkge1xyXG4gICAgcmV0dXJuICEhdGhpcy50b2tlbjtcclxuICB9XHJcblxyXG4gIGdldFVzZXIoKSB7XHJcbiAgICByZXR1cm4gdGhpcy51c2VyO1xyXG4gIH1cclxuXHJcbiAgZ2V0VG9rZW4oKSB7XHJcbiAgICByZXR1cm4gdGhpcy50b2tlbjtcclxuICB9XHJcbn1cclxuIiwiY29uc3QgQVBJX0JBU0VfVVJMID0gXCJodHRwczovL3N0b3J5LWFwaS5kaWNvZGluZy5kZXYvdjFcIjtcclxuXHJcbmV4cG9ydCBjb25zdCByZWdpc3RlciA9IGFzeW5jIChuYW1lLCBlbWFpbCwgcGFzc3dvcmQpID0+IHtcclxuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke0FQSV9CQVNFX1VSTH0vcmVnaXN0ZXJgLCB7XHJcbiAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgaGVhZGVyczoge1xyXG4gICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICAgIH0sXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IG5hbWUsIGVtYWlsLCBwYXNzd29yZCB9KSxcclxuICB9KTtcclxuXHJcbiAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBsb2dpbiA9IGFzeW5jIChlbWFpbCwgcGFzc3dvcmQpID0+IHtcclxuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke0FQSV9CQVNFX1VSTH0vbG9naW5gLCB7XHJcbiAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgaGVhZGVyczoge1xyXG4gICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICAgIH0sXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGVtYWlsLCBwYXNzd29yZCB9KSxcclxuICB9KTtcclxuXHJcbiAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBnZXRBbGxTdG9yaWVzID0gYXN5bmMgKHRva2VuLCBwYWdlLCBzaXplLCB3aXRoTG9jYXRpb24pID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtBUElfQkFTRV9VUkx9L3N0b3JpZXM/cGFnZT0ke3BhZ2V9JnNpemU9JHtzaXplfSZsb2NhdGlvbj0ke3dpdGhMb2NhdGlvbiA/IDEgOiAwfWAsIHtcclxuICAgICAgaGVhZGVyczogeyBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW59YCB9XHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcclxuICAgIGNvbnNvbGUubG9nKCdBUEkgUmVzcG9uc2U6JywgZGF0YSk7IC8vIERlYnVnIGxvZ1xyXG4gICAgXHJcbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB0aHJvdyBuZXcgRXJyb3IoZGF0YS5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZmV0Y2gnKTtcclxuICAgIHJldHVybiBkYXRhO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdBUEkgRXJyb3I6JywgZXJyb3IpO1xyXG4gICAgdGhyb3cgZXJyb3I7XHJcbiAgfVxyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGdldFN0b3J5RGV0YWlsID0gYXN5bmMgKGlkLCB0b2tlbikgPT4ge1xyXG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7QVBJX0JBU0VfVVJMfS9zdG9yaWVzLyR7aWR9YCwge1xyXG4gICAgaGVhZGVyczoge1xyXG4gICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW59YCxcclxuICAgIH0sXHJcbiAgfSk7XHJcblxyXG4gIHJldHVybiByZXNwb25zZS5qc29uKCk7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgYWRkU3RvcnkgPSBhc3luYyAoZGF0YSwgdG9rZW4pID0+IHtcclxuICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xyXG4gIGZvcm1EYXRhLmFwcGVuZChcImRlc2NyaXB0aW9uXCIsIGRhdGEuZGVzY3JpcHRpb24pO1xyXG4gIGZvcm1EYXRhLmFwcGVuZChcInBob3RvXCIsIGRhdGEucGhvdG8pO1xyXG4gIGlmIChkYXRhLmxhdCAmJiBkYXRhLmxvbikge1xyXG4gICAgZm9ybURhdGEuYXBwZW5kKFwibGF0XCIsIGRhdGEubGF0KTtcclxuICAgIGZvcm1EYXRhLmFwcGVuZChcImxvblwiLCBkYXRhLmxvbik7XHJcbiAgfVxyXG5cclxuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke0FQSV9CQVNFX1VSTH0vc3Rvcmllc2AsIHtcclxuICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICBoZWFkZXJzOiB7XHJcbiAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gLFxyXG4gICAgfSxcclxuICAgIGJvZHk6IGZvcm1EYXRhLFxyXG4gIH0pO1xyXG5cclxuICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGFkZFN0b3J5R3Vlc3QgPSBhc3luYyAoZGF0YSkgPT4ge1xyXG4gIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgZm9ybURhdGEuYXBwZW5kKFwiZGVzY3JpcHRpb25cIiwgZGF0YS5kZXNjcmlwdGlvbik7XHJcbiAgZm9ybURhdGEuYXBwZW5kKFwicGhvdG9cIiwgZGF0YS5waG90byk7XHJcbiAgaWYgKGRhdGEubGF0ICYmIGRhdGEubG9uKSB7XHJcbiAgICBmb3JtRGF0YS5hcHBlbmQoXCJsYXRcIiwgZGF0YS5sYXQpO1xyXG4gICAgZm9ybURhdGEuYXBwZW5kKFwibG9uXCIsIGRhdGEubG9uKTtcclxuICB9XHJcblxyXG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7QVBJX0JBU0VfVVJMfS9zdG9yaWVzL2d1ZXN0YCwge1xyXG4gICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgIGJvZHk6IGZvcm1EYXRhLFxyXG4gIH0pO1xyXG5cclxuICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IHN1YnNjcmliZVRvTm90aWZpY2F0aW9ucyA9IGFzeW5jIChzdWJzY3JpcHRpb24sIHRva2VuKSA9PiB7XHJcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtBUElfQkFTRV9VUkx9L25vdGlmaWNhdGlvbnMvc3Vic2NyaWJlYCwge1xyXG4gICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgIGhlYWRlcnM6IHtcclxuICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcbiAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gLFxyXG4gICAgfSxcclxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHN1YnNjcmlwdGlvbiksXHJcbiAgfSk7XHJcblxyXG4gIHJldHVybiByZXNwb25zZS5qc29uKCk7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgdW5zdWJzY3JpYmVGcm9tTm90aWZpY2F0aW9ucyA9IGFzeW5jIChlbmRwb2ludCwgdG9rZW4pID0+IHtcclxuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke0FQSV9CQVNFX1VSTH0vbm90aWZpY2F0aW9ucy9zdWJzY3JpYmVgLCB7XHJcbiAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICBoZWFkZXJzOiB7XHJcbiAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW59YCxcclxuICAgIH0sXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGVuZHBvaW50IH0pLFxyXG4gIH0pO1xyXG5cclxuICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xyXG59O1xyXG4iLCJleHBvcnQgY29uc3QgaW5pdERCID0gKCkgPT4ge1xyXG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICBjb25zdCByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oXCJTdG9yeUFwcERCXCIsIDEpO1xyXG5cclxuICAgIHJlcXVlc3Qub25lcnJvciA9IChldmVudCkgPT4ge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFwiRGF0YWJhc2UgZXJyb3I6XCIsIGV2ZW50LnRhcmdldC5lcnJvcik7XHJcbiAgICAgIHJlamVjdChcIkRhdGFiYXNlIGVycm9yXCIpO1xyXG4gICAgfTtcclxuXHJcbiAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IChldmVudCkgPT4ge1xyXG4gICAgICBjb25zdCBkYiA9IGV2ZW50LnRhcmdldC5yZXN1bHQ7XHJcblxyXG4gICAgICAvLyBDcmVhdGUgb2JqZWN0IHN0b3JlIGZvciBzdG9yaWVzXHJcbiAgICAgIGlmICghZGIub2JqZWN0U3RvcmVOYW1lcy5jb250YWlucyhcInN0b3JpZXNcIikpIHtcclxuICAgICAgICBjb25zdCBzdG9yaWVzU3RvcmUgPSBkYi5jcmVhdGVPYmplY3RTdG9yZShcInN0b3JpZXNcIiwgeyBrZXlQYXRoOiBcImlkXCIgfSk7XHJcbiAgICAgICAgc3Rvcmllc1N0b3JlLmNyZWF0ZUluZGV4KFwiY3JlYXRlZEF0XCIsIFwiY3JlYXRlZEF0XCIsIHsgdW5pcXVlOiBmYWxzZSB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gQ3JlYXRlIG9iamVjdCBzdG9yZSBmb3IgdXNlciBkYXRhXHJcbiAgICAgIGlmICghZGIub2JqZWN0U3RvcmVOYW1lcy5jb250YWlucyhcInVzZXJcIikpIHtcclxuICAgICAgICBkYi5jcmVhdGVPYmplY3RTdG9yZShcInVzZXJcIiwgeyBrZXlQYXRoOiBcImlkXCIgfSk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSAoZXZlbnQpID0+IHtcclxuICAgICAgcmVzb2x2ZShldmVudC50YXJnZXQucmVzdWx0KTtcclxuICAgIH07XHJcbiAgfSk7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3Qgc2F2ZVN0b3JpZXMgPSBhc3luYyAoc3RvcmllcykgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBkYiA9IGF3YWl0IGluaXREQigpO1xyXG4gICAgY29uc3QgdHJhbnNhY3Rpb24gPSBkYi50cmFuc2FjdGlvbihcInN0b3JpZXNcIiwgXCJyZWFkd3JpdGVcIik7XHJcbiAgICBjb25zdCBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKFwic3Rvcmllc1wiKTtcclxuXHJcbiAgICBzdG9yaWVzLmZvckVhY2goKHN0b3J5KSA9PiB7XHJcbiAgICAgIHN0b3JlLnB1dChzdG9yeSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcclxuICAgICAgdHJhbnNhY3Rpb24ub25jb21wbGV0ZSA9ICgpID0+IHtcclxuICAgICAgICByZXNvbHZlKHRydWUpO1xyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gc2F2ZSBzdG9yaWVzOlwiLCBlcnJvcik7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGdldFN0b3JpZXMgPSBhc3luYyAoKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGRiID0gYXdhaXQgaW5pdERCKCk7XHJcbiAgICBjb25zdCB0cmFuc2FjdGlvbiA9IGRiLnRyYW5zYWN0aW9uKFwic3Rvcmllc1wiLCBcInJlYWRvbmx5XCIpO1xyXG4gICAgY29uc3Qgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShcInN0b3JpZXNcIik7XHJcbiAgICBjb25zdCByZXF1ZXN0ID0gc3RvcmUuZ2V0QWxsKCk7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XHJcbiAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gKCkgPT4ge1xyXG4gICAgICAgIHJlc29sdmUocmVxdWVzdC5yZXN1bHQgfHwgW10pO1xyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZ2V0IHN0b3JpZXM6XCIsIGVycm9yKTtcclxuICAgIHJldHVybiBbXTtcclxuICB9XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3Qgc2F2ZVVzZXJEYXRhID0gYXN5bmMgKHVzZXJEYXRhKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGRiID0gYXdhaXQgaW5pdERCKCk7XHJcbiAgICBjb25zdCB0cmFuc2FjdGlvbiA9IGRiLnRyYW5zYWN0aW9uKFwidXNlclwiLCBcInJlYWR3cml0ZVwiKTtcclxuICAgIGNvbnN0IHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoXCJ1c2VyXCIpO1xyXG5cclxuICAgIHN0b3JlLnB1dCh7IGlkOiBcImN1cnJlbnRVc2VyXCIsIC4uLnVzZXJEYXRhIH0pO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xyXG4gICAgICB0cmFuc2FjdGlvbi5vbmNvbXBsZXRlID0gKCkgPT4ge1xyXG4gICAgICAgIHJlc29sdmUodHJ1ZSk7XHJcbiAgICAgIH07XHJcbiAgICB9KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBzYXZlIHVzZXIgZGF0YTpcIiwgZXJyb3IpO1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBnZXRVc2VyRGF0YSA9IGFzeW5jICgpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgZGIgPSBhd2FpdCBpbml0REIoKTtcclxuICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gZGIudHJhbnNhY3Rpb24oXCJ1c2VyXCIsIFwicmVhZG9ubHlcIik7XHJcbiAgICBjb25zdCBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKFwidXNlclwiKTtcclxuICAgIGNvbnN0IHJlcXVlc3QgPSBzdG9yZS5nZXQoXCJjdXJyZW50VXNlclwiKTtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcclxuICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSAoKSA9PiB7XHJcbiAgICAgICAgcmVzb2x2ZShyZXF1ZXN0LnJlc3VsdCB8fCBudWxsKTtcclxuICAgICAgfTtcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGdldCB1c2VyIGRhdGE6XCIsIGVycm9yKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufTtcclxuXHJcbmxldCBpc1dyaXRpbmcgPSBmYWxzZTtcclxuXHJcbmV4cG9ydCBjb25zdCBhZGRTdG9yeU9mZmxpbmUgPSBhc3luYyAoc3RvcnkpID0+IHtcclxuICBpZiAoaXNXcml0aW5nKSB7XHJcbiAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwKSk7XHJcbiAgICByZXR1cm4gYWRkU3RvcnlPZmZsaW5lKHN0b3J5KTsgLy8gUmV0cnkgcmVjdXJzaXZlXHJcbiAgfVxyXG5cclxuICBpc1dyaXRpbmcgPSB0cnVlO1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBkYiA9IGF3YWl0IGluaXREQigpO1xyXG4gICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihcInN0b3JpZXNcIiwgXCJyZWFkd3JpdGVcIik7XHJcbiAgICBjb25zdCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKFwic3Rvcmllc1wiKTtcclxuICAgIHN0b3JlLnB1dChzdG9yeSk7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XHJcbiAgICAgIHR4Lm9uY29tcGxldGUgPSAoKSA9PiByZXNvbHZlKHRydWUpO1xyXG4gICAgICB0eC5vbmVycm9yID0gKCkgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJUcmFuc2FjdGlvbiBmYWlsZWQ6XCIsIHR4LmVycm9yKTtcclxuICAgICAgICByZXNvbHZlKGZhbHNlKTtcclxuICAgICAgfTtcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHNhdmUgc3Rvcnkgb2ZmbGluZTpcIiwgZXJyb3IpO1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH0gZmluYWxseSB7XHJcbiAgICBpc1dyaXRpbmcgPSBmYWxzZTtcclxuICB9XHJcbn07XHJcblxyXG5cclxuZXhwb3J0IGNvbnN0IGRlbGV0ZVN0b3J5T2ZmbGluZSA9IGFzeW5jIChpZCkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBkYiA9IGF3YWl0IGluaXREQigpO1xyXG4gICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihcInN0b3JpZXNcIiwgXCJyZWFkd3JpdGVcIik7XHJcbiAgICBjb25zdCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKFwic3Rvcmllc1wiKTtcclxuICAgIHN0b3JlLmRlbGV0ZShpZCk7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcclxuICAgICAgdHgub25jb21wbGV0ZSA9ICgpID0+IHJlc29sdmUodHJ1ZSk7XHJcbiAgICB9KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBkZWxldGUgc3Rvcnk6XCIsIGVycm9yKTtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgZ2V0T2ZmbGluZVN0b3JpZXMgPSBhc3luYyAoKSA9PiB7XHJcbiAgY29uc3QgZGIgPSBhd2FpdCBpbml0REIoKTtcclxuICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKFwic3Rvcmllc1wiLCBcInJlYWRvbmx5XCIpO1xyXG4gIGNvbnN0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoXCJzdG9yaWVzXCIpO1xyXG4gIGNvbnN0IHJlcXVlc3QgPSBzdG9yZS5nZXRBbGwoKTtcclxuICBcclxuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcclxuICAgIHJlcXVlc3Qub25zdWNjZXNzID0gKCkgPT4ge1xyXG4gICAgICByZXNvbHZlKHJlcXVlc3QucmVzdWx0LmZpbHRlcihzdG9yeSA9PiBzdG9yeS5pc09mZmxpbmUpKTtcclxuICAgIH07XHJcbiAgfSk7XHJcbn07IiwiaW1wb3J0IHtcclxuICBnZXRBbGxTdG9yaWVzLFxyXG4gIGdldFN0b3J5RGV0YWlsLFxyXG4gIGFkZFN0b3J5LFxyXG4gIGFkZFN0b3J5R3Vlc3QsXHJcbn0gZnJvbSBcIi4uL2RhdGEvYXBpLmpzXCI7XHJcblxyXG5pbXBvcnQge1xyXG4gIHNhdmVTdG9yaWVzLFxyXG4gIGdldFN0b3JpZXMsXHJcbiAgYWRkU3RvcnlPZmZsaW5lLFxyXG4gIGRlbGV0ZVN0b3J5T2ZmbGluZSxcclxufSBmcm9tIFwiLi4vZGF0YS9kYXRhYmFzZS5qc1wiO1xyXG5cclxuZXhwb3J0IGNsYXNzIFN0b3J5TW9kZWwge1xyXG4gIGNvbnN0cnVjdG9yKGF1dGhNb2RlbCkge1xyXG4gICAgdGhpcy5hdXRoTW9kZWwgPSBhdXRoTW9kZWw7XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRBbGxTdG9yaWVzKHBhZ2UgPSAxLCBzaXplID0gMTAsIHdpdGhMb2NhdGlvbiA9IGZhbHNlKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB0b2tlbiA9IHRoaXMuYXV0aE1vZGVsLmdldFRva2VuKCk7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZ2V0QWxsU3Rvcmllcyh0b2tlbiwgcGFnZSwgc2l6ZSwgd2l0aExvY2F0aW9uKTtcclxuXHJcbiAgICAgIGlmICghcmVzcG9uc2UuZXJyb3IpIHtcclxuICAgICAgICBhd2FpdCBzYXZlU3RvcmllcyhyZXNwb25zZS5saXN0U3RvcnkpO1xyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHN0b3JpZXM6IHJlc3BvbnNlLmxpc3RTdG9yeSB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBvZmZsaW5lU3RvcmllcyA9IGF3YWl0IGdldFN0b3JpZXMoKTtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgIHN0b3JpZXM6IG9mZmxpbmVTdG9yaWVzLFxyXG4gICAgICAgIGlzT2ZmbGluZTogdHJ1ZSxcclxuICAgICAgfTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnN0IG9mZmxpbmVTdG9yaWVzID0gYXdhaXQgZ2V0U3RvcmllcygpO1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6ICEhb2ZmbGluZVN0b3JpZXMubGVuZ3RoLFxyXG4gICAgICAgIHN0b3JpZXM6IG9mZmxpbmVTdG9yaWVzIHx8IFtdLFxyXG4gICAgICAgIGlzT2ZmbGluZTogdHJ1ZSxcclxuICAgICAgfTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIGdldFN0b3J5RGV0YWlsKGlkKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB0b2tlbiA9IHRoaXMuYXV0aE1vZGVsLmdldFRva2VuKCk7XHJcbiAgICAgIGlmICghdG9rZW4pIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkF1dGhlbnRpY2F0aW9uIHJlcXVpcmVkXCIgfTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZ2V0U3RvcnlEZXRhaWwoaWQsIHRva2VuKTtcclxuICAgICAgaWYgKCFyZXNwb25zZS5lcnJvcikgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgc3Rvcnk6IHJlc3BvbnNlLnN0b3J5IH07XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIG1lc3NhZ2U6IHJlc3BvbnNlLm1lc3NhZ2UgfHwgXCJGYWlsZWQgdG8gZmV0Y2ggc3RvcnlcIixcclxuICAgICAgfTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCBcIk5ldHdvcmsgZXJyb3Igd2hpbGUgZmV0Y2hpbmcgc3RvcnlcIixcclxuICAgICAgfTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIGFkZFN0b3J5KGRhdGEpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHRva2VuID0gdGhpcy5hdXRoTW9kZWwuZ2V0VG9rZW4oKTtcclxuICAgICAgaWYgKCFkYXRhPy5kZXNjcmlwdGlvbiB8fCAhZGF0YT8ucGhvdG8pIHtcclxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJEZXNjcmlwdGlvbiBhbmQgcGhvdG8gYXJlIHJlcXVpcmVkXCIgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSB0b2tlbiBcclxuICAgICAgICA/IGF3YWl0IGFkZFN0b3J5KGRhdGEsIHRva2VuKSBcclxuICAgICAgICA6IGF3YWl0IGFkZFN0b3J5R3Vlc3QoZGF0YSk7XHJcblxyXG4gICAgICBpZiAoIXJlc3BvbnNlLmVycm9yKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICBtZXNzYWdlOiBcIlN0b3J5IGFkZGVkIHN1Y2Nlc3NmdWxseVwiLFxyXG4gICAgICAgICAgZGF0YTogcmVzcG9uc2UsXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBtZXNzYWdlOiByZXNwb25zZS5tZXNzYWdlIHx8IFwiRmFpbGVkIHRvIGFkZCBzdG9yeVwiLFxyXG4gICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8IFwiTmV0d29yayBlcnJvciB3aGlsZSBhZGRpbmcgc3RvcnlcIixcclxuICAgICAgfTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIGFkZFN0b3J5T2ZmbGluZShkYXRhKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBzdG9yeUlkID0gYG9mZmxpbmVfJHtEYXRlLm5vdygpfV8ke01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDApfWA7XHJcbiAgICAgIGxldCBwaG90b1VybCA9ICcnO1xyXG4gICAgICBsZXQgcGhvdG9CYXNlNjQgPSAnJztcclxuICAgICAgXHJcbiAgICAgIGlmIChkYXRhLnBob3RvIGluc3RhbmNlb2YgQmxvYiB8fCBkYXRhLnBob3RvIGluc3RhbmNlb2YgRmlsZSkge1xyXG4gICAgICAgIHBob3RvQmFzZTY0ID0gYXdhaXQgdGhpcy5yZWFkRmlsZUFzQmFzZTY0KGRhdGEucGhvdG8pO1xyXG4gICAgICAgIHBob3RvVXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChkYXRhLnBob3RvKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3Qgc3RvcnkgPSB7XHJcbiAgICAgICAgaWQ6IHN0b3J5SWQsXHJcbiAgICAgICAgbmFtZTogXCJZb3UgKE9mZmxpbmUpXCIsXHJcbiAgICAgICAgZGVzY3JpcHRpb246IGRhdGEuZGVzY3JpcHRpb24sXHJcbiAgICAgICAgcGhvdG9Vcmw6IHBob3RvVXJsIHx8ICcvYXNzZXRzL2ltYWdlcy9wbGFjZWhvbGRlci1vZmZsaW5lLmpwZycsXHJcbiAgICAgICAgcGhvdG9CYXNlNjQsXHJcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgaXNPZmZsaW5lOiB0cnVlLFxyXG4gICAgICAgIGxhdDogZGF0YS5sYXQsXHJcbiAgICAgICAgbG9uOiBkYXRhLmxvbixcclxuICAgICAgICBvcmlnaW5hbFBob3RvOiBkYXRhLnBob3RvXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBhd2FpdCBhZGRTdG9yeU9mZmxpbmUoc3RvcnkpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBzdG9yeSB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBzYXZlIG9mZmxpbmUgc3Rvcnk6XCIsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yIH07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZWFkRmlsZUFzQmFzZTY0KGZpbGUpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XHJcbiAgICAgIHJlYWRlci5vbmxvYWQgPSAoKSA9PiByZXNvbHZlKHJlYWRlci5yZXN1bHQpO1xyXG4gICAgICByZWFkZXIub25lcnJvciA9IHJlamVjdDtcclxuICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGFzeW5jIHN5bmNPZmZsaW5lU3RvcmllcyhzeW5jUXVldWUpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IG9mZmxpbmVTdG9yaWVzID0gYXdhaXQgdGhpcy5nZXRPZmZsaW5lU3RvcmllcygpO1xyXG4gICAgICBjb25zdCB0b2tlbiA9IHRoaXMuYXV0aE1vZGVsLmdldFRva2VuKCk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoIXRva2VuKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ05vIGF1dGggdG9rZW4gLSBza2lwcGluZyBzeW5jJyk7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEZpbHRlciBzdG9yaWVzIHRoYXQgYXJlIGJvdGggb2ZmbGluZSBhbmQgaW4gdGhlIHN5bmMgcXVldWVcclxuICAgICAgY29uc3QgdG9TeW5jID0gb2ZmbGluZVN0b3JpZXNcclxuICAgICAgICAuc29ydCgoYSwgYikgPT4gbmV3IERhdGUoYS5jcmVhdGVkQXQpIC0gbmV3IERhdGUoYi5jcmVhdGVkQXQpKVxyXG4gICAgICAgIC5maWx0ZXIoc3RvcnkgPT4gc3luY1F1ZXVlLmhhcyhzdG9yeS5pZCkpO1xyXG5cclxuICAgICAgaWYgKHRvU3luYy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnTm8gc3RvcmllcyB0byBzeW5jJyk7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgc3luY2VkSWRzOiBbXSB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBzeW5jZWRJZHMgPSBbXTtcclxuICAgICAgXHJcbiAgICAgIGZvciAoY29uc3Qgc3Rvcnkgb2YgdG9TeW5jKSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKCdTeW5jaW5nIHN0b3J5OicsIHN0b3J5LmlkKTtcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgY29uc3QgcGhvdG9CbG9iID0gc3RvcnkucGhvdG9CYXNlNjQgXHJcbiAgICAgICAgICAgID8gYXdhaXQgdGhpcy5iYXNlNjRUb0Jsb2Ioc3RvcnkucGhvdG9CYXNlNjQpXHJcbiAgICAgICAgICAgIDogc3Rvcnkub3JpZ2luYWxQaG90bztcclxuXHJcbiAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGFkZFN0b3J5KHtcclxuICAgICAgICAgICAgZGVzY3JpcHRpb246IHN0b3J5LmRlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICBwaG90bzogcGhvdG9CbG9iLFxyXG4gICAgICAgICAgICBsYXQ6IHN0b3J5LmxhdCxcclxuICAgICAgICAgICAgbG9uOiBzdG9yeS5sb25cclxuICAgICAgICAgIH0sIHRva2VuKTtcclxuXHJcbiAgICAgICAgICBpZiAoIXJlc3BvbnNlLmVycm9yKSB7XHJcbiAgICAgICAgICAgIGF3YWl0IGRlbGV0ZVN0b3J5T2ZmbGluZShzdG9yeS5pZCk7XHJcbiAgICAgICAgICAgIHN5bmNlZElkcy5wdXNoKHN0b3J5LmlkKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIHN5bmMgJHtzdG9yeS5pZH06YCwgZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBzeW5jZWRJZHMubGVuZ3RoID4gMCxcclxuICAgICAgICBzeW5jZWRJZHNcclxuICAgICAgfTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1N5bmMgZXJyb3I6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3IgfTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIGJhc2U2NFRvQmxvYihiYXNlNjQpIHtcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYmFzZTY0KTtcclxuICAgIHJldHVybiBhd2FpdCByZXNwb25zZS5ibG9iKCk7XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRPZmZsaW5lU3RvcmllcygpIHtcclxuICAgIGNvbnN0IGFsbFN0b3JpZXMgPSBhd2FpdCBnZXRTdG9yaWVzKCk7XHJcbiAgICByZXR1cm4gYWxsU3Rvcmllcy5maWx0ZXIoc3RvcnkgPT4gc3RvcnkuaXNPZmZsaW5lKTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGRlbGV0ZVN0b3J5T2ZmbGluZShpZCkge1xyXG4gICAgcmV0dXJuIGF3YWl0IGRlbGV0ZVN0b3J5T2ZmbGluZShpZCk7XHJcbiAgfVxyXG59IiwiZXhwb3J0IGNvbnN0IFZBUElEX1BVQkxJQ19LRVkgPVxyXG4gIFwiQkNDczJlb25NSS02SDJjdHZGYVdnLVVZZER2Mzg3Vm5vX2J6VXpBTHBCNDQycjJsQ25zSG10cng4Yml5UGlfRS0xZlNHQUJLX1FzX0dsdlBvSkpxeGJrXCI7XHJcbiIsImltcG9ydCB7IFZBUElEX1BVQkxJQ19LRVkgfSBmcm9tIFwiLi9jb25maWcuanNcIjtcclxuaW1wb3J0IHtcclxuICBzdWJzY3JpYmVUb05vdGlmaWNhdGlvbnMsXHJcbiAgdW5zdWJzY3JpYmVGcm9tTm90aWZpY2F0aW9ucyxcclxufSBmcm9tIFwiLi4vZGF0YS9hcGkuanNcIjtcclxuXHJcbmV4cG9ydCBjb25zdCByZXF1ZXN0Tm90aWZpY2F0aW9uUGVybWlzc2lvbiA9IGFzeW5jICgpID0+IHtcclxuICBpZiAoIShcIk5vdGlmaWNhdGlvblwiIGluIHdpbmRvdykpIHtcclxuICAgIGNvbnNvbGUubG9nKFwiVGhpcyBicm93c2VyIGRvZXMgbm90IHN1cHBvcnQgbm90aWZpY2F0aW9ucy5cIik7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG5cclxuICBpZiAoTm90aWZpY2F0aW9uLnBlcm1pc3Npb24gPT09IFwiZ3JhbnRlZFwiKSB7XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcblxyXG4gIGNvbnN0IHBlcm1pc3Npb24gPSBhd2FpdCBOb3RpZmljYXRpb24ucmVxdWVzdFBlcm1pc3Npb24oKTtcclxuICByZXR1cm4gcGVybWlzc2lvbiA9PT0gXCJncmFudGVkXCI7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3Qgc3Vic2NyaWJlVXNlciA9IGFzeW5jICh0b2tlbikgPT4ge1xyXG4gIGlmICghKFwic2VydmljZVdvcmtlclwiIGluIG5hdmlnYXRvcikpIHtcclxuICAgIGNvbnNvbGUubG9nKFwiU2VydmljZSBXb3JrZXIgbm90IHN1cHBvcnRlZFwiKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgcmVnaXN0cmF0aW9uID0gYXdhaXQgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVhZHk7XHJcbiAgbGV0IHN1YnNjcmlwdGlvbiA9IGF3YWl0IHJlZ2lzdHJhdGlvbi5wdXNoTWFuYWdlci5nZXRTdWJzY3JpcHRpb24oKTtcclxuXHJcbiAgaWYgKCFzdWJzY3JpcHRpb24pIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIHN1YnNjcmlwdGlvbiA9IGF3YWl0IHJlZ2lzdHJhdGlvbi5wdXNoTWFuYWdlci5zdWJzY3JpYmUoe1xyXG4gICAgICAgIHVzZXJWaXNpYmxlT25seTogdHJ1ZSxcclxuICAgICAgICBhcHBsaWNhdGlvblNlcnZlcktleTogdXJsQmFzZTY0VG9VaW50OEFycmF5KFZBUElEX1BVQkxJQ19LRVkpLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIFNlbmQgc3Vic2NyaXB0aW9uIHRvIHNlcnZlclxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzdWJzY3JpYmVUb05vdGlmaWNhdGlvbnMoXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgZW5kcG9pbnQ6IHN1YnNjcmlwdGlvbi5lbmRwb2ludCxcclxuICAgICAgICAgIGtleXM6IHtcclxuICAgICAgICAgICAgcDI1NmRoOiBhcnJheUJ1ZmZlclRvQmFzZTY0KHN1YnNjcmlwdGlvbi5nZXRLZXkoJ3AyNTZkaCcpKSxcclxuICAgICAgICAgICAgYXV0aDogYXJyYXlCdWZmZXJUb0Jhc2U2NChzdWJzY3JpcHRpb24uZ2V0S2V5KCdhdXRoJykpXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdG9rZW5cclxuICAgICAgKTtcclxuXHJcbiAgICAgIGlmICghcmVzdWx0LmVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJVc2VyIGlzIHN1YnNjcmliZWQuXCIpO1xyXG4gICAgICAgIHJldHVybiBzdWJzY3JpcHRpb247XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcIlN1YnNjcmlwdGlvbiBmYWlsZWQ6XCIsIHJlc3VsdC5tZXNzYWdlKTtcclxuICAgICAgICBhd2FpdCBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHN1YnNjcmliaW5nIHVzZXI6XCIsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXR1cm4gc3Vic2NyaXB0aW9uO1xyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IHVuc3Vic2NyaWJlVXNlciA9IGFzeW5jICh0b2tlbikgPT4ge1xyXG4gIGNvbnN0IHJlZ2lzdHJhdGlvbiA9IGF3YWl0IG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlYWR5O1xyXG4gIGNvbnN0IHN1YnNjcmlwdGlvbiA9IGF3YWl0IHJlZ2lzdHJhdGlvbi5wdXNoTWFuYWdlci5nZXRTdWJzY3JpcHRpb24oKTtcclxuXHJcbiAgaWYgKHN1YnNjcmlwdGlvbikge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdW5zdWJzY3JpYmVGcm9tTm90aWZpY2F0aW9ucyhcclxuICAgICAgICBzdWJzY3JpcHRpb24uZW5kcG9pbnQsXHJcbiAgICAgICAgdG9rZW5cclxuICAgICAgKTtcclxuXHJcbiAgICAgIGlmICghcmVzdWx0LmVycm9yKSB7XHJcbiAgICAgICAgYXdhaXQgc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJVc2VyIGlzIHVuc3Vic2NyaWJlZC5cIik7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHVuc3Vic2NyaWJpbmcgdXNlcjpcIiwgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHJldHVybiBmYWxzZTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBzaG93Tm90aWZpY2F0aW9uUHJvbXB0ID0gYXN5bmMgKGNhbGxiYWNrKSA9PiB7XHJcbiAgaWYgKCEoXCJOb3RpZmljYXRpb25cIiBpbiB3aW5kb3cpKSB7XHJcbiAgICBjb25zb2xlLmxvZyhcIlRoaXMgYnJvd3NlciBkb2VzIG5vdCBzdXBwb3J0IG5vdGlmaWNhdGlvbnMuXCIpO1xyXG4gICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjayhmYWxzZSk7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG5cclxuICBpZiAoTm90aWZpY2F0aW9uLnBlcm1pc3Npb24gPT09IFwiZ3JhbnRlZFwiKSB7XHJcbiAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKHRydWUpO1xyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG5cclxuICBpZiAoTm90aWZpY2F0aW9uLnBlcm1pc3Npb24gPT09IFwiZGVuaWVkXCIpIHtcclxuICAgIGNvbnNvbGUubG9nKFwiTm90aWZpY2F0aW9uIHBlcm1pc3Npb24gaGFzIGJlZW4gZGVuaWVkLlwiKTtcclxuICAgIGlmIChjYWxsYmFjaykgY2FsbGJhY2soZmFsc2UpO1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgLy8gT25seSBzaG93IG91ciBjdXN0b20gcHJvbXB0IGlmIGluIGRlZmF1bHQgc3RhdGVcclxuICBpZiAoTm90aWZpY2F0aW9uLnBlcm1pc3Npb24gPT09IFwiZGVmYXVsdFwiKSB7XHJcbiAgICAvLyBZb3UgY291bGQgc2hvdyBhIGN1c3RvbSBVSSBoZXJlIGV4cGxhaW5pbmcgd2h5IHlvdSB3YW50IG5vdGlmaWNhdGlvbnNcclxuICAgIC8vIEZvciBub3cgd2UnbGwganVzdCB0cmlnZ2VyIHRoZSBicm93c2VyJ3MgbmF0aXZlIHByb21wdFxyXG4gICAgY29uc3QgcGVybWlzc2lvbiA9IGF3YWl0IE5vdGlmaWNhdGlvbi5yZXF1ZXN0UGVybWlzc2lvbigpO1xyXG4gICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjayhwZXJtaXNzaW9uID09PSBcImdyYW50ZWRcIik7XHJcbiAgICByZXR1cm4gcGVybWlzc2lvbiA9PT0gXCJncmFudGVkXCI7XHJcbiAgfVxyXG59O1xyXG5cclxuZnVuY3Rpb24gdXJsQmFzZTY0VG9VaW50OEFycmF5KGJhc2U2NFN0cmluZykge1xyXG4gIGNvbnN0IHBhZGRpbmcgPSAnPScucmVwZWF0KCg0IC0gKGJhc2U2NFN0cmluZy5sZW5ndGggJSA0KSkgJSA0KTtcclxuICBjb25zdCBiYXNlNjQgPSAoYmFzZTY0U3RyaW5nICsgcGFkZGluZykucmVwbGFjZSgvLS9nLCAnKycpLnJlcGxhY2UoL18vZywgJy8nKTtcclxuICBjb25zdCByYXdEYXRhID0gYXRvYihiYXNlNjQpO1xyXG4gIGNvbnN0IG91dHB1dEFycmF5ID0gbmV3IFVpbnQ4QXJyYXkocmF3RGF0YS5sZW5ndGgpO1xyXG5cclxuICBmb3IgKGxldCBpID0gMDsgaSA8IHJhd0RhdGEubGVuZ3RoOyArK2kpIHtcclxuICAgIG91dHB1dEFycmF5W2ldID0gcmF3RGF0YS5jaGFyQ29kZUF0KGkpO1xyXG4gIH1cclxuICByZXR1cm4gb3V0cHV0QXJyYXk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGFycmF5QnVmZmVyVG9CYXNlNjQoYnVmZmVyKSB7XHJcbiAgbGV0IGJpbmFyeSA9ICcnO1xyXG4gIGNvbnN0IGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoYnVmZmVyKTtcclxuICBmb3IgKGxldCBpID0gMDsgaSA8IGJ5dGVzLmJ5dGVMZW5ndGg7IGkrKykge1xyXG4gICAgYmluYXJ5ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYnl0ZXNbaV0pO1xyXG4gIH1cclxuICByZXR1cm4gYnRvYShiaW5hcnkpO1xyXG59IiwiaW1wb3J0IHsgdXBkYXRlQXV0aFVJIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvSGVhZGVyLmpzXCI7XHJcbmltcG9ydCB7IFxyXG4gIHN1YnNjcmliZVVzZXIsIFxyXG4gIHVuc3Vic2NyaWJlVXNlcixcclxuICByZXF1ZXN0Tm90aWZpY2F0aW9uUGVybWlzc2lvbiBcclxufSBmcm9tIFwiLi4vdXRpbHMvbm90aWZpY2F0aW9uLmpzXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgQXV0aFByZXNlbnRlciB7XHJcbiAgY29uc3RydWN0b3IoYXV0aE1vZGVsLCBhdXRoVmlldywgcm91dGVyKSB7XHJcbiAgICB0aGlzLmF1dGhNb2RlbCA9IGF1dGhNb2RlbDtcclxuICAgIHRoaXMuYXV0aFZpZXcgPSBhdXRoVmlldztcclxuICAgIHRoaXMucm91dGVyID0gcm91dGVyO1xyXG5cclxuICAgIC8vIEluaXRpYWxpemUgVUkgc3RhdGVcclxuICAgIHVwZGF0ZUF1dGhVSSh0aGlzLmF1dGhNb2RlbC5pc0F1dGhlbnRpY2F0ZWQoKSk7XHJcblxyXG4gICAgaWYgKGF1dGhWaWV3LmJpbmRMb2dpbikge1xyXG4gICAgICBhdXRoVmlldy5iaW5kTG9naW4odGhpcy5oYW5kbGVMb2dpbi5iaW5kKHRoaXMpKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoYXV0aFZpZXcuYmluZFJlZ2lzdGVyKSB7XHJcbiAgICAgIGF1dGhWaWV3LmJpbmRSZWdpc3Rlcih0aGlzLmhhbmRsZVJlZ2lzdGVyLmJpbmQodGhpcykpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgaGFuZGxlTG9naW4oZW1haWwsIHBhc3N3b3JkKSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuYXV0aE1vZGVsLmxvZ2luKGVtYWlsLCBwYXNzd29yZCk7XHJcblxyXG4gICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XHJcbiAgICAgIHVwZGF0ZUF1dGhVSSh0cnVlKTsgLy8gVXBkYXRlIFVJIHN0YXRlIGltbWVkaWF0ZWx5XHJcbiAgICAgIFxyXG4gICAgICAvLyBTdGFydCBib3RoIG9wZXJhdGlvbnMgYnV0IGRvbid0IGF3YWl0IG5vdGlmaWNhdGlvbiBzZXR1cFxyXG4gICAgICBjb25zdCBub3RpZmljYXRpb25Qcm9taXNlID0gKGFzeW5jICgpID0+IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgY29uc3QgcGVybWlzc2lvbkdyYW50ZWQgPSBhd2FpdCByZXF1ZXN0Tm90aWZpY2F0aW9uUGVybWlzc2lvbigpO1xyXG4gICAgICAgICAgaWYgKHBlcm1pc3Npb25HcmFudGVkKSBhd2FpdCBzdWJzY3JpYmVVc2VyKHJlc3VsdC50b2tlbik7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJOb3RpZmljYXRpb24gZXJyb3I6XCIsIGVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pKCk7XHJcblxyXG4gICAgICAvLyBOYXZpZ2F0ZSBpbW1lZGlhdGVseSB3aXRob3V0IHdhaXRpbmcgZm9yIG5vdGlmaWNhdGlvbnNcclxuICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGVUbyhcIi9zdG9yaWVzXCIpO1xyXG4gICAgICBcclxuICAgICAgLy8gTGV0IG5vdGlmaWNhdGlvbnMgY29tcGxldGUgaW4gYmFja2dyb3VuZFxyXG4gICAgICBhd2FpdCBub3RpZmljYXRpb25Qcm9taXNlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5hdXRoVmlldy5zaG93RXJyb3I/LihyZXN1bHQubWVzc2FnZSk7XHJcbiAgICB9XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHRoaXMuYXV0aFZpZXcuc2hvd0Vycm9yPy4oZXJyb3IubWVzc2FnZSk7XHJcbiAgfVxyXG59XHJcblxyXG4gIGFzeW5jIGhhbmRsZUxvZ291dCgpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIFVuc3Vic2NyaWJlIGZyb20gbm90aWZpY2F0aW9ucyBiZWZvcmUgbG9nb3V0XHJcbiAgICAgIGNvbnN0IHRva2VuID0gdGhpcy5hdXRoTW9kZWwuZ2V0VG9rZW4oKTtcclxuICAgICAgaWYgKHRva2VuKSB7XHJcbiAgICAgICAgYXdhaXQgdW5zdWJzY3JpYmVVc2VyKHRva2VuKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHVuc3Vic2NyaWJpbmc6XCIsIGVycm9yKTtcclxuICAgIH0gZmluYWxseSB7XHJcbiAgICAgIHRoaXMuYXV0aE1vZGVsLmxvZ291dCgpO1xyXG4gICAgICB1cGRhdGVBdXRoVUkoZmFsc2UpO1xyXG4gICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZVRvKFwiL2xvZ2luXCIpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgaGFuZGxlUmVnaXN0ZXIobmFtZSwgZW1haWwsIHBhc3N3b3JkKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmF1dGhNb2RlbC5yZWdpc3RlcihuYW1lLCBlbWFpbCwgcGFzc3dvcmQpO1xyXG5cclxuICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XHJcbiAgICAgICAgdGhpcy5hdXRoVmlldy5zaG93U3VjY2Vzcz8uKFwiUmVnaXN0cmF0aW9uIHN1Y2Nlc3NmdWwuIFBsZWFzZSBsb2dpbi5cIik7XHJcbiAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGVUbyhcIi9sb2dpblwiKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLmF1dGhWaWV3LnNob3dFcnJvcj8uKHJlc3VsdC5tZXNzYWdlKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhpcy5hdXRoVmlldy5zaG93RXJyb3I/LihlcnJvci5tZXNzYWdlKTtcclxuICAgIH1cclxuICB9XHJcbn0iLCJpbXBvcnQgeyBzaG93Tm90aWZpY2F0aW9uUHJvbXB0IH0gZnJvbSBcIi4uL3V0aWxzL25vdGlmaWNhdGlvbi5qc1wiO1xyXG5cclxuZXhwb3J0IGNsYXNzIFN0b3J5UHJlc2VudGVyIHtcclxuICBjb25zdHJ1Y3RvcihzdG9yeU1vZGVsLCBzdG9yeVZpZXcsIHJvdXRlcikge1xyXG4gICAgdGhpcy5zdG9yeU1vZGVsID0gc3RvcnlNb2RlbDtcclxuICAgIHRoaXMuc3RvcnlWaWV3ID0gc3RvcnlWaWV3O1xyXG4gICAgdGhpcy5yb3V0ZXIgPSByb3V0ZXI7XHJcbiAgICB0aGlzLmN1cnJlbnRTdG9yeUlkID0gbnVsbDtcclxuICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XHJcbiAgICB0aGlzLm1hcEluaXRpYWxpemVkID0gZmFsc2U7XHJcblxyXG4gICAgLy8gU3luYyBtYW5hZ2VtZW50XHJcbiAgICB0aGlzLmlzU3luY2luZyA9IGZhbHNlO1xyXG4gICAgdGhpcy5wZW5kaW5nU3luY0lkcyA9IG5ldyBTZXQoKTtcclxuICAgIHRoaXMuc3luY1F1ZXVlID0gbmV3IFNldCgpO1xyXG5cclxuICAgIHRoaXMuaW5pdGlhbGl6ZUV2ZW50QmluZGluZ3MoKTtcclxuICAgIHRoaXMuaW5pdGlhbGl6ZVN5bmNIYW5kbGVycygpO1xyXG4gICAgdGhpcy5zdGFydFN5bmNNb25pdG9yKCk7XHJcbiAgfVxyXG5cclxuICBpbml0aWFsaXplRXZlbnRCaW5kaW5ncygpIHtcclxuICAgIGlmICh0aGlzLnN0b3J5Vmlldy5iaW5kTG9hZFN0b3JpZXMpIHtcclxuICAgICAgdGhpcy5zdG9yeVZpZXcuYmluZExvYWRTdG9yaWVzKHRoaXMuaGFuZGxlTG9hZFN0b3JpZXMuYmluZCh0aGlzKSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuc3RvcnlWaWV3LmJpbmRBZGRTdG9yeSkge1xyXG4gICAgICB0aGlzLnN0b3J5Vmlldy5iaW5kQWRkU3RvcnkodGhpcy5oYW5kbGVBZGRTdG9yeS5iaW5kKHRoaXMpKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5zdG9yeVZpZXcuYmluZExvYWRTdG9yeURldGFpbCkge1xyXG4gICAgICB0aGlzLnN0b3J5Vmlldy5iaW5kTG9hZFN0b3J5RGV0YWlsKHRoaXMuaGFuZGxlTG9hZFN0b3J5RGV0YWlsLmJpbmQodGhpcykpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgaW5pdGlhbGl6ZVN5bmNIYW5kbGVycygpIHtcclxuICAgIC8vIExvYWQgZXhpc3Rpbmcgb2ZmbGluZSBzdG9yaWVzIGludG8gcXVldWVcclxuICAgIHRoaXMubG9hZE9mZmxpbmVTdG9yaWVzSW50b1F1ZXVlKCk7XHJcblxyXG4gICAgLy8gU2V0IHVwIGV2ZW50IGxpc3RlbmVyc1xyXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29ubGluZScsIHRoaXMuaGFuZGxlQ29ubmVjdGlvbkNoYW5nZS5iaW5kKHRoaXMpKTtcclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsIHRoaXMuaGFuZGxlRm9jdXMuYmluZCh0aGlzKSk7XHJcbiAgfVxyXG5cclxuICBhc3luYyBsb2FkT2ZmbGluZVN0b3JpZXNJbnRvUXVldWUoKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBvZmZsaW5lU3RvcmllcyA9IGF3YWl0IHRoaXMuc3RvcnlNb2RlbC5nZXRPZmZsaW5lU3RvcmllcygpO1xyXG4gICAgICBvZmZsaW5lU3Rvcmllcy5mb3JFYWNoKHN0b3J5ID0+IHRoaXMuc3luY1F1ZXVlLmFkZChzdG9yeS5pZCkpO1xyXG4gICAgICBjb25zb2xlLmxvZygnSW5pdGlhbCBzeW5jIHF1ZXVlOicsIEFycmF5LmZyb20odGhpcy5zeW5jUXVldWUpKTtcclxuICAgICAgXHJcbiAgICAgIC8vIFRyaWdnZXIgc3luYyBpZiB3ZSdyZSBhbHJlYWR5IG9ubGluZVxyXG4gICAgICBpZiAobmF2aWdhdG9yLm9uTGluZSkge1xyXG4gICAgICAgIHRoaXMuaGFuZGxlT25saW5lKCk7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBsb2FkIG9mZmxpbmUgc3RvcmllczonLCBlcnJvcik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBoYW5kbGVDb25uZWN0aW9uQ2hhbmdlKCkge1xyXG4gICAgaWYgKG5hdmlnYXRvci5vbkxpbmUpIHtcclxuICAgICAgY29uc29sZS5sb2coJ0Nvbm5lY3Rpb24gcmVzdG9yZWQgLSB0cmlnZ2VyaW5nIHN5bmMnKTtcclxuICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLmhhbmRsZU9ubGluZSgpLCAxMDAwKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGhhbmRsZUZvY3VzKCkge1xyXG4gICAgaWYgKG5hdmlnYXRvci5vbkxpbmUgJiYgdGhpcy5zeW5jUXVldWUuc2l6ZSA+IDApIHtcclxuICAgICAgY29uc29sZS5sb2coJ1dpbmRvdyBmb2N1c2VkIC0gY2hlY2tpbmcgc3luYycpO1xyXG4gICAgICB0aGlzLmhhbmRsZU9ubGluZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc3RhcnRTeW5jTW9uaXRvcigpIHtcclxuICAgIHNldEludGVydmFsKCgpID0+IHtcclxuICAgICAgY29uc29sZS5sb2coJ1N5bmMgTW9uaXRvcjonLCB7XHJcbiAgICAgICAgaXNTeW5jaW5nOiB0aGlzLmlzU3luY2luZyxcclxuICAgICAgICBxdWV1ZVNpemU6IHRoaXMuc3luY1F1ZXVlLnNpemUsXHJcbiAgICAgICAgcXVldWVDb250ZW50czogQXJyYXkuZnJvbSh0aGlzLnN5bmNRdWV1ZSksXHJcbiAgICAgICAgcGVuZGluZ1N5bmNzOiBBcnJheS5mcm9tKHRoaXMucGVuZGluZ1N5bmNJZHMpXHJcbiAgICAgIH0pO1xyXG4gICAgfSwgMTAwMDApO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgaGFuZGxlTG9hZFN0b3JpZXMocGFnZSA9IDEsIHNpemUgPSAxMCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5zdG9yeU1vZGVsLmdldEFsbFN0b3JpZXMocGFnZSwgc2l6ZSk7XHJcblxyXG4gICAgICBpZiAocmVzdWx0LmlzT2ZmbGluZSkge1xyXG4gICAgICAgIHRoaXMuc3RvcnlWaWV3LnNob3dPZmZsaW5lV2FybmluZz8uKCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xyXG4gICAgICAgIHRoaXMuc3RvcnlWaWV3LmRpc3BsYXlTdG9yaWVzPy4ocmVzdWx0LnN0b3JpZXMgfHwgW10pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuc3RvcnlWaWV3LnNob3dFcnJvcj8uKHJlc3VsdC5tZXNzYWdlIHx8IFwiRmFpbGVkIHRvIGxvYWQgc3Rvcmllc1wiKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihcIkxvYWQgc3RvcmllcyBlcnJvcjpcIiwgZXJyb3IpO1xyXG4gICAgICB0aGlzLnN0b3J5Vmlldy5zaG93RXJyb3I/LihcIkZhaWxlZCB0byBsb2FkIHN0b3JpZXMuIFBsZWFzZSB0cnkgYWdhaW4uXCIpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgaGFuZGxlTG9hZFN0b3J5RGV0YWlsKGlkKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBpZiAodGhpcy5pc0xvYWRpbmcgfHwgdGhpcy5jdXJyZW50U3RvcnlJZCA9PT0gaWQpIHJldHVybjtcclxuXHJcbiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTtcclxuICAgICAgdGhpcy5jdXJyZW50U3RvcnlJZCA9IGlkO1xyXG5cclxuICAgICAgdGhpcy5zdG9yeVZpZXcucHJlcGFyZU1hcENvbnRhaW5lcj8uKCk7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuc3RvcnlNb2RlbC5nZXRTdG9yeURldGFpbChpZCk7XHJcblxyXG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcclxuICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHJlc29sdmUpKTtcclxuICAgICAgICB0aGlzLnN0b3J5Vmlldy5kaXNwbGF5U3RvcnlEZXRhaWw/LihyZXN1bHQuc3RvcnkpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuc3RvcnlWaWV3LnNob3dFcnJvcj8uKHJlc3VsdC5tZXNzYWdlIHx8IFwiU3Rvcnkgbm90IGZvdW5kXCIpO1xyXG4gICAgICAgIHRoaXMucm91dGVyLm5hdmlnYXRlVG8oXCIvc3Rvcmllc1wiKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihcIkxvYWQgc3RvcnkgZGV0YWlsIGVycm9yOlwiLCBlcnJvcik7XHJcbiAgICAgIHRoaXMuc3RvcnlWaWV3LnNob3dFcnJvcj8uKFwiRmFpbGVkIHRvIGxvYWQgc3RvcnkgZGV0YWlsc1wiKTtcclxuICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGVUbyhcIi9zdG9yaWVzXCIpO1xyXG4gICAgfSBmaW5hbGx5IHtcclxuICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIGhhbmRsZUFkZFN0b3J5KGRhdGEpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuc3RvcnlNb2RlbC5hZGRTdG9yeShkYXRhKTtcclxuXHJcbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xyXG4gICAgICAgIHRoaXMuaGFuZGxlQWRkU3VjY2VzcyhkYXRhKTtcclxuICAgICAgfSBlbHNlIGlmICghcmVzdWx0LnN1Y2Nlc3MgJiYgIW5hdmlnYXRvci5vbkxpbmUpIHtcclxuICAgICAgICBhd2FpdCB0aGlzLmhhbmRsZU9mZmxpbmVBZGQoZGF0YSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5zdG9yeVZpZXcuc2hvd0Vycm9yPy4ocmVzdWx0Lm1lc3NhZ2UgfHwgXCJGYWlsZWQgdG8gYWRkIHN0b3J5XCIpO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aGlzLmhhbmRsZUFkZEVycm9yKGVycm9yKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIGhhbmRsZUFkZFN1Y2Nlc3MoZGF0YSkge1xyXG4gICAgdGhpcy5zdG9yeVZpZXcuc2hvd1N1Y2Nlc3M/LihcIlN0b3J5IGFkZGVkIHN1Y2Nlc3NmdWxseSFcIik7XHJcbiAgICBcclxuICAgIGF3YWl0IHNob3dOb3RpZmljYXRpb25Qcm9tcHQoYXN5bmMgKGdyYW50ZWQpID0+IHtcclxuICAgICAgaWYgKGdyYW50ZWQpIHtcclxuICAgICAgICBuZXcgTm90aWZpY2F0aW9uKFwiU3RvcnkgY3JlYXRlZFwiLCB7XHJcbiAgICAgICAgICBib2R5OiBgTmV3IHN0b3J5OiAke2RhdGEuZGVzY3JpcHRpb24uc3Vic3RyaW5nKDAsIDUwKX0uLi5gLFxyXG4gICAgICAgICAgaWNvbjogXCIvYXNzZXRzL2ltYWdlcy9pY29uLTE5MngxOTIucG5nXCIsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMuY2xlYW51cCgpO1xyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIHRoaXMuaGFuZGxlTG9hZFN0b3JpZXMoKTtcclxuICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGVUbyhcIi9zdG9yaWVzXCIpO1xyXG4gICAgfSwgMTUwMCk7XHJcbiAgfVxyXG5cclxuICBhc3luYyBoYW5kbGVPZmZsaW5lQWRkKGRhdGEpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IG9mZmxpbmVSZXN1bHQgPSBhd2FpdCB0aGlzLnN0b3J5TW9kZWwuYWRkU3RvcnlPZmZsaW5lKGRhdGEpO1xyXG4gICAgICB0aGlzLnN5bmNRdWV1ZS5hZGQob2ZmbGluZVJlc3VsdC5zdG9yeS5pZCk7XHJcblxyXG4gICAgICBhd2FpdCBzaG93Tm90aWZpY2F0aW9uUHJvbXB0KGFzeW5jIChncmFudGVkKSA9PiB7XHJcbiAgICAgICAgaWYgKGdyYW50ZWQpIHtcclxuICAgICAgICAgIG5ldyBOb3RpZmljYXRpb24oXCJTdG9yeSBTYXZlZCBPZmZsaW5lXCIsIHtcclxuICAgICAgICAgICAgYm9keTogXCJXaWxsIHVwbG9hZCB3aGVuIHlvdSdyZSBiYWNrIG9ubGluZVwiLFxyXG4gICAgICAgICAgICBpY29uOiBcIi9hc3NldHMvaW1hZ2VzL2ljb24tMTkyeDE5Mi5wbmdcIlxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHRoaXMuc3RvcnlWaWV3LnNob3dTdWNjZXNzPy4oXCJTdG9yeSBzYXZlZCBvZmZsaW5lLiBXaWxsIHN5bmMgd2hlbiBvbmxpbmUhXCIpO1xyXG4gICAgICBcclxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVMb2FkU3RvcmllcygpO1xyXG4gICAgICAgIHRoaXMucm91dGVyLm5hdmlnYXRlVG8oXCIvc3Rvcmllc1wiKTtcclxuICAgICAgfSwgMTUwMCk7XHJcbiAgICB9IGNhdGNoIChvZmZsaW5lRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihcIk9mZmxpbmUgc2F2ZSBmYWlsZWQ6XCIsIG9mZmxpbmVFcnJvcik7XHJcbiAgICAgIHRoaXMuc3RvcnlWaWV3LnNob3dFcnJvcj8uKFwiRmFpbGVkIHRvIHNhdmUgc3Rvcnkgb2ZmbGluZS5cIik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBoYW5kbGVBZGRFcnJvcihlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkFkZCBzdG9yeSBlcnJvcjpcIiwgZXJyb3IpO1xyXG4gICAgaWYgKCFuYXZpZ2F0b3Iub25MaW5lKSB7XHJcbiAgICAgIHRoaXMuc3RvcnlWaWV3LnNob3dFcnJvcj8uKFwiWW91J3JlIG9mZmxpbmUuIFBsZWFzZSBjb25uZWN0IHRvIHN1Ym1pdCBzdG9yaWVzLlwiKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuc3RvcnlWaWV3LnNob3dFcnJvcj8uKFwiRmFpbGVkIHRvIGFkZCBzdG9yeS4gUGxlYXNlIHRyeSBhZ2Fpbi5cIik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhc3luYyBoYW5kbGVPbmxpbmUoKSB7XHJcbiAgICBpZiAodGhpcy5pc1N5bmNpbmcgfHwgdGhpcy5zeW5jUXVldWUuc2l6ZSA9PT0gMCkgcmV0dXJuO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKCdTdGFydGluZyBzeW5jIHdpdGggcXVldWU6JywgQXJyYXkuZnJvbSh0aGlzLnN5bmNRdWV1ZSkpO1xyXG4gICAgdGhpcy5pc1N5bmNpbmcgPSB0cnVlO1xyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHN5bmNSZXN1bHQgPSBhd2FpdCB0aGlzLnN0b3J5TW9kZWwuc3luY09mZmxpbmVTdG9yaWVzKHRoaXMuc3luY1F1ZXVlKTtcclxuICAgICAgY29uc29sZS5sb2coJ1N5bmMgY29tcGxldGVkOicsIHN5bmNSZXN1bHQpO1xyXG5cclxuICAgICAgaWYgKHN5bmNSZXN1bHQuc3VjY2VzcyAmJiBzeW5jUmVzdWx0LnN5bmNlZElkcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgc3luY1Jlc3VsdC5zeW5jZWRJZHMuZm9yRWFjaChpZCA9PiB7XHJcbiAgICAgICAgICB0aGlzLnN5bmNRdWV1ZS5kZWxldGUoaWQpO1xyXG4gICAgICAgICAgdGhpcy5wZW5kaW5nU3luY0lkcy5kZWxldGUoaWQpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLnN0b3J5Vmlldy5zaG93U3VjY2Vzcz8uKGBTeW5jZWQgJHtzeW5jUmVzdWx0LnN5bmNlZElkcy5sZW5ndGh9IHN0b3JpZXMhYCk7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVMb2FkU3RvcmllcygpO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdTeW5jIGZhaWxlZDonLCBlcnJvcik7XHJcbiAgICB9IGZpbmFsbHkge1xyXG4gICAgICB0aGlzLmlzU3luY2luZyA9IGZhbHNlO1xyXG4gICAgICBcclxuICAgICAgLy8gUmV0cnkgaWYgdGhlcmUgYXJlIHJlbWFpbmluZyBzdG9yaWVzXHJcbiAgICAgIGlmICh0aGlzLnN5bmNRdWV1ZS5zaXplID4gMCkge1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5oYW5kbGVPbmxpbmUoKSwgNTAwMCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNsZWFudXAoKSB7XHJcbiAgICBpZiAodHlwZW9mIHRoaXMuc3RvcnlWaWV3LmNsZWFudXAgPT09IFwiZnVuY3Rpb25cIikge1xyXG4gICAgICB0aGlzLnN0b3J5Vmlldy5jbGVhbnVwKCk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5jdXJyZW50U3RvcnlJZCA9IG51bGw7XHJcbiAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xyXG4gIH1cclxufSIsImV4cG9ydCBjbGFzcyBNYXBQcmVzZW50ZXIge1xyXG4gIGNvbnN0cnVjdG9yKG1hcFZpZXcpIHtcclxuICAgIHRoaXMudmlldyA9IG1hcFZpZXc7XHJcbiAgICB0aGlzLmN1cnJlbnRQb3NpdGlvbiA9IG51bGw7XHJcbiAgfVxyXG5cclxuICBhc3luYyBpbml0aWFsaXplTWFwKGNvbnRhaW5lcklkLCBvcHRpb25zID0ge30pIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHsgbGF0ID0gMCwgbG5nID0gMCwgem9vbSA9IDEwIH0gPSBvcHRpb25zO1xyXG4gICAgICBhd2FpdCB0aGlzLnZpZXcuaW5pdE1hcChjb250YWluZXJJZCwgbGF0LCBsbmcsIHpvb20pO1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ01hcCBpbml0aWFsaXphdGlvbiBmYWlsZWQ6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRDdXJyZW50TG9jYXRpb24ob3B0aW9ucyA9IHt9KSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICBpZiAoIW5hdmlnYXRvci5nZW9sb2NhdGlvbikge1xyXG4gICAgICAgIHJlamVjdChuZXcgRXJyb3IoXCJHZW9sb2NhdGlvbiBpcyBub3Qgc3VwcG9ydGVkIGJ5IHlvdXIgYnJvd3NlclwiKSk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBuYXZpZ2F0b3IuZ2VvbG9jYXRpb24uZ2V0Q3VycmVudFBvc2l0aW9uKFxyXG4gICAgICAgIChwb3NpdGlvbikgPT4ge1xyXG4gICAgICAgICAgdGhpcy5jdXJyZW50UG9zaXRpb24gPSB7XHJcbiAgICAgICAgICAgIGxhdDogcG9zaXRpb24uY29vcmRzLmxhdGl0dWRlLFxyXG4gICAgICAgICAgICBsbmc6IHBvc2l0aW9uLmNvb3Jkcy5sb25naXR1ZGUsXHJcbiAgICAgICAgICAgIGFjY3VyYWN5OiBwb3NpdGlvbi5jb29yZHMuYWNjdXJhY3lcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICByZXNvbHZlKHRoaXMuY3VycmVudFBvc2l0aW9uKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIChlcnJvcikgPT4ge1xyXG4gICAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIG9wdGlvbnNcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgY2VudGVyVG9DdXJyZW50TG9jYXRpb24oem9vbSA9IDE1KSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBpZiAoIXRoaXMuY3VycmVudFBvc2l0aW9uKSB7XHJcbiAgICAgICAgYXdhaXQgdGhpcy5nZXRDdXJyZW50TG9jYXRpb24oKTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLnZpZXcuc2V0Vmlldyh0aGlzLmN1cnJlbnRQb3NpdGlvbi5sYXQsIHRoaXMuY3VycmVudFBvc2l0aW9uLmxuZywgem9vbSk7XHJcbiAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRQb3NpdGlvbjtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBjZW50ZXIgdG8gY3VycmVudCBsb2NhdGlvbjonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYWRkTWFya2VyKGxhdCwgbG5nLCBwb3B1cENvbnRlbnQgPSBcIlwiLCBvcHRpb25zID0ge30pIHtcclxuICAgIHJldHVybiB0aGlzLnZpZXcuYWRkTWFya2VyKGxhdCwgbG5nLCBwb3B1cENvbnRlbnQsIG9wdGlvbnMpO1xyXG4gIH1cclxuXHJcbiAgYWRkQ3VycmVudExvY2F0aW9uTWFya2VyKHBvcHVwQ29udGVudCA9IFwiXCIpIHtcclxuICAgIGlmICghdGhpcy5jdXJyZW50UG9zaXRpb24pIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdDdXJyZW50IGxvY2F0aW9uIG5vdCBhdmFpbGFibGUnKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmFkZE1hcmtlcihcclxuICAgICAgdGhpcy5jdXJyZW50UG9zaXRpb24ubGF0LFxyXG4gICAgICB0aGlzLmN1cnJlbnRQb3NpdGlvbi5sbmcsXHJcbiAgICAgIHBvcHVwQ29udGVudCxcclxuICAgICAgeyB0aXRsZTogJ1lvdXIgTG9jYXRpb24nIH1cclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBjbGVhck1hcmtlcnMoKSB7XHJcbiAgICB0aGlzLnZpZXcuY2xlYXJNYXJrZXJzKCk7XHJcbiAgfVxyXG5cclxuICBzZXRPbk1hcENsaWNrSGFuZGxlcihoYW5kbGVyKSB7XHJcbiAgICB0aGlzLnZpZXcub25NYXBDbGljaygoZSkgPT4ge1xyXG4gICAgICBoYW5kbGVyKGUubGF0bG5nLmxhdCwgZS5sYXRsbmcubG5nKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgY2xlYW51cCgpIHtcclxuICAgIHRoaXMudmlldy5yZW1vdmUoKTtcclxuICB9XHJcblxyXG4gIGhhbmRsZUxvY2F0aW9uU2VsZWN0aW9uKGxhdCwgbG5nKSB7XHJcbiAgdGhpcy5jbGVhck1hcmtlcnMoKTsgLy8gQ2xlYXIgZXhpc3RpbmcgbWFya2Vyc1xyXG4gIHRoaXMuYWRkTWFya2VyKGxhdCwgbG5nLCBcIlNlbGVjdGVkIExvY2F0aW9uXCIsIHtcclxuICAgIGRyYWdnYWJsZTogdHJ1ZSxcclxuICAgIGNvbG9yOiAncmVkJ1xyXG4gIH0pO1xyXG4gIHRoaXMudmlldy5zZXRWaWV3KGxhdCwgbG5nLCAxNSk7XHJcbn1cclxufSIsImxldCBjdXJyZW50U2tpcFRhcmdldCA9IG51bGw7XHJcblxyXG5leHBvcnQgY29uc3QgcmVzZXRTa2lwVG9Db250ZW50ID0gKCkgPT4ge1xyXG4gIGlmIChjdXJyZW50U2tpcFRhcmdldCkge1xyXG4gICAgY3VycmVudFNraXBUYXJnZXQuY2xhc3NMaXN0Py5yZW1vdmUoJ2ZvY3VzLXZpc2libGUnKTtcclxuICAgIGN1cnJlbnRTa2lwVGFyZ2V0LnJlbW92ZUF0dHJpYnV0ZSgndGFiaW5kZXgnKTtcclxuICAgIGN1cnJlbnRTa2lwVGFyZ2V0ID0gbnVsbDtcclxuICB9XHJcbn07XHJcblxyXG5jb25zdCBoYW5kbGVTa2lwVG9Db250ZW50ID0gYXN5bmMgKCkgPT4ge1xyXG4gIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHJlc29sdmUpKTtcclxuICBcclxuICBjb25zdCBtYWluQ29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluLWNvbnRlbnQnKTtcclxuICBpZiAoIW1haW5Db250ZW50KSByZXR1cm47XHJcblxyXG4gIHJlc2V0U2tpcFRvQ29udGVudCgpO1xyXG4gIFxyXG4gIG1haW5Db250ZW50LmNsYXNzTGlzdC5hZGQoJ2ZvY3VzLXZpc2libGUnKTtcclxuICBtYWluQ29udGVudC5mb2N1cyh7IHByZXZlbnRTY3JvbGw6IHRydWUgfSk7XHJcbiAgXHJcbiAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICBtYWluQ29udGVudC5jbGFzc0xpc3QucmVtb3ZlKCdmb2N1cy12aXNpYmxlJyk7XHJcbiAgfSwgMjAwMCk7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgaW5pdGlhbGl6ZVNraXBUb0NvbnRlbnQgPSAoKSA9PiB7XHJcbiAgY29uc3QgZXhpc3RpbmdTa2lwTGluayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5za2lwLWxpbmsnKTtcclxuICBpZiAoZXhpc3RpbmdTa2lwTGluaykgZXhpc3RpbmdTa2lwTGluay5yZW1vdmUoKTtcclxuXHJcbiAgY29uc3Qgc2tpcExpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XHJcbiAgc2tpcExpbmsuaHJlZiA9ICcjbWFpbi1jb250ZW50JztcclxuICBza2lwTGluay5jbGFzc05hbWUgPSAnc2tpcC1saW5rJztcclxuICBza2lwTGluay50ZXh0Q29udGVudCA9ICdTa2lwIHRvIGNvbnRlbnQnO1xyXG4gIFxyXG4gIHNraXBMaW5rLnN0eWxlLmNzc1RleHQgPSBgXHJcbiAgICBwb3NpdGlvbjogZml4ZWQ7XHJcbiAgICB0b3A6IC00MHB4O1xyXG4gICAgbGVmdDogMXJlbTtcclxuICAgIGJhY2tncm91bmQ6ICMwMDA7XHJcbiAgICBjb2xvcjogd2hpdGU7XHJcbiAgICBwYWRkaW5nOiA4cHggMTJweDtcclxuICAgIGJvcmRlci1yYWRpdXM6IDAgMCA0cHggNHB4O1xyXG4gICAgei1pbmRleDogOTk5OTtcclxuICAgIHRyYW5zaXRpb246IHRvcCAwLjNzIGVhc2U7XHJcbiAgYDtcclxuXHJcbiAgc2tpcExpbmsuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCAoKSA9PiB7XHJcbiAgICBza2lwTGluay5zdHlsZS50b3AgPSAnMCc7XHJcbiAgfSk7XHJcblxyXG4gIHNraXBMaW5rLmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCAoKSA9PiB7XHJcbiAgICBza2lwTGluay5zdHlsZS50b3AgPSAnLTQwcHgnO1xyXG4gIH0pO1xyXG5cclxuICBza2lwTGluay5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jIChlKSA9PiB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBhd2FpdCBoYW5kbGVTa2lwVG9Db250ZW50KCk7XHJcbiAgfSk7XHJcblxyXG4gIGRvY3VtZW50LmJvZHkucHJlcGVuZChza2lwTGluayk7XHJcblxyXG4gIHJldHVybiAoKSA9PiB7XHJcbiAgICBza2lwTGluay5yZW1vdmUoKTtcclxuICAgIHJlc2V0U2tpcFRvQ29udGVudCgpO1xyXG4gIH07XHJcbn07IiwiaW1wb3J0IHsgcmVzZXRTa2lwVG9Db250ZW50IH0gZnJvbSAnLi4vdXRpbHMvU2tpcFRvQ29udGVudCc7XHJcblxyXG5leHBvcnQgY29uc3QgQmFzZVZpZXcgPSAoaHRtbENvbnRlbnQpID0+IHtcclxuICBjb25zdCB2aWV3ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgdmlldy5jbGFzc05hbWUgPSAnYXV0aC1mb3JtJztcclxuICB2aWV3LmlubmVySFRNTCA9IGh0bWxDb250ZW50O1xyXG5cclxuICAvLyBDcmVhdGUgYSBNdXRhdGlvbk9ic2VydmVyIHRvIGRldGVjdCB3aGVuIHRoZSB2aWV3IGlzIHJlbW92ZWRcclxuICBjb25zdCBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKChtdXRhdGlvbnMpID0+IHtcclxuICAgIG11dGF0aW9ucy5mb3JFYWNoKChtdXRhdGlvbikgPT4ge1xyXG4gICAgICBpZiAoQXJyYXkuZnJvbShtdXRhdGlvbi5yZW1vdmVkTm9kZXMpLmluY2x1ZGVzKHZpZXcpKSB7XHJcbiAgICAgICAgY2xlYW51cCgpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgY29uc3QgY2xlYW51cCA9ICgpID0+IHtcclxuICAgIHJlc2V0U2tpcFRvQ29udGVudCgpO1xyXG4gICAgb2JzZXJ2ZXIuZGlzY29ubmVjdCgpOyAvLyBTdG9wIG9ic2VydmluZyB3aGVuIGNsZWFuaW5nIHVwXHJcbiAgfTtcclxuXHJcbiAgLy8gU3RhcnQgb2JzZXJ2aW5nIHRoZSB2aWV3J3MgcGFyZW50IGZvciByZW1vdmFsXHJcbiAgaWYgKHZpZXcucGFyZW50Tm9kZSkge1xyXG4gICAgb2JzZXJ2ZXIub2JzZXJ2ZSh2aWV3LnBhcmVudE5vZGUsIHsgY2hpbGRMaXN0OiB0cnVlIH0pO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgZ2V0VmlldyA9ICgpID0+IHtcclxuICAgIC8vIFdoZW4gdmlldyBpcyByZXRyaWV2ZWQsIGVuc3VyZSB3ZSBvYnNlcnZlIGl0cyBldmVudHVhbCBwYXJlbnRcclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICBpZiAodmlldy5wYXJlbnROb2RlICYmICFvYnNlcnZlci5faXNPYnNlcnZpbmcpIHtcclxuICAgICAgICBvYnNlcnZlci5vYnNlcnZlKHZpZXcucGFyZW50Tm9kZSwgeyBjaGlsZExpc3Q6IHRydWUgfSk7XHJcbiAgICAgICAgb2JzZXJ2ZXIuX2lzT2JzZXJ2aW5nID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfSwgMCk7XHJcbiAgICByZXR1cm4gdmlldztcclxuICB9O1xyXG5cclxuICBjb25zdCBzaG93RXJyb3IgPSAobWVzc2FnZSkgPT4ge1xyXG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdmlldy5xdWVyeVNlbGVjdG9yKCcjZXJyb3ItbWVzc2FnZScpIHx8IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2aWV3LnF1ZXJ5U2VsZWN0b3IoJy5lcnJvci1tZXNzYWdlJyk7XHJcbiAgICBpZiAoZXJyb3JFbGVtZW50KSB7XHJcbiAgICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XHJcbiAgICAgIGVycm9yRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gbWVzc2FnZSA/ICdibG9jaycgOiAnbm9uZSc7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgY29uc3Qgc2hvd1N1Y2Nlc3MgPSAobWVzc2FnZSkgPT4ge1xyXG4gICAgY29uc3Qgc3VjY2Vzc0VsZW1lbnQgPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoJyNzdWNjZXNzLW1lc3NhZ2UnKSB8fCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3LnF1ZXJ5U2VsZWN0b3IoJy5zdWNjZXNzLW1lc3NhZ2UnKTtcclxuICAgIGlmIChzdWNjZXNzRWxlbWVudCkge1xyXG4gICAgICBzdWNjZXNzRWxlbWVudC50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XHJcbiAgICAgIHN1Y2Nlc3NFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBtZXNzYWdlID8gJ2Jsb2NrJyA6ICdub25lJztcclxuICAgIH1cclxuICB9O1xyXG5cclxuICByZXR1cm4ge1xyXG4gICAgZ2V0VmlldyxcclxuICAgIHNob3dFcnJvcixcclxuICAgIHNob3dTdWNjZXNzLFxyXG4gICAgY2xlYW51cFxyXG4gIH07XHJcbn07IiwiaW1wb3J0IHsgQmFzZVZpZXcgfSBmcm9tICcuLi9CYXNlVmlldy5qcyc7XHJcblxyXG5leHBvcnQgY29uc3QgTG9naW5WaWV3ID0gKCkgPT4ge1xyXG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2hlYWRlcicpPy5yZW1vdmUoKTtcclxuXHJcbiAgY29uc3QgYmFzZSA9IEJhc2VWaWV3KGBcclxuICAgIDxoMj5Mb2dpbjwvaDI+XHJcbiAgICA8Zm9ybSBpZD1cImxvZ2luLWZvcm1cIj5cclxuICAgICAgPGRpdiBjbGFzcz1cImZvcm0tZ3JvdXBcIj5cclxuICAgICAgICA8bGFiZWwgZm9yPVwiZW1haWxcIj5FbWFpbDwvbGFiZWw+XHJcbiAgICAgICAgPGlucHV0IHR5cGU9XCJlbWFpbFwiIGlkPVwiZW1haWxcIiBuYW1lPVwiZW1haWxcIiByZXF1aXJlZD5cclxuICAgICAgPC9kaXY+XHJcbiAgICAgIDxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwXCI+XHJcbiAgICAgICAgPGxhYmVsIGZvcj1cInBhc3N3b3JkXCI+UGFzc3dvcmQ8L2xhYmVsPlxyXG4gICAgICAgIDxpbnB1dCB0eXBlPVwicGFzc3dvcmRcIiBpZD1cInBhc3N3b3JkXCIgbmFtZT1cInBhc3N3b3JkXCIgcmVxdWlyZWQgbWlubGVuZ3RoPVwiOFwiPlxyXG4gICAgICA8L2Rpdj5cclxuICAgICAgPGJ1dHRvbiB0eXBlPVwic3VibWl0XCI+TG9naW48L2J1dHRvbj5cclxuICAgIDwvZm9ybT5cclxuICAgIDxwPkRvbid0IGhhdmUgYW4gYWNjb3VudD8gPGEgaHJlZj1cIiMvcmVnaXN0ZXJcIj5SZWdpc3RlciBoZXJlPC9hPjwvcD5cclxuICAgIDxkaXYgaWQ9XCJlcnJvci1tZXNzYWdlXCIgY2xhc3M9XCJlcnJvci1tZXNzYWdlXCIgc3R5bGU9XCJkaXNwbGF5OiBub25lO1wiPjwvZGl2PlxyXG4gIGApO1xyXG5cclxuICBjb25zdCBiaW5kTG9naW4gPSAoaGFuZGxlcikgPT4ge1xyXG4gICAgY29uc3QgZm9ybSA9IGJhc2UuZ2V0VmlldygpLnF1ZXJ5U2VsZWN0b3IoJyNsb2dpbi1mb3JtJyk7XHJcbiAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBiYXNlLmdldFZpZXcoKS5xdWVyeVNlbGVjdG9yKCcjZXJyb3ItbWVzc2FnZScpO1xyXG4gICAgXHJcbiAgICBmb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGFzeW5jIChlKSA9PiB7XHJcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgY29uc3QgZW1haWwgPSBmb3JtLmVtYWlsLnZhbHVlO1xyXG4gICAgICBjb25zdCBwYXNzd29yZCA9IGZvcm0ucGFzc3dvcmQudmFsdWU7XHJcbiAgICAgIFxyXG4gICAgICBlcnJvck1lc3NhZ2Uuc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgICAgYXdhaXQgaGFuZGxlcihlbWFpbCwgcGFzc3dvcmQpO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIGdldFZpZXc6IGJhc2UuZ2V0VmlldywgIC8vIEV4cGxpY2l0bHkgZXhwb3NlIGdldFZpZXdcclxuICAgIHNob3dFcnJvcjogYmFzZS5zaG93RXJyb3IsXHJcbiAgICBzaG93U3VjY2VzczogYmFzZS5zaG93U3VjY2VzcyxcclxuICAgIGJpbmRMb2dpblxyXG4gIH07XHJcbn07IiwiaW1wb3J0IHsgQmFzZVZpZXcgfSBmcm9tICcuLi9CYXNlVmlldy5qcyc7XHJcblxyXG5leHBvcnQgY29uc3QgUmVnaXN0ZXJWaWV3ID0gKCkgPT4ge1xyXG4gIGNvbnN0IGJhc2UgPSBCYXNlVmlldyhgXHJcbiAgICA8aDI+UmVnaXN0ZXI8L2gyPlxyXG4gICAgPGZvcm0gaWQ9XCJyZWdpc3Rlci1mb3JtXCI+XHJcbiAgICAgIDxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwXCI+XHJcbiAgICAgICAgPGxhYmVsIGZvcj1cIm5hbWVcIj5OYW1lPC9sYWJlbD5cclxuICAgICAgICA8aW5wdXQgdHlwZT1cInRleHRcIiBpZD1cIm5hbWVcIiBuYW1lPVwibmFtZVwiIHJlcXVpcmVkPlxyXG4gICAgICA8L2Rpdj5cclxuICAgICAgPGRpdiBjbGFzcz1cImZvcm0tZ3JvdXBcIj5cclxuICAgICAgICA8bGFiZWwgZm9yPVwiZW1haWxcIj5FbWFpbDwvbGFiZWw+XHJcbiAgICAgICAgPGlucHV0IHR5cGU9XCJlbWFpbFwiIGlkPVwiZW1haWxcIiBuYW1lPVwiZW1haWxcIiByZXF1aXJlZD5cclxuICAgICAgPC9kaXY+XHJcbiAgICAgIDxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwXCI+XHJcbiAgICAgICAgPGxhYmVsIGZvcj1cInBhc3N3b3JkXCI+UGFzc3dvcmQ8L2xhYmVsPlxyXG4gICAgICAgIDxpbnB1dCB0eXBlPVwicGFzc3dvcmRcIiBpZD1cInBhc3N3b3JkXCIgbmFtZT1cInBhc3N3b3JkXCIgcmVxdWlyZWQgbWlubGVuZ3RoPVwiOFwiPlxyXG4gICAgICA8L2Rpdj5cclxuICAgICAgPGRpdiBjbGFzcz1cImZvcm0tZ3JvdXBcIj5cclxuICAgICAgICA8bGFiZWwgZm9yPVwiY29uZmlybS1wYXNzd29yZFwiPkNvbmZpcm0gUGFzc3dvcmQ8L2xhYmVsPlxyXG4gICAgICAgIDxpbnB1dCB0eXBlPVwicGFzc3dvcmRcIiBpZD1cImNvbmZpcm0tcGFzc3dvcmRcIiBuYW1lPVwiY29uZmlybS1wYXNzd29yZFwiIHJlcXVpcmVkIG1pbmxlbmd0aD1cIjhcIj5cclxuICAgICAgPC9kaXY+XHJcbiAgICAgIDxidXR0b24gdHlwZT1cInN1Ym1pdFwiPlJlZ2lzdGVyPC9idXR0b24+XHJcbiAgICA8L2Zvcm0+XHJcbiAgICA8cD5BbHJlYWR5IGhhdmUgYW4gYWNjb3VudD8gPGEgaHJlZj1cIiMvbG9naW5cIj5Mb2dpbiBoZXJlPC9hPjwvcD5cclxuICAgIDxkaXYgaWQ9XCJlcnJvci1tZXNzYWdlXCIgY2xhc3M9XCJlcnJvci1tZXNzYWdlXCIgc3R5bGU9XCJkaXNwbGF5OiBub25lO1wiPjwvZGl2PlxyXG4gICAgPGRpdiBpZD1cInN1Y2Nlc3MtbWVzc2FnZVwiIGNsYXNzPVwic3VjY2Vzcy1tZXNzYWdlXCIgc3R5bGU9XCJkaXNwbGF5OiBub25lO1wiPjwvZGl2PlxyXG4gIGApO1xyXG5cclxuICBjb25zdCBiaW5kUmVnaXN0ZXIgPSAoaGFuZGxlcikgPT4ge1xyXG4gICAgY29uc3QgZm9ybSA9IGJhc2UuZ2V0VmlldygpLnF1ZXJ5U2VsZWN0b3IoJyNyZWdpc3Rlci1mb3JtJyk7XHJcbiAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBiYXNlLmdldFZpZXcoKS5xdWVyeVNlbGVjdG9yKCcjZXJyb3ItbWVzc2FnZScpO1xyXG4gICAgXHJcbiAgICBmb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGFzeW5jIChlKSA9PiB7XHJcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgY29uc3QgbmFtZSA9IGZvcm0ubmFtZS52YWx1ZTtcclxuICAgICAgY29uc3QgZW1haWwgPSBmb3JtLmVtYWlsLnZhbHVlO1xyXG4gICAgICBjb25zdCBwYXNzd29yZCA9IGZvcm0ucGFzc3dvcmQudmFsdWU7XHJcbiAgICAgIGNvbnN0IGNvbmZpcm1QYXNzd29yZCA9IGZvcm1bJ2NvbmZpcm0tcGFzc3dvcmQnXS52YWx1ZTtcclxuICAgICAgXHJcbiAgICAgIGVycm9yTWVzc2FnZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG5cclxuICAgICAgaWYgKHBhc3N3b3JkICE9PSBjb25maXJtUGFzc3dvcmQpIHtcclxuICAgICAgICBiYXNlLnNob3dFcnJvcihcIlBhc3N3b3JkcyBkb24ndCBtYXRjaCFcIik7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBhd2FpdCBoYW5kbGVyKG5hbWUsIGVtYWlsLCBwYXNzd29yZCk7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICByZXR1cm4ge1xyXG4gICAgZ2V0VmlldzogYmFzZS5nZXRWaWV3LFxyXG4gICAgc2hvd0Vycm9yOiBiYXNlLnNob3dFcnJvcixcclxuICAgIHNob3dTdWNjZXNzOiBiYXNlLnNob3dTdWNjZXNzLFxyXG4gICAgYmluZFJlZ2lzdGVyXHJcbiAgfTtcclxufTsiLCJleHBvcnQgY29uc3QgU3Rvcmllc1ZpZXcgPSAoKSA9PiB7XHJcbiAgY29uc3QgdmlldyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJtYWluXCIpO1xyXG4gIHZpZXcuaWQgPSBcIm1haW4tY29udGVudFwiO1xyXG4gIHZpZXcuc2V0QXR0cmlidXRlKFwicm9sZVwiLCBcIm1haW5cIik7XHJcbiAgdmlldy5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIFwiU3RvcmllcyBsaXN0XCIpO1xyXG5cclxuICB2aWV3LmlubmVySFRNTCA9IGBcclxuICAgIDxoMSBpZD1cInN0b3JpZXMtaGVhZGluZ1wiPlN0b3JpZXM8L2gxPlxyXG4gICAgPGRpdiBjbGFzcz1cInN0b3JpZXMtZ3JpZFwiIGlkPVwic3Rvcmllcy1jb250YWluZXJcIiByb2xlPVwibGlzdFwiIGFyaWEtbGFiZWxsZWRieT1cInN0b3JpZXMtaGVhZGluZ1wiPjwvZGl2PlxyXG4gICAgPGRpdiBpZD1cImVycm9yLW1lc3NhZ2VcIiBjbGFzcz1cImVycm9yLW1lc3NhZ2VcIiBzdHlsZT1cImRpc3BsYXk6IG5vbmU7XCI+PC9kaXY+XHJcbiAgICA8ZGl2IGlkPVwibG9hZGluZy1pbmRpY2F0b3JcIiBzdHlsZT1cImRpc3BsYXk6IG5vbmU7XCI+TG9hZGluZyBzdG9yaWVzLi4uPC9kaXY+XHJcbiAgYDtcclxuXHJcbmNvbnN0IGRpc3BsYXlTdG9yaWVzID0gKHN0b3JpZXMpID0+IHtcclxuICBjb25zdCBjb250YWluZXIgPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoXCIjc3Rvcmllcy1jb250YWluZXJcIik7XHJcbiAgY29uc3QgbG9hZGluZyA9IHZpZXcucXVlcnlTZWxlY3RvcihcIiNsb2FkaW5nLWluZGljYXRvclwiKTtcclxuXHJcbiAgbG9hZGluZy5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgY29udGFpbmVyLmlubmVySFRNTCA9IFwiXCI7XHJcblxyXG4gIGlmICghc3RvcmllcyB8fCBzdG9yaWVzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgY29udGFpbmVyLmlubmVySFRNTCA9ICc8cCBjbGFzcz1cIm5vLXN0b3JpZXNcIj5ObyBzdG9yaWVzIGZvdW5kPC9wPic7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG5cclxuICAvLyBUYW1iYWhrYW4gZmFsbGJhY2sgcGhvdG9VcmwgamlrYSBrb3NvbmdcclxuICBzdG9yaWVzLmZvckVhY2goKHN0b3J5KSA9PiB7XHJcbiAgICBzdG9yeS5waG90b1VybCA9IHN0b3J5LnBob3RvVXJsIHx8ICcvYXNzZXRzL2ltYWdlcy9wbGFjZWhvbGRlci1vZmZsaW5lLmpwZyc7XHJcblxyXG4gICAgY29uc3Qgc3RvcnlFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFydGljbGVcIik7XHJcbiAgICBzdG9yeUVsZW1lbnQuY2xhc3NOYW1lID0gXCJzdG9yeS1jYXJkXCI7XHJcblxyXG4gICAgc3RvcnlFbGVtZW50LmlubmVySFRNTCA9IGBcclxuICAgICAgPGltZyBzcmM9XCIke3N0b3J5LnBob3RvVXJsfVwiIGFsdD1cIiR7c3RvcnkubmFtZX0ncyBzdG9yeVwiIGNsYXNzPVwic3RvcnktaW1hZ2VcIj5cclxuICAgICAgPGRpdiBjbGFzcz1cInN0b3J5LWNvbnRlbnRcIj5cclxuICAgICAgICA8aDM+JHtzdG9yeS5uYW1lfTwvaDM+XHJcbiAgICAgICAgPHA+JHtzdG9yeS5kZXNjcmlwdGlvbi5zdWJzdHJpbmcoMCwgMTAwKX0ke3N0b3J5LmRlc2NyaXB0aW9uLmxlbmd0aCA+IDEwMCA/IFwiLi4uXCIgOiBcIlwifTwvcD5cclxuICAgICAgICA8cCBjbGFzcz1cInN0b3J5LWRhdGVcIj4ke25ldyBEYXRlKHN0b3J5LmNyZWF0ZWRBdCkudG9Mb2NhbGVEYXRlU3RyaW5nKCl9PC9wPlxyXG4gICAgICAgIDxhIGhyZWY9XCIjL3N0b3JpZXMvJHtzdG9yeS5pZH1cIiBjbGFzcz1cInJlYWQtbW9yZVwiPlJlYWQgbW9yZTwvYT5cclxuICAgICAgPC9kaXY+XHJcbiAgICBgO1xyXG5cclxuICAgIC8vIE1ha2UgZW50aXJlIGNhcmQgY2xpY2thYmxlXHJcbiAgICBzdG9yeUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgd2luZG93LmxvY2F0aW9uLmhhc2ggPSBgIy9zdG9yaWVzLyR7c3RvcnkuaWR9YDtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIEtleWJvYXJkIG5hdmlnYXRpb25cclxuICAgIHN0b3J5RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCAoZSkgPT4ge1xyXG4gICAgICBpZiAoZS5rZXkgPT09IFwiRW50ZXJcIikge1xyXG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gYCMvc3Rvcmllcy8ke3N0b3J5LmlkfWA7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChzdG9yeUVsZW1lbnQpO1xyXG4gIH0pO1xyXG5cclxuICAvLyBGb2N1cyBtYW5hZ2VtZW50IGZvciB0aGUgZW50aXJlIGNvbnRhaW5lclxyXG4gIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwiZm9jdXNvdXRcIiwgKGUpID0+IHtcclxuICAgIGlmICghZS5yZWxhdGVkVGFyZ2V0IHx8ICFjb250YWluZXIuY29udGFpbnMoZS5yZWxhdGVkVGFyZ2V0KSkge1xyXG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnN0b3J5LWNhcmRcIikuZm9yRWFjaCgoY2FyZCkgPT4ge1xyXG4gICAgICAgIGNhcmQuY2xhc3NMaXN0LnJlbW92ZShcImNhcmQtZm9jdXNlZFwiKTtcclxuICAgICAgICBjYXJkLnF1ZXJ5U2VsZWN0b3IoXCIucmVhZC1tb3JlXCIpLnRhYkluZGV4ID0gLTE7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59O1xyXG5cclxuXHJcbiAgY29uc3Qgc2hvd0Vycm9yID0gKG1lc3NhZ2UpID0+IHtcclxuICAgIGNvbnN0IGVycm9yRWwgPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoXCIjZXJyb3ItbWVzc2FnZVwiKTtcclxuICAgIGVycm9yRWwudGV4dENvbnRlbnQgPSBtZXNzYWdlO1xyXG4gICAgZXJyb3JFbC5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xyXG4gICAgdmlldy5xdWVyeVNlbGVjdG9yKFwiI2xvYWRpbmctaW5kaWNhdG9yXCIpLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICB9O1xyXG5cclxuICBjb25zdCBzaG93TG9hZGluZyA9ICgpID0+IHtcclxuICAgIHZpZXcucXVlcnlTZWxlY3RvcihcIiNsb2FkaW5nLWluZGljYXRvclwiKS5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xyXG4gICAgdmlldy5xdWVyeVNlbGVjdG9yKFwiI2Vycm9yLW1lc3NhZ2VcIikuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IHNob3dPZmZsaW5lV2FybmluZyA9ICgpID0+IHtcclxuICBjb25zdCBjb250YWluZXIgPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoJyNzdG9yaWVzLWNvbnRhaW5lcicpO1xyXG4gIGNvbnN0IHdhcm5pbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICB3YXJuaW5nLmNsYXNzTmFtZSA9ICdvZmZsaW5lLXdhcm5pbmcnO1xyXG4gIHdhcm5pbmcuaW5uZXJIVE1MID0gYFxyXG4gICAgPGkgY2xhc3M9XCJmYXMgZmEtd2lmaS1zbGFzaFwiPjwvaT5cclxuICAgIDxzcGFuPlNob3dpbmcgb2ZmbGluZSBkYXRhLiBTb21lIHN0b3JpZXMgbWF5IG5vdCBiZSB1cC10by1kYXRlLjwvc3Bhbj5cclxuICBgO1xyXG4gIGNvbnRhaW5lci5wcmVwZW5kKHdhcm5pbmcpO1xyXG59O1xyXG5cclxuICBjb25zdCBiaW5kTG9hZFN0b3JpZXMgPSAoaGFuZGxlcikgPT4ge1xyXG4gICAgc2hvd0xvYWRpbmcoKTtcclxuICAgIGhhbmRsZXIoKS5jYXRjaCgoZXJyb3IpID0+IHtcclxuICAgICAgc2hvd0Vycm9yKGVycm9yLm1lc3NhZ2UgfHwgXCJGYWlsZWQgdG8gbG9hZCBzdG9yaWVzXCIpO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIGdldFZpZXc6ICgpID0+IHZpZXcsXHJcbiAgICBkaXNwbGF5U3RvcmllcyxcclxuICAgIHNob3dFcnJvcixcclxuICAgIGJpbmRMb2FkU3RvcmllcyxcclxuICAgIHNob3dMb2FkaW5nLFxyXG4gICAgc2hvd09mZmxpbmVXYXJuaW5nLFxyXG4gIH07XHJcbn07XHJcbiIsImltcG9ydCB7IHN0YXJ0Vmlld1RyYW5zaXRpb24gfSBmcm9tICcuLi8uLi91dGlscy92aWV3LXRyYW5zaXRpb24uanMnO1xyXG5pbXBvcnQgJ2xlYWZsZXQvZGlzdC9sZWFmbGV0LmNzcyc7XHJcbmltcG9ydCBMIGZyb20gJ2xlYWZsZXQnO1xyXG5pbXBvcnQgJ2xlYWZsZXQubWFya2VyY2x1c3Rlci9kaXN0L2xlYWZsZXQubWFya2VyY2x1c3Rlcic7XHJcbmltcG9ydCAnbGVhZmxldC5tYXJrZXJjbHVzdGVyL2Rpc3QvTWFya2VyQ2x1c3Rlci5jc3MnO1xyXG5pbXBvcnQgJ2xlYWZsZXQubWFya2VyY2x1c3Rlci9kaXN0L01hcmtlckNsdXN0ZXIuRGVmYXVsdC5jc3MnO1xyXG5cclxuLy8gRml4IGZvciBkZWZhdWx0IG1hcmtlciBpY29ucyBpbiBMZWFmbGV0XHJcbmRlbGV0ZSBMLkljb24uRGVmYXVsdC5wcm90b3R5cGUuX2dldEljb25Vcmw7XHJcbkwuSWNvbi5EZWZhdWx0Lm1lcmdlT3B0aW9ucyh7XHJcbiAgaWNvblJldGluYVVybDogJ2h0dHBzOi8vY2RuanMuY2xvdWRmbGFyZS5jb20vYWpheC9saWJzL2xlYWZsZXQvMS43LjEvaW1hZ2VzL21hcmtlci1pY29uLTJ4LnBuZycsXHJcbiAgaWNvblVybDogJ2h0dHBzOi8vY2RuanMuY2xvdWRmbGFyZS5jb20vYWpheC9saWJzL2xlYWZsZXQvMS43LjEvaW1hZ2VzL21hcmtlci1pY29uLnBuZycsXHJcbiAgc2hhZG93VXJsOiAnaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvbGVhZmxldC8xLjcuMS9pbWFnZXMvbWFya2VyLXNoYWRvdy5wbmcnXHJcbn0pO1xyXG5cclxuZXhwb3J0IGNvbnN0IERldGFpbFN0b3J5VmlldyA9ICgpID0+IHtcclxuICBjb25zdCB2aWV3ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbWFpbicpO1xyXG4gIHZpZXcuaWQgPSAnbWFpbi1jb250ZW50JztcclxuICBcclxuICB2aWV3LmlubmVySFRNTCA9IGBcclxuICAgIDxkaXYgY2xhc3M9XCJkZXRhaWwtc3RvcnlcIj5cclxuICAgICAgPGRpdiBjbGFzcz1cInN0b3J5LWltYWdlLWNvbnRhaW5lclwiPlxyXG4gICAgICAgIDxpbWcgaWQ9XCJzdG9yeS1pbWFnZVwiIGNsYXNzPVwiZGV0YWlsLXN0b3J5LWltYWdlXCIgYWx0PVwiU3RvcnkgaW1hZ2VcIj5cclxuICAgICAgICA8ZGl2IGNsYXNzPVwic3RvcnktbWV0YVwiPlxyXG4gICAgICAgICAgPGRpdiBjbGFzcz1cImF1dGhvci1pbmZvXCI+XHJcbiAgICAgICAgICAgIDxpIGNsYXNzPVwiZmFzIGZhLXVzZXItY2lyY2xlXCI+PC9pPlxyXG4gICAgICAgICAgICA8c3BhbiBpZD1cInN0b3J5LWF1dGhvclwiPjwvc3Bhbj5cclxuICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgPGRpdiBjbGFzcz1cImRhdGUtaW5mb1wiPlxyXG4gICAgICAgICAgICA8aSBjbGFzcz1cImZhciBmYS1jYWxlbmRhci1hbHRcIj48L2k+XHJcbiAgICAgICAgICAgIDxzcGFuIGlkPVwic3RvcnktZGF0ZVwiPjwvc3Bhbj5cclxuICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgIDwvZGl2PlxyXG4gICAgICA8L2Rpdj5cclxuICAgICAgXHJcbiAgICAgIDxkaXYgY2xhc3M9XCJzdG9yeS1jb250ZW50XCI+XHJcbiAgICAgICAgPGgxIGlkPVwic3RvcnktdGl0bGVcIiBjbGFzcz1cInN0b3J5LXRpdGxlXCI+PC9oMT5cclxuICAgICAgICA8cCBpZD1cInN0b3J5LWRlc2NyaXB0aW9uXCIgY2xhc3M9XCJzdG9yeS1kZXNjcmlwdGlvblwiPjwvcD5cclxuICAgICAgICBcclxuICAgICAgICA8ZGl2IGNsYXNzPVwibG9jYXRpb24tc2VjdGlvblwiPlxyXG4gICAgICAgICAgPGgzPjxpIGNsYXNzPVwiZmFzIGZhLW1hcC1tYXJrZXItYWx0XCI+PC9pPiBMb2thc2k8L2gzPlxyXG4gICAgICAgICAgPGRpdiBpZD1cInN0b3J5LW1hcC1jb250YWluZXJcIiBjbGFzcz1cImRldGFpbC1tYXAtY29udGFpbmVyXCI+XHJcbiAgICAgICAgICAgIDxkaXYgaWQ9XCJzdG9yeS1tYXBcIiBjbGFzcz1cImRldGFpbC1tYXBcIj48L2Rpdj5cclxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm1hcC1jb250cm9sc1wiPlxyXG4gICAgICAgICAgICAgIDxidXR0b24gaWQ9XCJzYXRlbGxpdGUtdmlld1wiIGNsYXNzPVwibWFwLWNvbnRyb2wtYnRuXCI+XHJcbiAgICAgICAgICAgICAgICA8aSBjbGFzcz1cImZhcyBmYS1zYXRlbGxpdGVcIj48L2k+XHJcbiAgICAgICAgICAgICAgPC9idXR0b24+XHJcbiAgICAgICAgICAgICAgPGJ1dHRvbiBpZD1cInN0cmVldC12aWV3XCIgY2xhc3M9XCJtYXAtY29udHJvbC1idG5cIj5cclxuICAgICAgICAgICAgICAgIDxpIGNsYXNzPVwiZmFzIGZhLXJvYWRcIj48L2k+XHJcbiAgICAgICAgICAgICAgPC9idXR0b24+XHJcbiAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgPC9kaXY+XHJcbiAgICBcclxuICAgIDxkaXYgaWQ9XCJlcnJvci1tZXNzYWdlXCIgY2xhc3M9XCJlcnJvci1tZXNzYWdlXCI+XHJcbiAgICAgIDxpIGNsYXNzPVwiZmFzIGZhLWV4Y2xhbWF0aW9uLWNpcmNsZVwiPjwvaT5cclxuICAgICAgPHNwYW4gY2xhc3M9XCJlcnJvci10ZXh0XCI+PC9zcGFuPlxyXG4gICAgPC9kaXY+XHJcbiAgYDtcclxuXHJcbiAgbGV0IG1hcEluc3RhbmNlID0gbnVsbDtcclxuICBsZXQgbWFya2VyQ2x1c3RlciA9IG51bGw7XHJcbiAgbGV0IGJhc2VMYXllcnMgPSB7fTtcclxuICBsZXQgY3VycmVudExheWVyID0gbnVsbDtcclxuXHJcbiAgY29uc3QgcHJlcGFyZU1hcENvbnRhaW5lciA9ICgpID0+IHtcclxuICAgIGNvbnN0IGNvbnRhaW5lciA9IHZpZXcucXVlcnlTZWxlY3RvcignI3N0b3J5LW1hcC1jb250YWluZXInKTtcclxuICAgIGNvbnN0IG1hcERpdiA9IHZpZXcucXVlcnlTZWxlY3RvcignI3N0b3J5LW1hcCcpO1xyXG4gICAgXHJcbiAgICAvLyBDb21wbGV0ZWx5IHJlY3JlYXRlIHRoZSBtYXAgY29udGFpbmVyXHJcbiAgICBpZiAobWFwRGl2KSB7XHJcbiAgICAgIGNvbnN0IG5ld01hcERpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICBuZXdNYXBEaXYuaWQgPSAnc3RvcnktbWFwJztcclxuICAgICAgbmV3TWFwRGl2LmNsYXNzTmFtZSA9ICdkZXRhaWwtbWFwJztcclxuICAgICAgY29udGFpbmVyLnJlcGxhY2VDaGlsZChuZXdNYXBEaXYsIG1hcERpdik7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIENsZWFuIHVwIGV4aXN0aW5nIG1hcCBpbnN0YW5jZXNcclxuICAgIGlmIChtYXBJbnN0YW5jZSkge1xyXG4gICAgICBtYXBJbnN0YW5jZS5yZW1vdmUoKTtcclxuICAgICAgbWFwSW5zdGFuY2UgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBpZiAobWFya2VyQ2x1c3Rlcikge1xyXG4gICAgICBtYXJrZXJDbHVzdGVyLmNsZWFyTGF5ZXJzKCk7XHJcbiAgICAgIG1hcmtlckNsdXN0ZXIgPSBudWxsO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIGNvbnN0IGluaXRNYXAgPSAobGF0LCBsbmcpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIENoZWNrIGlmIG1hcCBjb250YWluZXIgZXhpc3RzIGFuZCBpc24ndCBhbHJlYWR5IGluaXRpYWxpemVkXHJcbiAgICAgIGNvbnN0IG1hcEVsZW1lbnQgPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoJyNzdG9yeS1tYXAnKTtcclxuICAgICAgaWYgKCFtYXBFbGVtZW50IHx8IG1hcEVsZW1lbnQuX2xlYWZsZXRfaWQpIHtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gQ3JlYXRlIG5ldyBtYXAgaW5zdGFuY2VcclxuICAgICAgbWFwSW5zdGFuY2UgPSBMLm1hcChtYXBFbGVtZW50LCB7XHJcbiAgICAgICAgem9vbUNvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgIHByZWZlckNhbnZhczogdHJ1ZVxyXG4gICAgICB9KS5zZXRWaWV3KFtsYXQsIGxuZ10sIDEzKTtcclxuXHJcbiAgICAgIC8vIEFkZCB6b29tIGNvbnRyb2xcclxuICAgICAgTC5jb250cm9sLnpvb20oe1xyXG4gICAgICAgIHBvc2l0aW9uOiAnYm90dG9tcmlnaHQnXHJcbiAgICAgIH0pLmFkZFRvKG1hcEluc3RhbmNlKTtcclxuXHJcbiAgICAgIC8vIERlZmluZSBiYXNlIGxheWVyc1xyXG4gICAgICBiYXNlTGF5ZXJzID0ge1xyXG4gICAgICAgIFwiU3RyZWV0IFZpZXdcIjogTC50aWxlTGF5ZXIoJ2h0dHBzOi8ve3N9LnRpbGUub3BlbnN0cmVldG1hcC5vcmcve3p9L3t4fS97eX0ucG5nJywge1xyXG4gICAgICAgICAgYXR0cmlidXRpb246ICcmY29weTsgPGEgaHJlZj1cImh0dHBzOi8vd3d3Lm9wZW5zdHJlZXRtYXAub3JnL2NvcHlyaWdodFwiPk9wZW5TdHJlZXRNYXA8L2E+IGNvbnRyaWJ1dG9ycycsXHJcbiAgICAgICAgICBtYXhab29tOiAxOVxyXG4gICAgICAgIH0pLFxyXG4gICAgICAgIFwiU2F0ZWxsaXRlIFZpZXdcIjogTC50aWxlTGF5ZXIoJ2h0dHBzOi8vc2VydmVyLmFyY2dpc29ubGluZS5jb20vQXJjR0lTL3Jlc3Qvc2VydmljZXMvV29ybGRfSW1hZ2VyeS9NYXBTZXJ2ZXIvdGlsZS97en0ve3l9L3t4fScsIHtcclxuICAgICAgICAgIGF0dHJpYnV0aW9uOiAnVGlsZXMgJmNvcHk7IEVzcmkgJm1kYXNoOyBTb3VyY2U6IEVzcmksIGktY3ViZWQsIFVTREEsIFVTR1MsIEFFWCwgR2VvRXllLCBHZXRtYXBwaW5nLCBBZXJvZ3JpZCwgSUdOLCBJR1AsIFVQUi1FR1AsIGFuZCB0aGUgR0lTIFVzZXIgQ29tbXVuaXR5JyxcclxuICAgICAgICAgIG1heFpvb206IDE5XHJcbiAgICAgICAgfSlcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIEFkZCBkZWZhdWx0IGxheWVyXHJcbiAgICAgIGJhc2VMYXllcnNbXCJTdHJlZXQgVmlld1wiXS5hZGRUbyhtYXBJbnN0YW5jZSk7XHJcbiAgICAgIGN1cnJlbnRMYXllciA9IFwiU3RyZWV0IFZpZXdcIjtcclxuXHJcbiAgICAgIC8vIEFkZCBsYXllciBjb250cm9sXHJcbiAgICAgIEwuY29udHJvbC5sYXllcnMoYmFzZUxheWVycywgbnVsbCwge1xyXG4gICAgICAgIHBvc2l0aW9uOiAndG9wcmlnaHQnLFxyXG4gICAgICAgIGNvbGxhcHNlZDogZmFsc2VcclxuICAgICAgfSkuYWRkVG8obWFwSW5zdGFuY2UpO1xyXG5cclxuICAgICAgLy8gSW5pdGlhbGl6ZSBtYXJrZXIgY2x1c3RlclxyXG4gICAgICBtYXJrZXJDbHVzdGVyID0gTC5tYXJrZXJDbHVzdGVyR3JvdXAoe1xyXG4gICAgICAgIHNwaWRlcmZ5T25NYXhab29tOiB0cnVlLFxyXG4gICAgICAgIHNob3dDb3ZlcmFnZU9uSG92ZXI6IGZhbHNlLFxyXG4gICAgICAgIHpvb21Ub0JvdW5kc09uQ2xpY2s6IHRydWUsXHJcbiAgICAgICAgbWF4Q2x1c3RlclJhZGl1czogNDBcclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyBBZGQgY3VzdG9tIGNvbnRyb2wgYnV0dG9uIGV2ZW50c1xyXG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2F0ZWxsaXRlLXZpZXcnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgICAgc3dpdGNoTGF5ZXIoXCJTYXRlbGxpdGUgVmlld1wiKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RyZWV0LXZpZXcnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgICAgc3dpdGNoTGF5ZXIoXCJTdHJlZXQgVmlld1wiKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICByZXR1cm4gbWFwSW5zdGFuY2U7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdNYXAgaW5pdGlhbGl6YXRpb24gZXJyb3I6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBjb25zdCBzd2l0Y2hMYXllciA9IChsYXllck5hbWUpID0+IHtcclxuICAgIGlmIChtYXBJbnN0YW5jZSAmJiBjdXJyZW50TGF5ZXIgIT09IGxheWVyTmFtZSkge1xyXG4gICAgICBtYXBJbnN0YW5jZS5yZW1vdmVMYXllcihiYXNlTGF5ZXJzW2N1cnJlbnRMYXllcl0pO1xyXG4gICAgICBiYXNlTGF5ZXJzW2xheWVyTmFtZV0uYWRkVG8obWFwSW5zdGFuY2UpO1xyXG4gICAgICBjdXJyZW50TGF5ZXIgPSBsYXllck5hbWU7XHJcbiAgICAgIFxyXG4gICAgICAvLyBVcGRhdGUgYWN0aXZlIGJ1dHRvbiBzdGF0ZVxyXG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubWFwLWNvbnRyb2wtYnRuJykuZm9yRWFjaChidG4gPT4ge1xyXG4gICAgICAgIGJ0bi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcclxuICAgICAgfSk7XHJcbiAgICAgIGNvbnN0IGFjdGl2ZUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke2xheWVyTmFtZS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoJyAnLCAnLScpfS12aWV3YCk7XHJcbiAgICAgIGlmIChhY3RpdmVCdG4pIGFjdGl2ZUJ0bi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBjb25zdCBkaXNwbGF5U3RvcnlEZXRhaWwgPSBhc3luYyAoc3RvcnkpID0+IHtcclxuICAgIGF3YWl0IHN0YXJ0Vmlld1RyYW5zaXRpb24oYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBQcmVwYXJlIHRoZSB2aWV3IGZpcnN0XHJcbiAgICAgIGNvbnN0IGltYWdlRWxlbWVudCA9IHZpZXcucXVlcnlTZWxlY3RvcignI3N0b3J5LWltYWdlJyk7XHJcbiAgICAgIGltYWdlRWxlbWVudC5zcmMgPSBzdG9yeS5waG90b1VybDtcclxuICAgICAgaW1hZ2VFbGVtZW50LmFsdCA9IGBTdG9yeSBieSAke3N0b3J5Lm5hbWV9YDtcclxuICAgICAgdmlldy5xdWVyeVNlbGVjdG9yKCcjc3RvcnktdGl0bGUnKS50ZXh0Q29udGVudCA9IHN0b3J5Lm5hbWU7XHJcbiAgICAgIHZpZXcucXVlcnlTZWxlY3RvcignI3N0b3J5LWF1dGhvcicpLnRleHRDb250ZW50ID0gc3RvcnkubmFtZTtcclxuICAgICAgdmlldy5xdWVyeVNlbGVjdG9yKCcjc3RvcnktZGVzY3JpcHRpb24nKS50ZXh0Q29udGVudCA9IHN0b3J5LmRlc2NyaXB0aW9uO1xyXG4gICAgICB2aWV3LnF1ZXJ5U2VsZWN0b3IoJyNzdG9yeS1kYXRlJykudGV4dENvbnRlbnQgPSBuZXcgRGF0ZShzdG9yeS5jcmVhdGVkQXQpLnRvTG9jYWxlU3RyaW5nKCdpZC1JRCcsIHtcclxuICAgICAgICB3ZWVrZGF5OiAnbG9uZycsXHJcbiAgICAgICAgeWVhcjogJ251bWVyaWMnLFxyXG4gICAgICAgIG1vbnRoOiAnbG9uZycsXHJcbiAgICAgICAgZGF5OiAnbnVtZXJpYycsXHJcbiAgICAgICAgaG91cjogJzItZGlnaXQnLFxyXG4gICAgICAgIG1pbnV0ZTogJzItZGlnaXQnXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gSGFuZGxlIG1hcCBkaXNwbGF5XHJcbiAgICAgIGNvbnN0IG1hcENvbnRhaW5lciA9IHZpZXcucXVlcnlTZWxlY3RvcignI3N0b3J5LW1hcC1jb250YWluZXInKTtcclxuICAgICAgaWYgKHN0b3J5LmxhdCAmJiBzdG9yeS5sb24pIHtcclxuICAgICAgICBtYXBDb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gUHJlcGFyZSB0aGUgbWFwIGNvbnRhaW5lclxyXG4gICAgICAgIHByZXBhcmVNYXBDb250YWluZXIoKTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBXYWl0IGZvciBET00gdG8gYmUgcmVhZHlcclxuICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHJlcXVlc3RBbmltYXRpb25GcmFtZShyZXNvbHZlKSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gSW5pdGlhbGl6ZSBtYXBcclxuICAgICAgICBjb25zdCBtYXAgPSBpbml0TWFwKHN0b3J5LmxhdCwgc3RvcnkubG9uKTtcclxuICAgICAgICBcclxuICAgICAgICBpZiAobWFwKSB7XHJcbiAgICAgICAgICAvLyBBZGQgbWFya2VyIHRvIHRoZSBjbHVzdGVyXHJcbiAgICAgICAgICBjb25zdCBtYXJrZXIgPSBMLm1hcmtlcihbc3RvcnkubGF0LCBzdG9yeS5sb25dKVxyXG4gICAgICAgICAgICAuYmluZFBvcHVwKGBcclxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibWFwLXBvcHVwXCI+XHJcbiAgICAgICAgICAgICAgICA8aDQ+JHtzdG9yeS5uYW1lfTwvaDQ+XHJcbiAgICAgICAgICAgICAgICA8cD4ke3N0b3J5LmRlc2NyaXB0aW9uLnN1YnN0cmluZygwLCAxMDApfS4uLjwvcD5cclxuICAgICAgICAgICAgICAgIDxzbWFsbD4ke25ldyBEYXRlKHN0b3J5LmNyZWF0ZWRBdCkudG9Mb2NhbGVEYXRlU3RyaW5nKCl9PC9zbWFsbD5cclxuICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgYCk7XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIG1hcmtlckNsdXN0ZXIuYWRkTGF5ZXIobWFya2VyKTtcclxuICAgICAgICAgIG1hcC5hZGRMYXllcihtYXJrZXJDbHVzdGVyKTtcclxuICAgICAgICAgIG1hcmtlci5vcGVuUG9wdXAoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbWFwQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IHNob3dFcnJvciA9IChtZXNzYWdlKSA9PiB7XHJcbiAgICBjb25zdCBlcnJvckVsZW1lbnQgPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoJyNlcnJvci1tZXNzYWdlJyk7XHJcbiAgICBjb25zdCBlcnJvclRleHQgPSBlcnJvckVsZW1lbnQucXVlcnlTZWxlY3RvcignLmVycm9yLXRleHQnKTtcclxuICAgIGVycm9yVGV4dC50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XHJcbiAgICBlcnJvckVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdmbGV4JztcclxuICAgIFxyXG4gICAgLy8gQW5pbWF0aW9uIGZvciBlcnJvciBtZXNzYWdlXHJcbiAgICBlcnJvckVsZW1lbnQuYW5pbWF0ZShbXHJcbiAgICAgIHsgb3BhY2l0eTogMCwgdHJhbnNmb3JtOiAndHJhbnNsYXRlWSgtMTBweCknIH0sXHJcbiAgICAgIHsgb3BhY2l0eTogMSwgdHJhbnNmb3JtOiAndHJhbnNsYXRlWSgwKScgfVxyXG4gICAgXSwge1xyXG4gICAgICBkdXJhdGlvbjogMzAwLFxyXG4gICAgICBlYXNpbmc6ICdlYXNlLW91dCdcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IGNsZWFudXAgPSAoKSA9PiB7XHJcbiAgICBpZiAobWFwSW5zdGFuY2UpIHtcclxuICAgICAgbWFwSW5zdGFuY2UucmVtb3ZlKCk7XHJcbiAgICAgIG1hcEluc3RhbmNlID0gbnVsbDtcclxuICAgIH1cclxuICAgIGlmIChtYXJrZXJDbHVzdGVyKSB7XHJcbiAgICAgIG1hcmtlckNsdXN0ZXIuY2xlYXJMYXllcnMoKTtcclxuICAgICAgbWFya2VyQ2x1c3RlciA9IG51bGw7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIGdldFZpZXc6ICgpID0+IHZpZXcsXHJcbiAgICBkaXNwbGF5U3RvcnlEZXRhaWwsXHJcbiAgICBzaG93RXJyb3IsXHJcbiAgICBjbGVhbnVwLFxyXG4gICAgcHJlcGFyZU1hcENvbnRhaW5lclxyXG4gIH07XHJcbn07IiwiaW1wb3J0IHsgc2hvd05vdGlmaWNhdGlvblByb21wdCB9IGZyb20gXCIuLi8uLi91dGlscy9ub3RpZmljYXRpb24uanNcIjtcclxuXHJcbmV4cG9ydCBjb25zdCBBZGRTdG9yeVZpZXcgPSAoKSA9PiB7XHJcbiAgY29uc3QgdmlldyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJtYWluXCIpO1xyXG4gIHZpZXcuaWQgPSBcIm1haW4tY29udGVudFwiO1xyXG4gIHZpZXcuc2V0QXR0cmlidXRlKFwicm9sZVwiLCBcIm1haW5cIik7XHJcbiAgdmlldy5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIFwiQWRkIG5ldyBzdG9yeSBmb3JtXCIpO1xyXG5cclxuICB2aWV3LmlubmVySFRNTCA9IGBcclxuXHJcbiAgICA8ZGl2IGNsYXNzPVwiYWRkLXN0b3J5LWZvcm1cIj5cclxuICAgIDxoMj5BZGQgTmV3IFN0b3J5PC9oMj4gXHJcbiAgICA8ZGl2IGNsYXNzPVwibm90aWZpY2F0aW9uLXBlcm1pc3Npb24taW5mb1wiIHN0eWxlPVwiZGlzcGxheTogbm9uZTtcIj5cclxuICAgICAgPHA+V2UnZCBsaWtlIHRvIHNob3cgbm90aWZpY2F0aW9ucyB3aGVuIHlvdSBhZGQgc3Rvcmllcy4gVGhpcyBoZWxwcyB5b3Uga2VlcCB0cmFjayBvZiB5b3VyIGNvbnRyaWJ1dGlvbnMuPC9wPlxyXG4gICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBpZD1cImVuYWJsZS1ub3RpZmljYXRpb25zXCIgY2xhc3M9XCJidG5cIj5FbmFibGUgTm90aWZpY2F0aW9uczwvYnV0dG9uPlxyXG4gICAgPC9kaXY+XHJcbiAgICAgIDxmb3JtIGlkPVwic3RvcnktZm9ybVwiPlxyXG4gICAgICAgIDxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwXCI+XHJcbiAgICAgICAgICA8bGFiZWwgZm9yPVwiZGVzY3JpcHRpb25cIj5EZXNjcmlwdGlvbjwvbGFiZWw+XHJcbiAgICAgICAgICA8dGV4dGFyZWEgaWQ9XCJkZXNjcmlwdGlvblwiIG5hbWU9XCJkZXNjcmlwdGlvblwiIHJvd3M9XCI0XCIgcmVxdWlyZWQ+PC90ZXh0YXJlYT5cclxuICAgICAgICA8L2Rpdj5cclxuICAgICAgICBcclxuICAgICAgICA8ZGl2IGNsYXNzPVwiZm9ybS1ncm91cCBjYW1lcmEtY29udGFpbmVyXCI+XHJcbiAgICAgICAgICA8bGFiZWw+UGhvdG88L2xhYmVsPlxyXG4gICAgICAgICAgPGRpdiBjbGFzcz1cInByZXZpZXctY29udGFpbmVyXCI+XHJcbiAgICAgICAgICAgIDx2aWRlbyBpZD1cImNhbWVyYS1wcmV2aWV3XCIgY2xhc3M9XCJtZWRpYS1wcmV2aWV3XCIgYXV0b3BsYXkgcGxheXNpbmxpbmU+PC92aWRlbz5cclxuICAgICAgICAgICAgPGltZyBpZD1cInBob3RvLXByZXZpZXdcIiBjbGFzcz1cIm1lZGlhLXByZXZpZXdcIiBzdHlsZT1cImRpc3BsYXk6bm9uZTsgb2JqZWN0LWZpdDpjb250YWluO1wiIGFsdD1cIkNhcHR1cmVkIHBob3RvXCI+XHJcbiAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJjYW1lcmEtY29udHJvbHNcIj5cclxuICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgaWQ9XCJzdGFydC1jYW1lcmFcIiBjbGFzcz1cImJ0biBjYW1lcmEtYnRuXCI+U3RhcnQgQ2FtZXJhPC9idXR0b24+XHJcbiAgICAgICAgICAgIDxzZWxlY3QgaWQ9XCJjYW1lcmEtc2VsZWN0XCIgY2xhc3M9XCJjYW1lcmEtc2VsZWN0XCIgc3R5bGU9XCJkaXNwbGF5Om5vbmU7XCI+PC9zZWxlY3Q+XHJcbiAgICAgICAgICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGlkPVwiY2FwdHVyZS1idG5cIiBjbGFzcz1cImJ0biBjYXB0dXJlLWJ0blwiIHN0eWxlPVwiZGlzcGxheTpub25lO1wiPkNhcHR1cmUgUGhvdG88L2J1dHRvbj5cclxuICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgaWQ9XCJzdG9wLWNhbWVyYVwiIGNsYXNzPVwiYnRuIHN0b3AtYnRuXCIgc3R5bGU9XCJkaXNwbGF5Om5vbmU7XCI+U3RvcCBDYW1lcmE8L2J1dHRvbj5cclxuICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgaWQ9XCJyZXRha2UtYnRuXCIgY2xhc3M9XCJidG4gcmV0YWtlLWJ0blwiIHN0eWxlPVwiZGlzcGxheTpub25lO1wiPlJldGFrZSBQaG90bzwvYnV0dG9uPlxyXG4gICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICA8Y2FudmFzIGlkPVwiY2FudmFzXCIgc3R5bGU9XCJkaXNwbGF5Om5vbmU7XCI+PC9jYW52YXM+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgXHJcbiAgICAgICAgPGRpdiBjbGFzcz1cImZvcm0tZ3JvdXBcIj5cclxuICAgICAgICAgIDxsYWJlbD5Mb2NhdGlvbjwvbGFiZWw+XHJcbiAgICAgICAgICA8ZGl2IGlkPVwibWFwXCIgY2xhc3M9XCJtYXAtY29udGFpbmVyXCI+PC9kaXY+XHJcbiAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBpZD1cImdldC1sb2NhdGlvblwiIGNsYXNzPVwiYnRuIGxvY2F0aW9uLWJ0blwiPlVzZSBDdXJyZW50IExvY2F0aW9uPC9idXR0b24+XHJcbiAgICAgICAgICA8aW5wdXQgdHlwZT1cImhpZGRlblwiIGlkPVwibGF0XCIgbmFtZT1cImxhdFwiPlxyXG4gICAgICAgICAgPGlucHV0IHR5cGU9XCJoaWRkZW5cIiBpZD1cImxuZ1wiIG5hbWU9XCJsbmdcIj5cclxuICAgICAgICAgIDxwIGlkPVwibG9jYXRpb24tc3RhdHVzXCIgY2xhc3M9XCJsb2NhdGlvbi1zdGF0dXNcIj5ObyBsb2NhdGlvbiBzZWxlY3RlZDwvcD5cclxuICAgICAgICA8L2Rpdj5cclxuICAgICAgICBcclxuICAgICAgICA8YnV0dG9uIHR5cGU9XCJzdWJtaXRcIiBjbGFzcz1cImJ0biBzdWJtaXQtYnRuXCI+U3VibWl0IFN0b3J5PC9idXR0b24+XHJcbiAgICAgIDwvZm9ybT5cclxuICAgICAgPGRpdiBpZD1cImVycm9yLW1lc3NhZ2VcIiBjbGFzcz1cImVycm9yLW1lc3NhZ2VcIj48L2Rpdj5cclxuICAgICAgPGRpdiBpZD1cInN1Y2Nlc3MtbWVzc2FnZVwiIGNsYXNzPVwic3VjY2Vzcy1tZXNzYWdlXCI+PC9kaXY+XHJcbiAgICA8L2Rpdj5cclxuICBgO1xyXG5cclxuICAvLyBTdGF0ZVxyXG4gIGxldCBzdHJlYW0gPSBudWxsO1xyXG4gIGxldCBwaG90b0ZpbGUgPSBudWxsO1xyXG4gIGxldCBtYXAgPSBudWxsO1xyXG4gIGxldCBhdmFpbGFibGVDYW1lcmFzID0gW107XHJcbiAgbGV0IG1hcE1hcmtlciA9IG51bGw7XHJcbiAgbGV0IGlzVmlld0FjdGl2ZSA9IHRydWU7XHJcblxyXG4gIC8vIERPTSBFbGVtZW50c1xyXG4gIGNvbnN0IGNhbWVyYVByZXZpZXcgPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoXCIjY2FtZXJhLXByZXZpZXdcIik7XHJcbiAgY29uc3QgcGhvdG9QcmV2aWV3ID0gdmlldy5xdWVyeVNlbGVjdG9yKFwiI3Bob3RvLXByZXZpZXdcIik7XHJcbiAgY29uc3Qgc3RhcnRDYW1lcmFCdG4gPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoXCIjc3RhcnQtY2FtZXJhXCIpO1xyXG4gIGNvbnN0IGNhbWVyYVNlbGVjdCA9IHZpZXcucXVlcnlTZWxlY3RvcihcIiNjYW1lcmEtc2VsZWN0XCIpO1xyXG4gIGNvbnN0IGNhcHR1cmVCdG4gPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoXCIjY2FwdHVyZS1idG5cIik7XHJcbiAgY29uc3Qgc3RvcENhbWVyYUJ0biA9IHZpZXcucXVlcnlTZWxlY3RvcihcIiNzdG9wLWNhbWVyYVwiKTtcclxuICBjb25zdCByZXRha2VCdG4gPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoXCIjcmV0YWtlLWJ0blwiKTtcclxuICBjb25zdCBjYW52YXMgPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoXCIjY2FudmFzXCIpO1xyXG4gIGNvbnN0IG1hcENvbnRhaW5lciA9IHZpZXcucXVlcnlTZWxlY3RvcihcIiNtYXBcIik7XHJcbiAgY29uc3QgbG9jYXRpb25TdGF0dXMgPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoXCIjbG9jYXRpb24tc3RhdHVzXCIpO1xyXG5cclxuICBjb25zdCBjaGVja05vdGlmaWNhdGlvblBlcm1pc3Npb24gPSAoKSA9PiB7XHJcbiAgICBjb25zdCBub3RpZmljYXRpb25JbmZvID0gdmlldy5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICBcIi5ub3RpZmljYXRpb24tcGVybWlzc2lvbi1pbmZvXCJcclxuICAgICk7XHJcbiAgICBjb25zdCBlbmFibGVOb3RpZmljYXRpb25zQnRuID0gdmlldy5xdWVyeVNlbGVjdG9yKFwiI2VuYWJsZS1ub3RpZmljYXRpb25zXCIpO1xyXG5cclxuICAgIGlmIChOb3RpZmljYXRpb24ucGVybWlzc2lvbiA9PT0gXCJkZWZhdWx0XCIpIHtcclxuICAgICAgbm90aWZpY2F0aW9uSW5mby5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xyXG5cclxuICAgICAgZW5hYmxlTm90aWZpY2F0aW9uc0J0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBjb25zdCBncmFudGVkID0gYXdhaXQgc2hvd05vdGlmaWNhdGlvblByb21wdCgpO1xyXG4gICAgICAgICAgbm90aWZpY2F0aW9uSW5mby5zdHlsZS5kaXNwbGF5ID0gZ3JhbnRlZCA/IFwibm9uZVwiIDogXCJibG9ja1wiO1xyXG5cclxuICAgICAgICAgIGlmIChncmFudGVkKSB7XHJcbiAgICAgICAgICAgIC8vIE9wdGlvbmFsOiBTaG93IGEgY29uZmlybWF0aW9uIG1lc3NhZ2VcclxuICAgICAgICAgICAgc2hvd1N1Y2Nlc3MoXCJOb3RpZmljYXRpb25zIGVuYWJsZWQhXCIpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcmVxdWVzdGluZyBub3RpZmljYXRpb24gcGVybWlzc2lvbjpcIiwgZXJyb3IpO1xyXG4gICAgICAgICAgc2hvd0Vycm9yKFwiRmFpbGVkIHRvIGVuYWJsZSBub3RpZmljYXRpb25zXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBub3RpZmljYXRpb25JbmZvLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBjb25zdCBpbml0aWFsaXplTWFwID0gKCkgPT4ge1xyXG4gICAgaWYgKCFtYXAgJiYgbWFwQ29udGFpbmVyKSB7XHJcbiAgICAgIG1hcCA9IEwubWFwKG1hcENvbnRhaW5lcikuc2V0VmlldyhbLTYuMiwgMTA2LjhdLCAxMyk7XHJcbiAgICAgIEwudGlsZUxheWVyKFwiaHR0cHM6Ly97c30udGlsZS5vcGVuc3RyZWV0bWFwLm9yZy97en0ve3h9L3t5fS5wbmdcIiwge1xyXG4gICAgICAgIGF0dHJpYnV0aW9uOiBcIiZjb3B5OyBPcGVuU3RyZWV0TWFwIGNvbnRyaWJ1dG9yc1wiLFxyXG4gICAgICB9KS5hZGRUbyhtYXApO1xyXG5cclxuICAgICAgbWFwLm9uKFwiY2xpY2tcIiwgKGUpID0+IHtcclxuICAgICAgICBjb25zdCB7IGxhdCwgbG5nIH0gPSBlLmxhdGxuZztcclxuICAgICAgICB1cGRhdGVMb2NhdGlvbihsYXQsIGxuZyk7XHJcbiAgICAgICAgYWRkTWFwTWFya2VyKGxhdCwgbG5nKTtcclxuICAgICAgICBzaG93U3VjY2VzcyhcIkxvY2F0aW9uIHNlbGVjdGVkIG9uIG1hcCFcIik7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIC8vIEFkZCBtYXJrZXIgdG8gbWFwXHJcbiAgY29uc3QgYWRkTWFwTWFya2VyID0gKGxhdCwgbG5nKSA9PiB7XHJcbiAgICBpZiAobWFwTWFya2VyKSB7XHJcbiAgICAgIG1hcC5yZW1vdmVMYXllcihtYXBNYXJrZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIG1hcE1hcmtlciA9IEwubWFya2VyKFtsYXQsIGxuZ10sIHtcclxuICAgICAgZHJhZ2dhYmxlOiB0cnVlLFxyXG4gICAgICB0aXRsZTogXCJTdG9yeSBMb2NhdGlvblwiLFxyXG4gICAgfSlcclxuICAgICAgLmFkZFRvKG1hcClcclxuICAgICAgLmJpbmRQb3B1cChcIlN0b3J5IGxvY2F0aW9uXCIpXHJcbiAgICAgIC5vcGVuUG9wdXAoKTtcclxuXHJcbiAgICBtYXBNYXJrZXIub24oXCJkcmFnZW5kXCIsIChlKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5ld1BvcyA9IGUudGFyZ2V0LmdldExhdExuZygpO1xyXG4gICAgICB1cGRhdGVMb2NhdGlvbihuZXdQb3MubGF0LCBuZXdQb3MubG5nKTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIC8vIFVwZGF0ZSBsb2NhdGlvbiBpbnB1dHMgYW5kIHN0YXR1c1xyXG4gIGNvbnN0IHVwZGF0ZUxvY2F0aW9uID0gKGxhdCwgbG5nKSA9PiB7XHJcbiAgICB2aWV3LnF1ZXJ5U2VsZWN0b3IoXCIjbGF0XCIpLnZhbHVlID0gbGF0O1xyXG4gICAgdmlldy5xdWVyeVNlbGVjdG9yKFwiI2xuZ1wiKS52YWx1ZSA9IGxuZztcclxuICAgIGxvY2F0aW9uU3RhdHVzLnRleHRDb250ZW50ID0gYExvY2F0aW9uIHNldDogJHtsYXQudG9GaXhlZChcclxuICAgICAgNFxyXG4gICAgKX0sICR7bG5nLnRvRml4ZWQoNCl9YDtcclxuICAgIGxvY2F0aW9uU3RhdHVzLnN0eWxlLmNvbG9yID0gXCIjNENBRjUwXCI7XHJcbiAgfTtcclxuXHJcbiAgLy8gTWVzc2FnZSBoYW5kbGVyc1xyXG4gIGNvbnN0IHNob3dFcnJvciA9IChtZXNzYWdlKSA9PiB7XHJcbiAgICBjb25zdCBlcnJvckVsZW1lbnQgPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoXCIjZXJyb3ItbWVzc2FnZVwiKTtcclxuICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XHJcbiAgICBlcnJvckVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcclxuICAgIHNldFRpbWVvdXQoKCkgPT4gKGVycm9yRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCIpLCA1MDAwKTtcclxuICB9O1xyXG5cclxuICBjb25zdCBzaG93U3VjY2VzcyA9IChtZXNzYWdlKSA9PiB7XHJcbiAgICBjb25zdCBzdWNjZXNzRWxlbWVudCA9IHZpZXcucXVlcnlTZWxlY3RvcihcIiNzdWNjZXNzLW1lc3NhZ2VcIik7XHJcbiAgICBzdWNjZXNzRWxlbWVudC50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XHJcbiAgICBzdWNjZXNzRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xyXG4gICAgc2V0VGltZW91dCgoKSA9PiAoc3VjY2Vzc0VsZW1lbnQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiKSwgNTAwMCk7XHJcbiAgfTtcclxuXHJcbiAgLy8gQ2FtZXJhIGZ1bmN0aW9uc1xyXG4gIGNvbnN0IGdldENhbWVyYURldmljZXMgPSBhc3luYyAoKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBkZXZpY2VzID0gYXdhaXQgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5lbnVtZXJhdGVEZXZpY2VzKCk7XHJcbiAgICAgIHJldHVybiBkZXZpY2VzLmZpbHRlcigoZGV2aWNlKSA9PiBkZXZpY2Uua2luZCA9PT0gXCJ2aWRlb2lucHV0XCIpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgc2hvd0Vycm9yKGBDYW1lcmEgYWNjZXNzIGVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBjb25zdCBzdG9wQ2FtZXJhID0gKCkgPT4ge1xyXG4gICAgc3RvcENhbWVyYUJ0bi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICBzdGFydENhbWVyYUJ0bi5zdHlsZS5kaXNwbGF5ID0gXCJpbmxpbmUtYmxvY2tcIjtcclxuXHJcbiAgICBpZiAoc3RyZWFtKSB7XHJcbiAgICAgIHN0cmVhbS5nZXRUcmFja3MoKS5mb3JFYWNoKCh0cmFjaykgPT4ge1xyXG4gICAgICAgIHRyYWNrLnN0b3AoKTtcclxuICAgICAgICB0cmFjay5lbmFibGVkID0gZmFsc2U7XHJcbiAgICAgIH0pO1xyXG4gICAgICBzdHJlYW0gPSBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIGNhbWVyYVByZXZpZXcuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgY2FtZXJhUHJldmlldy5zcmNPYmplY3QgPSBudWxsO1xyXG4gICAgY2FwdHVyZUJ0bi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICBjYW1lcmFTZWxlY3Quc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IHN0YXJ0Q2FtZXJhID0gYXN5bmMgKGRldmljZUlkID0gbnVsbCkgPT4ge1xyXG4gICAgaWYgKCFpc1ZpZXdBY3RpdmUpIHJldHVybjtcclxuXHJcbiAgICB0cnkge1xyXG4gICAgICBzdG9wQ2FtZXJhKCk7XHJcblxyXG4gICAgICBjb25zdCBjb25zdHJhaW50cyA9IHtcclxuICAgICAgICB2aWRlbzoge1xyXG4gICAgICAgICAgd2lkdGg6IHsgaWRlYWw6IDEyODAgfSxcclxuICAgICAgICAgIGhlaWdodDogeyBpZGVhbDogNzIwIH0sXHJcbiAgICAgICAgICAuLi4oZGV2aWNlSWQgJiYgeyBkZXZpY2VJZDogeyBleGFjdDogZGV2aWNlSWQgfSB9KSxcclxuICAgICAgICB9LFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgc3RyZWFtID0gYXdhaXQgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoY29uc3RyYWludHMpO1xyXG5cclxuICAgICAgaWYgKGF2YWlsYWJsZUNhbWVyYXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgYXZhaWxhYmxlQ2FtZXJhcyA9IGF3YWl0IGdldENhbWVyYURldmljZXMoKTtcclxuICAgICAgICB1cGRhdGVDYW1lcmFTZWxlY3QoKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY2FtZXJhUHJldmlldy5zcmNPYmplY3QgPSBzdHJlYW07XHJcbiAgICAgIGNhbWVyYVByZXZpZXcuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcclxuICAgICAgcGhvdG9QcmV2aWV3LnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgICAgY2FwdHVyZUJ0bi5zdHlsZS5kaXNwbGF5ID0gXCJpbmxpbmUtYmxvY2tcIjtcclxuICAgICAgc3RvcENhbWVyYUJ0bi5zdHlsZS5kaXNwbGF5ID0gXCJpbmxpbmUtYmxvY2tcIjtcclxuICAgICAgc3RhcnRDYW1lcmFCdG4uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgICByZXRha2VCdG4uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG5cclxuICAgICAgaWYgKGF2YWlsYWJsZUNhbWVyYXMubGVuZ3RoID4gMSkge1xyXG4gICAgICAgIGNhbWVyYVNlbGVjdC5zdHlsZS5kaXNwbGF5ID0gXCJpbmxpbmUtYmxvY2tcIjtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgc2hvd0Vycm9yKGBDYW1lcmEgZXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgICAgaWYgKGRldmljZUlkKSB7XHJcbiAgICAgICAgc3RhcnRDYW1lcmEoKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIGNvbnN0IHVwZGF0ZUNhbWVyYVNlbGVjdCA9ICgpID0+IHtcclxuICAgIGNhbWVyYVNlbGVjdC5pbm5lckhUTUwgPSBcIlwiO1xyXG4gICAgYXZhaWxhYmxlQ2FtZXJhcy5mb3JFYWNoKChjYW1lcmEpID0+IHtcclxuICAgICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiKTtcclxuICAgICAgb3B0aW9uLnZhbHVlID0gY2FtZXJhLmRldmljZUlkO1xyXG4gICAgICBvcHRpb24udGV4dCA9IGNhbWVyYS5sYWJlbCB8fCBgQ2FtZXJhICR7Y2FtZXJhU2VsZWN0Lmxlbmd0aCArIDF9YDtcclxuICAgICAgY2FtZXJhU2VsZWN0LmFwcGVuZENoaWxkKG9wdGlvbik7XHJcbiAgICB9KTtcclxuXHJcbiAgICBjYW1lcmFTZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCAoKSA9PiB7XHJcbiAgICAgIHN0YXJ0Q2FtZXJhKGNhbWVyYVNlbGVjdC52YWx1ZSk7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICBjb25zdCBjYXB0dXJlUGhvdG8gPSAoKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB2aWRlbyA9IGNhbWVyYVByZXZpZXc7XHJcbiAgICAgIGNhbnZhcy53aWR0aCA9IHZpZGVvLnZpZGVvV2lkdGg7XHJcbiAgICAgIGNhbnZhcy5oZWlnaHQgPSB2aWRlby52aWRlb0hlaWdodDtcclxuXHJcbiAgICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XHJcbiAgICAgIGN0eC5kcmF3SW1hZ2UodmlkZW8sIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XHJcblxyXG4gICAgICBwaG90b1ByZXZpZXcuc3JjID0gY2FudmFzLnRvRGF0YVVSTChcImltYWdlL2pwZWdcIik7XHJcbiAgICAgIHBob3RvUHJldmlldy5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xyXG4gICAgICBjYW1lcmFQcmV2aWV3LnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuXHJcbiAgICAgIGNhbnZhcy50b0Jsb2IoXHJcbiAgICAgICAgKGJsb2IpID0+IHtcclxuICAgICAgICAgIHBob3RvRmlsZSA9IG5ldyBGaWxlKFtibG9iXSwgXCJzdG9yeS1waG90by5qcGdcIiwge1xyXG4gICAgICAgICAgICB0eXBlOiBcImltYWdlL2pwZWdcIixcclxuICAgICAgICAgICAgbGFzdE1vZGlmaWVkOiBEYXRlLm5vdygpLFxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBcImltYWdlL2pwZWdcIixcclxuICAgICAgICAwLjg1XHJcbiAgICAgICk7XHJcblxyXG4gICAgICBjYXB0dXJlQnRuLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgICAgc3RvcENhbWVyYUJ0bi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICAgIGNhbWVyYVNlbGVjdC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICAgIHJldGFrZUJ0bi5zdHlsZS5kaXNwbGF5ID0gXCJpbmxpbmUtYmxvY2tcIjtcclxuICAgICAgc3RvcENhbWVyYSgpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgc2hvd0Vycm9yKGBDYXB0dXJlIGZhaWxlZDogJHtlcnJvci5tZXNzYWdlfWApO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIGNvbnN0IHJldGFrZVBob3RvID0gKCkgPT4ge1xyXG4gICAgcGhvdG9QcmV2aWV3LnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgIHBob3RvUHJldmlldy5zcmMgPSBcIlwiO1xyXG4gICAgcGhvdG9GaWxlID0gbnVsbDtcclxuICAgIHN0YXJ0Q2FtZXJhKGNhbWVyYVNlbGVjdC52YWx1ZSB8fCBudWxsKTtcclxuICB9O1xyXG5cclxuICAvLyBDbGVhbiB1cCB3aGVuIHZpZXcgaXMgZGVzdHJveWVkXHJcbiAgY29uc3QgY2xlYW51cCA9ICgpID0+IHtcclxuICAgIGlzVmlld0FjdGl2ZSA9IGZhbHNlO1xyXG4gICAgc3RvcENhbWVyYSgpO1xyXG5cclxuICAgIGlmIChtYXApIHtcclxuICAgICAgbWFwLnJlbW92ZSgpO1xyXG4gICAgICBtYXAgPSBudWxsO1xyXG4gICAgICBtYXBNYXJrZXIgPSBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFJlbW92ZSBhbGwgZXZlbnQgbGlzdGVuZXJzXHJcbiAgICBjb25zdCBzYWZlUmVtb3ZlTGlzdGVuZXIgPSAoZWxlbWVudCwgZXZlbnQsIGhhbmRsZXIpID0+IHtcclxuICAgICAgaWYgKGVsZW1lbnQgJiYgaGFuZGxlcikge1xyXG4gICAgICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudCwgaGFuZGxlcik7XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgc2FmZVJlbW92ZUxpc3RlbmVyKHN0YXJ0Q2FtZXJhQnRuLCBcImNsaWNrXCIsIHN0YXJ0Q2FtZXJhKTtcclxuICAgIHNhZmVSZW1vdmVMaXN0ZW5lcihzdG9wQ2FtZXJhQnRuLCBcImNsaWNrXCIsIHN0b3BDYW1lcmEpO1xyXG4gICAgc2FmZVJlbW92ZUxpc3RlbmVyKGNhcHR1cmVCdG4sIFwiY2xpY2tcIiwgY2FwdHVyZVBob3RvKTtcclxuICAgIHNhZmVSZW1vdmVMaXN0ZW5lcihyZXRha2VCdG4sIFwiY2xpY2tcIiwgcmV0YWtlUGhvdG8pO1xyXG4gICAgc2FmZVJlbW92ZUxpc3RlbmVyKGNhbWVyYVNlbGVjdCwgXCJjaGFuZ2VcIiwgc3RhcnRDYW1lcmEpO1xyXG4gIH07XHJcblxyXG4gIC8vIEluaXRpYWxpemUgbWFwIHdoZW4gdmlldyBpcyBjcmVhdGVkXHJcbiAgc2V0VGltZW91dChpbml0aWFsaXplTWFwLCAxMDApO1xyXG5cclxuICAvLyBCaW5kIGV2ZW50IGhhbmRsZXJzXHJcbiAgY29uc3QgYmluZEFkZFN0b3J5ID0gKGhhbmRsZXIpID0+IHtcclxuICAgIGNvbnN0IGZvcm0gPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoXCIjc3RvcnktZm9ybVwiKTtcclxuICAgIGNvbnN0IGdldExvY2F0aW9uQnRuID0gdmlldy5xdWVyeVNlbGVjdG9yKFwiI2dldC1sb2NhdGlvblwiKTtcclxuXHJcbiAgICBjb25zdCBmb3JtU3VibWl0SGFuZGxlciA9IGFzeW5jIChlKSA9PiB7XHJcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgIGlmICghcGhvdG9GaWxlKSB7XHJcbiAgICAgICAgc2hvd0Vycm9yKFwiUGxlYXNlIHRha2UgYSBwaG90byBmaXJzdFwiKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IGRlc2NyaXB0aW9uID0gZm9ybS5kZXNjcmlwdGlvbi52YWx1ZS50cmltKCk7XHJcbiAgICAgIGlmICghZGVzY3JpcHRpb24pIHtcclxuICAgICAgICBzaG93RXJyb3IoXCJQbGVhc2UgZW50ZXIgYSBkZXNjcmlwdGlvblwiKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICghZm9ybS5sYXQudmFsdWUgfHwgIWZvcm0ubG5nLnZhbHVlKSB7XHJcbiAgICAgICAgc2hvd0Vycm9yKFwiUGxlYXNlIHNlbGVjdCBhIGxvY2F0aW9uXCIpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgZGF0YSA9IHtcclxuICAgICAgICBkZXNjcmlwdGlvbixcclxuICAgICAgICBwaG90bzogcGhvdG9GaWxlLFxyXG4gICAgICAgIGxhdDogcGFyc2VGbG9hdChmb3JtLmxhdC52YWx1ZSksXHJcbiAgICAgICAgbG9uOiBwYXJzZUZsb2F0KGZvcm0ubG5nLnZhbHVlKSxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgYXdhaXQgaGFuZGxlcihkYXRhKTtcclxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBzaG93RXJyb3IoYFN1Ym1pc3Npb24gZmFpbGVkOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgZ2V0TG9jYXRpb25IYW5kbGVyID0gKCkgPT4ge1xyXG4gICAgICBuYXZpZ2F0b3IuZ2VvbG9jYXRpb24uZ2V0Q3VycmVudFBvc2l0aW9uKFxyXG4gICAgICAgIChwb3NpdGlvbikgPT4ge1xyXG4gICAgICAgICAgY29uc3QgbGF0ID0gcG9zaXRpb24uY29vcmRzLmxhdGl0dWRlO1xyXG4gICAgICAgICAgY29uc3QgbG5nID0gcG9zaXRpb24uY29vcmRzLmxvbmdpdHVkZTtcclxuXHJcbiAgICAgICAgICB1cGRhdGVMb2NhdGlvbihsYXQsIGxuZyk7XHJcbiAgICAgICAgICBhZGRNYXBNYXJrZXIobGF0LCBsbmcpO1xyXG5cclxuICAgICAgICAgIGlmIChtYXApIHtcclxuICAgICAgICAgICAgbWFwLnNldFZpZXcoW2xhdCwgbG5nXSwgMTUpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgc2hvd1N1Y2Nlc3MoXCJDdXJyZW50IGxvY2F0aW9uIG9idGFpbmVkIVwiKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIChlcnJvcikgPT4ge1xyXG4gICAgICAgICAgc2hvd0Vycm9yKGBMb2NhdGlvbiBlcnJvcjogJHtlcnJvci5tZXNzYWdlfWApO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgeyBlbmFibGVIaWdoQWNjdXJhY3k6IHRydWUsIHRpbWVvdXQ6IDEwMDAwIH1cclxuICAgICAgKTtcclxuICAgIH07XHJcblxyXG4gICAgc3RhcnRDYW1lcmFCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHN0YXJ0Q2FtZXJhKTtcclxuICAgIHN0b3BDYW1lcmFCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHN0b3BDYW1lcmEpO1xyXG4gICAgY2FwdHVyZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgY2FwdHVyZVBob3RvKTtcclxuICAgIHJldGFrZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgcmV0YWtlUGhvdG8pO1xyXG4gICAgZ2V0TG9jYXRpb25CdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGdldExvY2F0aW9uSGFuZGxlcik7XHJcbiAgICBmb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgZm9ybVN1Ym1pdEhhbmRsZXIpO1xyXG5cclxuICAgIC8vIEFkZCBoZWFkZXIgbmF2aWdhdGlvbiBsaXN0ZW5lclxyXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJoZWFkZXItbmF2aWdhdGlvblwiLCBzdG9wQ2FtZXJhKTtcclxuICB9O1xyXG5cclxuICBjaGVja05vdGlmaWNhdGlvblBlcm1pc3Npb24oKTtcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIGdldFZpZXc6ICgpID0+IHZpZXcsXHJcbiAgICBiaW5kQWRkU3RvcnksXHJcbiAgICBzaG93RXJyb3IsXHJcbiAgICBzaG93U3VjY2VzcyxcclxuICAgIGdldE1hcENvbnRhaW5lcjogKCkgPT4gbWFwQ29udGFpbmVyLFxyXG4gICAgY2xlYW51cCxcclxuICB9O1xyXG59O1xyXG4iLCJleHBvcnQgY29uc3QgY2hlY2tBdXRoID0gKGF1dGhNb2RlbCwgcm91dGVyKSA9PiB7XHJcbiAgaWYgKCFhdXRoTW9kZWwuaXNBdXRoZW50aWNhdGVkKCkpIHtcclxuICAgIHJvdXRlci5uYXZpZ2F0ZVRvKFwiL2xvZ2luXCIpO1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuICByZXR1cm4gdHJ1ZTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBjaGVja0d1ZXN0ID0gKGF1dGhNb2RlbCwgcm91dGVyKSA9PiB7XHJcbiAgaWYgKGF1dGhNb2RlbC5pc0F1dGhlbnRpY2F0ZWQoKSkge1xyXG4gICAgcm91dGVyLm5hdmlnYXRlVG8oXCIvc3Rvcmllc1wiKTtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcbiAgcmV0dXJuIHRydWU7XHJcbn07XHJcblxyXG4iLCJpbXBvcnQgeyBIZWFkZXIsIHVwZGF0ZUF1dGhVSSB9IGZyb20gJy4vY29tcG9uZW50cy9IZWFkZXIuanMnO1xyXG5pbXBvcnQgJy4uL3B1YmxpYy9hc3NldHMvc3R5bGVzL21haW4uY3NzJzsgXHJcbmltcG9ydCB7IFJvdXRlciB9IGZyb20gJy4vcm91dGVyLmpzJztcclxuaW1wb3J0IHsgQXV0aE1vZGVsIH0gZnJvbSAnLi9tb2RlbHMvQXV0aE1vZGVsLmpzJztcclxuaW1wb3J0IHsgU3RvcnlNb2RlbCB9IGZyb20gJy4vbW9kZWxzL1N0b3J5TW9kZWwuanMnO1xyXG5pbXBvcnQgeyBBdXRoUHJlc2VudGVyIH0gZnJvbSAnLi9wcmVzZW50ZXJzL0F1dGhQcmVzZW50ZXIuanMnO1xyXG5pbXBvcnQgeyBTdG9yeVByZXNlbnRlciB9IGZyb20gJy4vcHJlc2VudGVycy9TdG9yeVByZXNlbnRlci5qcyc7XHJcbmltcG9ydCB7IE1hcFByZXNlbnRlciB9IGZyb20gJy4vcHJlc2VudGVycy9NYXBQcmVzZW50ZXIuanMnO1xyXG5pbXBvcnQgeyBMb2dpblZpZXcgfSBmcm9tICcuL3ZpZXdzL2F1dGgvTG9naW5WaWV3LmpzJztcclxuaW1wb3J0IHsgUmVnaXN0ZXJWaWV3IH0gZnJvbSAnLi92aWV3cy9hdXRoL1JlZ2lzdGVyVmlldy5qcyc7XHJcbmltcG9ydCB7IFN0b3JpZXNWaWV3IH0gZnJvbSAnLi92aWV3cy9zdG9yaWVzL1N0b3JpZXNWaWV3LmpzJztcclxuaW1wb3J0IHsgRGV0YWlsU3RvcnlWaWV3IH0gZnJvbSAnLi92aWV3cy9zdG9yaWVzL0RldGFpbFN0b3J5Vmlldy5qcyc7XHJcbmltcG9ydCB7IEFkZFN0b3J5VmlldyB9IGZyb20gJy4vdmlld3Mvc3Rvcmllcy9BZGRTdG9yeVZpZXcuanMnO1xyXG5pbXBvcnQgeyBFcnJvclZpZXcgfSBmcm9tICcuL3ZpZXdzL0Vycm9yVmlldy5qcyc7XHJcbmltcG9ydCB7IGNoZWNrQXV0aCwgY2hlY2tHdWVzdCB9IGZyb20gJy4vdXRpbHMvYXV0aC5qcyc7XHJcbmltcG9ydCB7IHJlcXVlc3ROb3RpZmljYXRpb25QZXJtaXNzaW9uLCBzdWJzY3JpYmVVc2VyIH0gZnJvbSAnLi91dGlscy9ub3RpZmljYXRpb24uanMnO1xyXG5pbXBvcnQgeyBpbml0aWFsaXplU2tpcFRvQ29udGVudCB9IGZyb20gJy4vdXRpbHMvU2tpcFRvQ29udGVudC5qcyc7XHJcblxyXG4vLyBJbml0aWFsaXplIG1vZGVsc1xyXG5pbml0aWFsaXplU2tpcFRvQ29udGVudCgpO1xyXG5jb25zdCBhdXRoTW9kZWwgPSBuZXcgQXV0aE1vZGVsKCk7XHJcbmNvbnN0IHN0b3J5TW9kZWwgPSBuZXcgU3RvcnlNb2RlbChhdXRoTW9kZWwpO1xyXG5cclxuaW5pdGlhbGl6ZVNraXBUb0NvbnRlbnQoKTtcclxuXHJcblxyXG5cclxuY29uc3QgaW5pdE1hcFdpdGhSZXRyeSA9IGFzeW5jIChoYW5kbGVyLCBjb250YWluZXJJZCwgbGF0LCBsbmcsIHpvb20sIGF0dGVtcHRzID0gMCkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjb250YWluZXJJZCk7XHJcbiAgICBpZiAoIWNvbnRhaW5lciAmJiBhdHRlbXB0cyA8IDMpIHtcclxuICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMCAqIChhdHRlbXB0cyArIDEpKSk7XHJcbiAgICAgIHJldHVybiBpbml0TWFwV2l0aFJldHJ5KGhhbmRsZXIsIGNvbnRhaW5lcklkLCBsYXQsIGxuZywgem9vbSwgYXR0ZW1wdHMgKyAxKTtcclxuICAgIH1cclxuICAgIHJldHVybiBoYW5kbGVyKGNvbnRhaW5lcklkLCBsYXQsIGxuZywgem9vbSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ01hcCBpbml0aWFsaXphdGlvbiBmYWlsZWQ6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG59O1xyXG5cclxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvZ291dCcsICgpID0+IHtcclxuICBhdXRoTW9kZWwubG9nb3V0KCk7XHJcbiAgdXBkYXRlQXV0aFVJKGZhbHNlKTtcclxuICByb3V0ZXIubmF2aWdhdGVUbygnL2xvZ2luJyk7XHJcbn0pO1xyXG5cclxuLy8gUm91dGVzIGNvbmZpZ3VyYXRpb25cclxuY29uc3Qgcm91dGVzID0gW1xyXG4gIHtcclxuICAgIHBhdGg6ICcvbG9naW4nLFxyXG4gICAgdmlldzogYXN5bmMgKCkgPT4ge1xyXG4gICAgICBpZiAoIWNoZWNrR3Vlc3QoYXV0aE1vZGVsLCByb3V0ZXIpKSByZXR1cm4gRXJyb3JWaWV3KCkuZ2V0VmlldygpO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgdmlldyA9IExvZ2luVmlldygpO1xyXG4gICAgICBuZXcgQXV0aFByZXNlbnRlcihcclxuICAgICAgICBhdXRoTW9kZWwsXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgYmluZExvZ2luOiB2aWV3LmJpbmRMb2dpbixcclxuICAgICAgICAgIHNob3dFcnJvcjogdmlldy5zaG93RXJyb3JcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJvdXRlclxyXG4gICAgICApO1xyXG4gICAgICBcclxuICAgICAgcmV0dXJuIHZpZXcuZ2V0VmlldygpO1xyXG4gICAgfVxyXG4gIH0sXHJcbiAge1xyXG4gICAgcGF0aDogJy9yZWdpc3RlcicsXHJcbiAgICB2aWV3OiBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGlmICghY2hlY2tHdWVzdChhdXRoTW9kZWwsIHJvdXRlcikpIHJldHVybiBFcnJvclZpZXcoKS5nZXRWaWV3KCk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCB2aWV3ID0gUmVnaXN0ZXJWaWV3KCk7XHJcbiAgICAgIG5ldyBBdXRoUHJlc2VudGVyKFxyXG4gICAgICAgIGF1dGhNb2RlbCxcclxuICAgICAgICB7XHJcbiAgICAgICAgICBiaW5kUmVnaXN0ZXI6IHZpZXcuYmluZFJlZ2lzdGVyLFxyXG4gICAgICAgICAgc2hvd0Vycm9yOiB2aWV3LnNob3dFcnJvcixcclxuICAgICAgICAgIHNob3dTdWNjZXNzOiB2aWV3LnNob3dTdWNjZXNzXHJcbiAgICAgICAgfSxcclxuICAgICAgICByb3V0ZXJcclxuICAgICAgKTtcclxuICAgICAgXHJcbiAgICAgIHJldHVybiB2aWV3LmdldFZpZXcoKTtcclxuICAgIH1cclxuICB9LFxyXG4gIHtcclxuICAgIHBhdGg6ICcvJyxcclxuICAgIHZpZXc6IGFzeW5jICgpID0+IHtcclxuICAgICAgaWYgKCFjaGVja0F1dGgoYXV0aE1vZGVsLCByb3V0ZXIpKSByZXR1cm4gRXJyb3JWaWV3KCkuZ2V0VmlldygpO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgdmlldyA9IFN0b3JpZXNWaWV3KCk7XHJcbiAgICAgIG5ldyBTdG9yeVByZXNlbnRlcihcclxuICAgICAgICBzdG9yeU1vZGVsLFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIGJpbmRMb2FkU3Rvcmllczogdmlldy5iaW5kTG9hZFN0b3JpZXMsXHJcbiAgICAgICAgICBkaXNwbGF5U3Rvcmllczogdmlldy5kaXNwbGF5U3RvcmllcyxcclxuICAgICAgICAgIHNob3dFcnJvcjogdmlldy5zaG93RXJyb3JcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJvdXRlclxyXG4gICAgICApO1xyXG4gICAgICBcclxuICAgICAgaWYgKGF1dGhNb2RlbC5pc0F1dGhlbnRpY2F0ZWQoKSkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBjb25zdCBwZXJtaXNzaW9uID0gYXdhaXQgcmVxdWVzdE5vdGlmaWNhdGlvblBlcm1pc3Npb24oKTtcclxuICAgICAgICAgIGlmIChwZXJtaXNzaW9uKSBhd2FpdCBzdWJzY3JpYmVVc2VyKGF1dGhNb2RlbC5nZXRUb2tlbigpKTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignTm90aWZpY2F0aW9uIHNldHVwIGZhaWxlZDonLCBlcnJvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4gdmlldy5nZXRWaWV3KCk7XHJcbiAgICB9XHJcbiAgfSxcclxuICB7XHJcbiAgICBwYXRoOiAnL3N0b3JpZXMnLFxyXG4gICAgdmlldzogYXN5bmMgKCkgPT4ge1xyXG4gICAgICBpZiAoIWNoZWNrQXV0aChhdXRoTW9kZWwsIHJvdXRlcikpIHJldHVybiBFcnJvclZpZXcoKS5nZXRWaWV3KCk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCB2aWV3ID0gU3Rvcmllc1ZpZXcoKTtcclxuICAgICAgbmV3IFN0b3J5UHJlc2VudGVyKFxyXG4gICAgICAgIHN0b3J5TW9kZWwsXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgYmluZExvYWRTdG9yaWVzOiB2aWV3LmJpbmRMb2FkU3RvcmllcyxcclxuICAgICAgICAgIGRpc3BsYXlTdG9yaWVzOiB2aWV3LmRpc3BsYXlTdG9yaWVzLFxyXG4gICAgICAgICAgc2hvd0Vycm9yOiB2aWV3LnNob3dFcnJvclxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcm91dGVyXHJcbiAgICAgICk7XHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4gdmlldy5nZXRWaWV3KCk7XHJcbiAgICB9XHJcbiAgfSxcclxuICB7XHJcbiAgICBwYXRoOiAnL3N0b3JpZXMvOmlkJyxcclxuICAgIHZpZXc6IGFzeW5jIChwYXJhbXMpID0+IHtcclxuICAgICAgaWYgKCFjaGVja0F1dGgoYXV0aE1vZGVsLCByb3V0ZXIpKSByZXR1cm4gRXJyb3JWaWV3KCk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCB2aWV3ID0gRGV0YWlsU3RvcnlWaWV3KCk7XHJcbiAgICAgIGNvbnN0IHsgaWQgfSA9IHBhcmFtcztcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHByZXNlbnRlciA9IG5ldyBTdG9yeVByZXNlbnRlcihcclxuICAgICAgICBzdG9yeU1vZGVsLFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIGJpbmRMb2FkU3RvcnlEZXRhaWw6IChoYW5kbGVyKSA9PiB7XHJcbiAgICAgICAgICAgIC8vIEZpcnN0IGNsZWFuIHVwIGFueSBleGlzdGluZyBtYXBcclxuICAgICAgICAgICAgY29uc3QgbWFwQ29udGFpbmVyID0gdmlldy5nZXRWaWV3KCkucXVlcnlTZWxlY3RvcignI3N0b3J5LW1hcC1jb250YWluZXInKTtcclxuICAgICAgICAgICAgaWYgKG1hcENvbnRhaW5lcikge1xyXG4gICAgICAgICAgICAgIG1hcENvbnRhaW5lci5pbm5lckhUTUwgPSAnPGRpdiBpZD1cInN0b3J5LW1hcFwiIGNsYXNzPVwiZGV0YWlsLW1hcFwiPjwvZGl2Pic7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaGFuZGxlcihpZCk7XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgZGlzcGxheVN0b3J5RGV0YWlsOiAoc3RvcnkpID0+IHtcclxuICAgICAgICAgICAgLy8gRGlzcGxheSBiYXNpYyBzdG9yeSBpbmZvIGZpcnN0XHJcbiAgICAgICAgICAgIHZpZXcuZGlzcGxheVN0b3J5RGV0YWlsKHN0b3J5KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFRoZW4gaGFuZGxlIG1hcCBpbml0aWFsaXphdGlvbiBpZiBsb2NhdGlvbiBleGlzdHNcclxuICAgICAgICAgICAgaWYgKHN0b3J5LmxhdCAmJiBzdG9yeS5sb24pIHtcclxuICAgICAgICAgICAgICAvLyBXYWl0IGZvciB0aGUgRE9NIHRvIGJlIHJlYWR5XHJcbiAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBtYXBFbGVtZW50ID0gdmlldy5nZXRWaWV3KCkucXVlcnlTZWxlY3RvcignI3N0b3J5LW1hcCcpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFtYXBFbGVtZW50IHx8ICFtYXBFbGVtZW50Ll9sZWFmbGV0X2lkKSB7IC8vIENoZWNrIGlmIG1hcCBhbHJlYWR5IGV4aXN0c1xyXG4gICAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1hcCA9IEwubWFwKG1hcEVsZW1lbnQpLnNldFZpZXcoW3N0b3J5LmxhdCwgc3RvcnkubG9uXSwgMTMpO1xyXG4gICAgICAgICAgICAgICAgICAgIEwudGlsZUxheWVyKCdodHRwczovL3tzfS50aWxlLm9wZW5zdHJlZXRtYXAub3JnL3t6fS97eH0ve3l9LnBuZycsIHtcclxuICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0aW9uOiAnJmNvcHk7IE9wZW5TdHJlZXRNYXAgY29udHJpYnV0b3JzJ1xyXG4gICAgICAgICAgICAgICAgICAgIH0pLmFkZFRvKG1hcCk7XHJcbiAgXHJcbiAgICAgICAgICAgICAgICAgICAgTC5tYXJrZXIoW3N0b3J5LmxhdCwgc3RvcnkubG9uXSlcclxuICAgICAgICAgICAgICAgICAgICAgIC5hZGRUbyhtYXApXHJcbiAgICAgICAgICAgICAgICAgICAgICAuYmluZFBvcHVwKGA8Yj4ke3N0b3J5Lm5hbWV9PC9iPjxicj4ke3N0b3J5LmRlc2NyaXB0aW9uLnN1YnN0cmluZygwLCA1MCl9Li4uYClcclxuICAgICAgICAgICAgICAgICAgICAgIC5vcGVuUG9wdXAoKTtcclxuICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdNYXAgaW5pdGlhbGl6YXRpb24gZXJyb3I6JywgZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfSwgNTApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgc2hvd0Vycm9yOiAobWVzc2FnZSkgPT4gdmlldy5zaG93RXJyb3IobWVzc2FnZSlcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJvdXRlclxyXG4gICAgICApO1xyXG4gIFxyXG4gICAgICByZXR1cm4gdmlldy5nZXRWaWV3KCk7XHJcbiAgICB9XHJcbiAgfSxcclxuICB7XHJcbiAgICBwYXRoOiAnL2FkZC1zdG9yeScsXHJcbiAgICB2aWV3OiBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHZpZXcgPSBBZGRTdG9yeVZpZXcoKTtcclxuICAgICAgY29uc3QgZG9tTm9kZSA9IHZpZXcuZ2V0VmlldygpO1xyXG4gICAgICBcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBtYXBQcmVzZW50ZXIgPSBuZXcgTWFwUHJlc2VudGVyKHtcclxuICAgICAgICAgIGJpbmRJbml0TWFwOiBhc3luYyAoaGFuZGxlcikgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBpbml0TWFwV2l0aFJldHJ5KGhhbmRsZXIsICdtYXAnLCAtNi4yMDg4LCAxMDYuODQ1NiwgMTIpO1xyXG4gICAgICAgICAgICBpZiAocmVzdWx0Py5tYXApIHtcclxuICAgICAgICAgICAgICByZXN1bHQubWFwLm9uKCdjbGljaycsIChlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB7IGxhdCwgbG5nIH0gPSBlLmxhdGxuZztcclxuICAgICAgICAgICAgICAgIGRvbU5vZGUucXVlcnlTZWxlY3RvcignI2xhdCcpLnZhbHVlID0gbGF0O1xyXG4gICAgICAgICAgICAgICAgZG9tTm9kZS5xdWVyeVNlbGVjdG9yKCcjbG5nJykudmFsdWUgPSBsbmc7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQuYWRkTWFya2VyKGxhdCwgbG5nLCAnU3RvcnkgbG9jYXRpb24nKTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0Py5tYXA7XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgYmluZEdldEN1cnJlbnRMb2NhdGlvbjogKGhhbmRsZXIpID0+IHtcclxuICAgICAgICAgICAgZG9tTm9kZS5xdWVyeVNlbGVjdG9yKCcjZ2V0LWxvY2F0aW9uJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBsb2NhdGlvbiA9IGF3YWl0IGhhbmRsZXIoKTtcclxuICAgICAgICAgICAgICAgIGRvbU5vZGUucXVlcnlTZWxlY3RvcignI2xhdCcpLnZhbHVlID0gbG9jYXRpb24ubGF0O1xyXG4gICAgICAgICAgICAgICAgZG9tTm9kZS5xdWVyeVNlbGVjdG9yKCcjbG5nJykudmFsdWUgPSBsb2NhdGlvbi5sbmc7XHJcbiAgICAgICAgICAgICAgICBtYXBQcmVzZW50ZXIuYWRkTWFya2VyKGxvY2F0aW9uLmxhdCwgbG9jYXRpb24ubG5nLCAnQ3VycmVudCBsb2NhdGlvbicpO1xyXG4gICAgICAgICAgICAgICAgbWFwUHJlc2VudGVyLm1hcD8uc2V0VmlldyhbbG9jYXRpb24ubGF0LCBsb2NhdGlvbi5sbmddLCAxNSk7XHJcbiAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHZpZXcuc2hvd0Vycm9yKGVycm9yLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIG5ldyBTdG9yeVByZXNlbnRlcihcclxuICAgICAgICAgIHN0b3J5TW9kZWwsXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIGJpbmRBZGRTdG9yeTogdmlldy5iaW5kQWRkU3RvcnksXHJcbiAgICAgICAgICAgIHNob3dFcnJvcjogdmlldy5zaG93RXJyb3IsXHJcbiAgICAgICAgICAgIHNob3dTdWNjZXNzOiB2aWV3LnNob3dTdWNjZXNzXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgcm91dGVyXHJcbiAgICAgICAgKTtcclxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdBZGQgc3RvcnkgaW5pdGlhbGl6YXRpb24gZmFpbGVkOicsIGVycm9yKTtcclxuICAgICAgICB2aWV3LnNob3dFcnJvcignRmFpbGVkIHRvIGluaXRpYWxpemUgZm9ybScpO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4gZG9tTm9kZTtcclxuICAgIH1cclxuICB9LFxyXG4gIHtcclxuICAgIHBhdGg6ICcvbG9nb3V0JyxcclxuICAgIHZpZXc6IGFzeW5jICgpID0+IHtcclxuICAgICAgYXV0aE1vZGVsLmxvZ291dCgpO1xyXG4gICAgICB1cGRhdGVBdXRoVUkoZmFsc2UpO1xyXG4gICAgICByb3V0ZXIubmF2aWdhdGVUbygnL2xvZ2luJyk7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgZ2V0VmlldzogKCkgPT4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcclxuICAgICAgfS5nZXRWaWV3KCk7XHJcbiAgICB9XHJcbiAgfSxcclxuICB7XHJcbiAgICBwYXRoOiAnKicsXHJcbiAgICB2aWV3OiAoKSA9PiBFcnJvclZpZXcoKS5nZXRWaWV3KClcclxuICB9XHJcbl07XHJcblxyXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignYmVmb3JlaW5zdGFsbHByb21wdCcsIChlKSA9PiB7XHJcbiAgY29uc29sZS5sb2coJ/CflKUgYmVmb3JlaW5zdGFsbHByb21wdCBmaXJlZCcpO1xyXG5cclxufSk7XHJcblxyXG5jb25zdCBhcHBSb290ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJhcHBcIik7XHJcbmFwcFJvb3QuYXBwZW5kQ2hpbGQoSGVhZGVyKCkpO1xyXG5cclxuXHJcbmxldCBkZWZlcnJlZFByb21wdDtcclxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2JlZm9yZWluc3RhbGxwcm9tcHQnLCAoZSkgPT4ge1xyXG4gIGUucHJldmVudERlZmF1bHQoKTtcclxuICBkZWZlcnJlZFByb21wdCA9IGU7XHJcblxyXG4gIGNvbnN0IGluc3RhbGxCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5zdGFsbC1idXR0b24nKTtcclxuICBpZiAoaW5zdGFsbEJ0bikge1xyXG4gICAgaW5zdGFsbEJ0bi5zdHlsZS5kaXNwbGF5ID0gJ2lubGluZS1ibG9jayc7XHJcbiAgICBpbnN0YWxsQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBpbnN0YWxsQnRuLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbiAgICAgIGRlZmVycmVkUHJvbXB0LnByb21wdCgpO1xyXG4gICAgICBjb25zdCBjaG9pY2UgPSBhd2FpdCBkZWZlcnJlZFByb21wdC51c2VyQ2hvaWNlO1xyXG4gICAgICBpZiAoY2hvaWNlLm91dGNvbWUgPT09ICdhY2NlcHRlZCcpIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnVXNlciBhY2NlcHRlZCBpbnN0YWxsJyk7XHJcbiAgICAgIH1cclxuICAgICAgZGVmZXJyZWRQcm9tcHQgPSBudWxsO1xyXG4gICAgfSk7XHJcbiAgfVxyXG59KTtcclxuXHJcblxyXG5jb25zdCByb3V0ZXIgPSBuZXcgUm91dGVyKHJvdXRlcyk7XHJcblxyXG51cGRhdGVBdXRoVUkoYXV0aE1vZGVsLmlzQXV0aGVudGljYXRlZCgpKTtcclxuXHJcbmlmICgnc2VydmljZVdvcmtlcicgaW4gbmF2aWdhdG9yKSB7XHJcbiAgXHJcbiAgaWYgKHRydWUpIHtcclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgKCkgPT4ge1xyXG4gICAgICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3RlcignL3N3LmpzJylcclxuICAgICAgICAudGhlbihyZWdpc3RyYXRpb24gPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdTVyByZWdpc3RlcmVkOicsIHJlZ2lzdHJhdGlvbik7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChlcnJvciA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1NXIHJlZ2lzdHJhdGlvbiBmYWlsZWQ6JywgZXJyb3IpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIChldmVudCkgPT4ge1xyXG4gICAgaWYgKGV2ZW50LmRhdGE/LnR5cGUgPT09ICdUUklHR0VSX1NZTkMnKSB7XHJcbiAgICAgIFxyXG4gICAgICBpZiAod2luZG93LnN0b3J5UHJlc2VudGVyICYmIHR5cGVvZiB3aW5kb3cuc3RvcnlQcmVzZW50ZXIuaGFuZGxlT25saW5lID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgd2luZG93LnN0b3J5UHJlc2VudGVyLmhhbmRsZU9ubGluZSgpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfSk7XHJcbn1cclxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///7427\n')}},n=>{n.O(0,[96,869],(()=>n(n.s=7427))),n.O()}]);